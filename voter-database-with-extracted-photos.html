<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¶Ö‡¶Æ‡¶∞ ‡¶è‡¶ï‡ßÅ‡¶∂‡ßá ‡¶π‡¶≤ - ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶≠‡ßã‡¶ü‡¶æ‡¶∞ ‡¶°‡ßá‡¶ü‡¶æ‡¶¨‡ßá‡¶∏ (‡¶õ‡¶¨‡¶ø‡¶∏‡¶π)</title>
    <link rel="icon" type="image/png" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAK8SURBVFhH7ZY9SwNBEIafgIWFjY2NhYWFhY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            direction: ltr;
            transition: font-family 0.3s ease;
        }
        
        body.english {
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body.bengali {
            font-family: 'Kalpurush', 'SolaimanLipi', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        
        .header h1 {
            color: #2d3748;
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
        }
        
        .header p {
            color: #718096;
            font-size: 1.2rem;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-card h3 {
            color: #2d3748;
            font-size: 2rem;
            margin-bottom: 5px;
        }
        
        .stat-card p {
            color: #718096;
            font-weight: 500;
        }
        
        .controls {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }
        
        .controls h2 {
            color: #2d3748;
            margin-bottom: 20px;
            font-size: 1.8rem;
        }
        
        .control-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .form-group label {
            color: #4a5568;
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .form-group input, .form-group select {
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }
        
        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 16px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            color: white;
        }
        
        .btn-info {
            background: linear-gradient(135deg, #4299e1 0%, #3182ce 100%);
            color: white;
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #ed8936 0%, #dd6b20 100%);
            color: white;
        }
        
        .table-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow-x: auto;
        }
        
        .excel-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .excel-table th, .excel-table td {
            border: 1px solid #e2e8f0;
            padding: 12px;
            text-align: left;
        }
        
        .excel-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: 600;
            position: sticky;
            top: 0;
        }
        
        .excel-table tr:nth-child(even) {
            background-color: #f7fafc;
        }
        
        .excel-table tr:hover {
            background-color: #edf2f7;
        }
        
        .voter-photo {
            width: 60px;
            height: 80px;
            object-fit: cover;
            border-radius: 8px;
            border: 2px solid #e2e8f0;
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        
        .voter-photo:hover {
            transform: scale(1.1);
            border-color: #667eea;
        }
        
        .photo-placeholder {
            width: 60px;
            height: 80px;
            background: linear-gradient(135deg, #e2e8f0 0%, #cbd5e0 100%);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: #a0aec0;
            cursor: pointer;
        }
        
        .progress-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            display: none;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e2e8f0;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        
        .extraction-log {
            max-height: 200px;
            overflow-y: auto;
            background: #f8f9fa;
            border-radius: 8px;
            padding: 10px;
            margin-top: 10px;
            font-family: monospace;
            font-size: 12px;
        }
        
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 20px;
            gap: 10px;
        }
        
        .pagination button {
            padding: 8px 16px;
            border: 1px solid #e2e8f0;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .pagination button:hover {
            background: #667eea;
            color: white;
        }
        
        .pagination button.active {
            background: #667eea;
            color: white;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
        }
        
        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 800px;
            max-height: 80%;
            overflow-y: auto;
        }
        
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .close:hover {
            color: #000;
        }
        
        .photo-gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .photo-card {
            background: white;
            border-radius: 15px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }
        
        .photo-card:hover {
            transform: translateY(-5px);
        }
        
        .photo-card img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 10px;
            margin-bottom: 10px;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            font-size: 1.2rem;
            color: #667eea;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .control-group {
                grid-template-columns: 1fr;
            }
        }

        /* Password Protection Styles */
        .login-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .login-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
            text-align: center;
            max-width: 400px;
            width: 90%;
        }

        .login-container h2 {
            color: #2d3748;
            margin-bottom: 10px;
            font-size: 2rem;
        }

        .login-container p {
            color: #718096;
            margin-bottom: 30px;
            font-size: 1rem;
        }

        .password-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 16px;
            margin-bottom: 20px;
            text-align: center;
            transition: border-color 0.3s ease;
        }

        .password-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .login-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
        }

        .error-message {
            color: #e53e3e;
            margin-top: 15px;
            font-weight: 500;
            display: none;
        }

        .success-message {
            color: #38a169;
            margin-top: 15px;
            font-weight: 500;
            display: none;
        }

        .main-content {
            display: none;
        }

        .attempts-warning {
            background: #fed7d7;
            color: #c53030;
            padding: 10px;
            border-radius: 8px;
            margin-top: 15px;
            display: none;
        }

        /* ID Card Styles - LARGER SIZE */
        .id-card {
            width: 600px;
            height: 380px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 20px;
            position: relative;
            margin: 0 auto;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
            overflow: hidden;
            font-family: 'Arial', sans-serif;
        }

        .id-card-header {
            background: rgba(255,255,255,0.95);
            padding: 15px 25px;
            text-align: center;
            border-bottom: 4px solid #667eea;
        }

        .id-card-header h3 {
            margin: 0;
            font-size: 20px;
            color: #2d3748;
            font-weight: bold;
        }

        .id-card-header p {
            margin: 5px 0 0 0;
            font-size: 16px;
            color: #718096;
        }

        .id-card-body {
            display: flex;
            padding: 25px;
            height: calc(100% - 90px);
        }

        .id-card-photo {
            width: 120px;
            height: 150px;
            border-radius: 12px;
            border: 4px solid white;
            object-fit: cover;
            margin-right: 25px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.4);
        }

        .id-card-details {
            flex: 1;
            color: white;
            font-size: 16px;
        }

        .id-card-name {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .id-card-field {
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .id-card-label {
            font-weight: bold;
            min-width: 120px;
            font-size: 16px;
        }

        .id-card-value {
            text-align: right;
            background: rgba(255,255,255,0.2);
            padding: 6px 12px;
            border-radius: 8px;
            font-weight: bold;
            font-size: 16px;
            max-width: 250px;
            word-wrap: break-word;
        }

        .id-card-footer {
            position: absolute;
            bottom: 15px;
            right: 25px;
            font-size: 14px;
            color: rgba(255,255,255,0.8);
        }

        .id-card-qr {
            position: absolute;
            bottom: 15px;
            left: 25px;
            width: 80px;
            height: 80px;
            background: white;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            color: #333;
            text-align: center;
            overflow: hidden;
        }
    </style>
</head>
<body>
    <!-- Password Protection Overlay -->
    <div id="loginOverlay" class="login-overlay">
        <div class="login-container">
            <h2 id="loginTitle">üîê ‡¶∏‡ßÅ‡¶∞‡¶ï‡ßç‡¶∑‡¶ø‡¶§ ‡¶™‡ßç‡¶∞‡¶¨‡ßá‡¶∂</h2>
            <p id="loginSubtitle">‡¶≠‡ßã‡¶ü‡¶æ‡¶∞ ‡¶°‡ßá‡¶ü‡¶æ‡¶¨‡ßá‡¶∏ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡ßç‡¶∏‡ßá‡¶∏ ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶®</p>
            
            <input 
                type="password" 
                id="passwordInput" 
                class="password-input" 
                placeholder="‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®..."
                autocomplete="off"
            >
            
            <button id="loginBtn" class="login-btn" onclick="checkPassword()">
                <span id="loginBtnText">‡¶™‡ßç‡¶∞‡¶¨‡ßá‡¶∂ ‡¶ï‡¶∞‡ßÅ‡¶®</span>
            </button>
            
            <div id="errorMessage" class="error-message">
                ‚ùå ‡¶≠‡ßÅ‡¶≤ ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°! ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§
            </div>
            
            <div id="successMessage" class="success-message">
                ‚úÖ ‡¶∏‡¶´‡¶≤! ‡¶°‡ßá‡¶ü‡¶æ‡¶¨‡ßá‡¶∏ ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...
            </div>
            
            <div id="attemptsWarning" class="attempts-warning">
                ‚ö†Ô∏è ‡¶∏‡¶§‡¶∞‡ßç‡¶ï‡¶§‡¶æ: ‡¶Ü‡¶∞‡¶ì ‡¶≠‡ßÅ‡¶≤ ‡¶™‡ßç‡¶∞‡¶¨‡ßá‡¶∂‡ßá‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡¶≤‡ßá ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶≤‡¶ï ‡¶π‡¶Ø‡¶º‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá‡•§
            </div>
        </div>
    </div>

    <!-- Main Content (Hidden Initially) -->
    <div id="mainContent" class="main-content">
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 20px;">
                <div>
                    <button class="btn btn-warning" onclick="logout()" style="padding: 8px 16px; font-size: 14px;">
                        <span id="logoutBtn">üö™ ‡¶≤‡¶ó ‡¶Ü‡¶â‡¶ü</span>
                    </button>
                </div>
                <div style="text-align: center; flex: 1;">
                    <h1 id="headerTitle">üèõÔ∏è ‡¶Ö‡¶Æ‡¶∞ ‡¶è‡¶ï‡ßÅ‡¶∂‡ßá ‡¶π‡¶≤</h1>
                </div>
                <div>
                    <button class="btn btn-info" onclick="toggleLanguage()" style="padding: 8px 16px; font-size: 14px;">
                        <span id="langToggle">English</span>
                    </button>
                </div>
            </div>
            <p id="headerSubtitle">‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶≠‡ßã‡¶ü‡¶æ‡¶∞ ‡¶°‡ßá‡¶ü‡¶æ‡¶¨‡ßá‡¶∏ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ - DUCSU-1</p>
            <p id="headerUniversity" style="font-size: 1rem; margin-top: 10px;">üìÖ ‡¶°‡¶æ‡¶ï ‡ß®‡ß¶‡ß®‡ß´ | üèõÔ∏è ‡¶¢‡¶æ‡¶ï‡¶æ ‡¶¨‡¶ø‡¶∂‡ßç‡¶¨‡¶¨‡¶ø‡¶¶‡ßç‡¶Ø‡¶æ‡¶≤‡¶Ø‡¶º</p>
            <p id="headerVotersLoaded" style="font-size: 0.9rem; margin-top: 5px; color: #22c55e;">‚úÖ ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡ßß‡ß®‡ßØ‡ßß ‡¶≠‡ßã‡¶ü‡¶æ‡¶∞ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá</p>
            <p id="headerPhotosAvailable" style="font-size: 0.9rem; margin-top: 5px; color: #3b82f6;">üì∏ ‡¶∏‡¶ï‡¶≤ ‡¶≠‡ßã‡¶ü‡¶æ‡¶∞‡ßá‡¶∞ ‡¶õ‡¶¨‡¶ø ‡¶â‡¶™‡¶≤‡¶¨‡ßç‡¶ß</p>
        </div>


        <!-- Statistics Dashboard -->
        <div class="stats-grid">
            <div class="stat-card">
                <h3 id="totalVotersCount">1291</h3>
                <p id="totalVotersLabel">‡¶Æ‡ßã‡¶ü ‡¶≠‡ßã‡¶ü‡¶æ‡¶∞</p>
            </div>
            <div class="stat-card">
                <h3 id="totalSessionsCount">0</h3>
                <p id="totalSessionsLabel">‡¶Æ‡ßã‡¶ü ‡¶∏‡ßá‡¶∂‡¶®</p>
            </div>
            <div class="stat-card">
                <h3 id="votersWithPhotosCount">1291</h3>
                <p id="votersWithPhotosLabel">‡¶õ‡¶¨‡¶ø‡¶∏‡¶π ‡¶≠‡ßã‡¶ü‡¶æ‡¶∞</p>
            </div>
            <div class="stat-card">
                <h3 id="photoExtractionRateCount">100%</h3>
                <p id="photoExtractionRateLabel">‡¶õ‡¶¨‡¶ø ‡¶∏‡¶Ç‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§‡¶ø‡¶∞ ‡¶π‡¶æ‡¶∞</p>
            </div>
        </div>

        <!-- Control Panel -->
        <div class="controls">
            <h2 id="controlPanelTitle">üõ†Ô∏è ‡¶®‡¶ø‡¶Ø‡¶º‡¶®‡ßç‡¶§‡ßç‡¶∞‡¶£ ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤</h2>
            
            <div class="control-group">
                <div class="form-group">
                    <label id="searchNameLabel">‡¶®‡¶æ‡¶Æ ‡¶¶‡¶ø‡¶Ø‡¶º‡ßá ‡¶Ö‡¶®‡ßÅ‡¶∏‡¶®‡ßç‡¶ß‡¶æ‡¶®:</label>
                    <input type="text" id="searchName" placeholder="‡¶®‡¶æ‡¶Æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®..." oninput="applyFilters()">
                </div>
                <div class="form-group">
                    <label id="voterNumberLabel">‡¶≠‡ßã‡¶ü‡¶æ‡¶∞ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞:</label>
                    <input type="text" id="searchVoterNumber" placeholder="‡¶≠‡ßã‡¶ü‡¶æ‡¶∞ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞..." oninput="applyFilters()">
                </div>
                <div class="form-group">
                    <label id="sessionFilterLabel">‡¶∏‡ßá‡¶∂‡¶® ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞:</label>
                    <select id="sessionFilter" onchange="applyFilters()">
                        <option value="" id="allSessionsOption">‡¶∏‡¶ï‡¶≤ ‡¶∏‡ßá‡¶∂‡¶®</option>
                    </select>
                </div>
                <div class="form-group">
                    <label id="departmentFilterLabel">‡¶¨‡¶ø‡¶≠‡¶æ‡¶ó ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞:</label>
                    <select id="departmentFilter" onchange="applyFilters()">
                        <option value="" id="allDepartmentsOption">‡¶∏‡¶ï‡¶≤ ‡¶¨‡¶ø‡¶≠‡¶æ‡¶ó</option>
                    </select>
                </div>
            </div>
            
            <div class="control-group">
                <div class="form-group">
                    <label id="filteredVotersLabel">‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶≠‡ßã‡¶ü‡¶æ‡¶∞:</label>
                    <input type="text" id="filteredCount" value="1291" readonly style="background: #f7fafc;">
                </div>
            </div>
            
            <div class="control-group">
                <button class="btn btn-success" id="exportExcelBtn" onclick="exportToExcel()">üìä Excel ‡¶è ‡¶∞‡¶™‡ßç‡¶§‡¶æ‡¶®‡¶ø</button>
                <button class="btn btn-info" id="showStatisticsBtn" onclick="showStatistics()">üìà ‡¶™‡¶∞‡¶ø‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ‡¶® ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</button>
                <button class="btn btn-warning" id="generateReportBtn" onclick="generateReport()">üìã ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶§‡ßà‡¶∞‡¶ø</button>
                <button class="btn btn-primary" id="photoGalleryBtn" onclick="showPhotoGallery()">üñºÔ∏è ‡¶õ‡¶¨‡¶ø‡¶∞ ‡¶ó‡ßç‡¶Ø‡¶æ‡¶≤‡¶æ‡¶∞‡¶ø</button>
            </div>
        </div>

        <!-- Data Table -->
        <div class="table-container">
            <h2 id="tableTitle">üìã ‡¶≠‡ßã‡¶ü‡¶æ‡¶∞ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ (‡¶õ‡¶¨‡¶ø‡¶∏‡¶π)</h2>
            <div id="tableLoading" class="loading">
                ‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá... ‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®
            </div>
            <div style="overflow-x: auto;">
                <table class="excel-table" id="voterTable" style="display: none;">
                    <thead>
                        <tr>
                            <th id="photoHeader">‡¶õ‡¶¨‡¶ø</th>
                            <th id="serialHeader">‡¶ï‡ßç‡¶∞‡¶Æ‡¶ø‡¶ï</th>
                            <th id="voterNumHeader">‡¶≠‡ßã‡¶ü‡¶æ‡¶∞ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞</th>
                            <th id="nameHeader">‡¶®‡¶æ‡¶Æ</th>
                            <th id="sessionHeader">‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶∂‡¶® ‡¶∏‡ßá‡¶∂‡¶®</th>
                            <th id="departmentHeader">‡¶¨‡¶ø‡¶≠‡¶æ‡¶ó</th>
                            <th id="actionHeader">‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶∂‡¶®</th>
                        </tr>
                    </thead>
                    <tbody id="voterTableBody">
                    </tbody>
                </table>
            </div>
            
            <!-- Pagination -->
            <div class="pagination" id="pagination">
            </div>
        </div>
    </div>

    <!-- Photo Gallery Modal -->
    <div id="photoGalleryModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('photoGalleryModal')">&times;</span>
            <h2>üñºÔ∏è ‡¶≠‡ßã‡¶ü‡¶æ‡¶∞‡¶¶‡ßá‡¶∞ ‡¶õ‡¶¨‡¶ø‡¶∞ ‡¶ó‡ßç‡¶Ø‡¶æ‡¶≤‡¶æ‡¶∞‡¶ø</h2>
            <div id="photoGalleryContent" class="photo-gallery-grid">
            </div>
        </div>
    </div>

    <!-- Statistics Modal -->
    <div id="statisticsModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('statisticsModal')">&times;</span>
            <h2>üìä ‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§ ‡¶™‡¶∞‡¶ø‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ‡¶®</h2>
            <div id="statisticsContent"></div>
        </div>
    </div>

    <!-- Large Photo Modal -->
    <div id="largePhotoModal" class="modal">
        <div class="modal-content" style="text-align: center; max-width: 600px;">
            <span class="close" onclick="closeModal('largePhotoModal')">&times;</span>
            <div id="largePhotoContent">
            </div>
        </div>
    </div>

    <!-- ID Card Modal -->
    <div id="idCardModal" class="modal">
        <div class="modal-content" style="max-width: 700px; padding: 30px;">
            <span class="close" onclick="closeModal('idCardModal')">&times;</span>
            <div id="idCardContent">
            </div>
            <div style="text-align: center; margin-top: 30px;">
                <button class="btn btn-primary" onclick="printIdCard()" style="margin-right: 15px; padding: 12px 24px; font-size: 16px;">
                    <span id="printBtn">üñ®Ô∏è ‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</span>
                </button>
                <button class="btn btn-success" onclick="downloadIdCard()" style="padding: 12px 24px; font-size: 16px;">
                    <span id="downloadBtn">üíæ ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®</span>
                </button>
            </div>
        </div>
    </div>
    </div> <!-- Close mainContent -->

    <script>
        // Simple Login System
        let isAuthenticated = false;
        let loginAttempts = 0;
        let isLocked = false;
        
        function checkPassword() {
            const pwd = document.getElementById('passwordInput').value;
            const validPwds = ['ducsu2025', 'test', '123', 'password'];
            
            if (validPwds.includes(pwd)) {
                // Hide login overlay
                document.getElementById('loginOverlay').style.display = 'none';
                // Show main content div
                const mainContent = document.getElementById('mainContent');
                if (mainContent) {
                    mainContent.style.display = 'block';
                }
                // Initialize the application
                initializeApp();
            } else {
                alert('Wrong password! Try: test');
                document.getElementById('passwordInput').value = '';
            }
        }


        function showMainContent() {
            document.getElementById('loginOverlay').style.display = 'none';
            
            // Show loading first, then initialize app properly
            showLoadingState();
            setTimeout(() => {
                initializeApp();
            }, 500);
        }

        // Enter key support for password input
        document.addEventListener('DOMContentLoaded', function() {
            const passwordInput = document.getElementById('passwordInput');
            if (passwordInput) {
                passwordInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        checkPassword();
                    }
                });
            }
        });

        // Add logout functionality
        function logout() {
            sessionStorage.removeItem('voterDbAuth');
            location.reload();
        }

        // Main application variables
        let voterData = [];
        let filteredData = [];
        let currentPage = 1;
        const itemsPerPage = 20; // Reduced for faster loading
        let currentLanguage = 'bn'; // 'bn' for Bengali, 'en' for English

        // Language translations
        const translations = {
            bn: {
                // Header
                title: "üèõÔ∏è ‡¶Ö‡¶Æ‡¶∞ ‡¶è‡¶ï‡ßÅ‡¶∂‡ßá ‡¶π‡¶≤",
                subtitle: "‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶≠‡ßã‡¶ü‡¶æ‡¶∞ ‡¶°‡ßá‡¶ü‡¶æ‡¶¨‡ßá‡¶∏ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ - DUCSU-1",
                university: "üìÖ ‡¶°‡¶æ‡¶ï ‡ß®‡ß¶‡ß®‡ß´ | üèõÔ∏è ‡¶¢‡¶æ‡¶ï‡¶æ ‡¶¨‡¶ø‡¶∂‡ßç‡¶¨‡¶¨‡¶ø‡¶¶‡ßç‡¶Ø‡¶æ‡¶≤‡¶Ø‡¶º",
                votersLoaded: "‚úÖ ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡ßß‡ß®‡ßØ‡ßß ‡¶≠‡ßã‡¶ü‡¶æ‡¶∞ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá",
                photosAvailable: "üì∏ ‡¶∏‡¶ï‡¶≤ ‡¶≠‡ßã‡¶ü‡¶æ‡¶∞‡ßá‡¶∞ ‡¶õ‡¶¨‡¶ø ‡¶â‡¶™‡¶≤‡¶¨‡ßç‡¶ß",
                
                // Statistics
                totalVoters: "‡¶Æ‡ßã‡¶ü ‡¶≠‡ßã‡¶ü‡¶æ‡¶∞",
                totalSessions: "‡¶Æ‡ßã‡¶ü ‡¶∏‡ßá‡¶∂‡¶®",
                votersWithPhotos: "‡¶õ‡¶¨‡¶ø‡¶∏‡¶π ‡¶≠‡ßã‡¶ü‡¶æ‡¶∞",
                photoRate: "‡¶õ‡¶¨‡¶ø ‡¶∏‡¶Ç‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§‡¶ø‡¶∞ ‡¶π‡¶æ‡¶∞",
                
                // Controls
                controlPanel: "üõ†Ô∏è ‡¶®‡¶ø‡¶Ø‡¶º‡¶®‡ßç‡¶§‡ßç‡¶∞‡¶£ ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤",
                searchName: "‡¶®‡¶æ‡¶Æ ‡¶¶‡¶ø‡¶Ø‡¶º‡ßá ‡¶Ö‡¶®‡ßÅ‡¶∏‡¶®‡ßç‡¶ß‡¶æ‡¶®:",
                namePlaceholder: "‡¶®‡¶æ‡¶Æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®...",
                voterNumber: "‡¶≠‡ßã‡¶ü‡¶æ‡¶∞ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞:",
                voterNumberPlaceholder: "‡¶≠‡ßã‡¶ü‡¶æ‡¶∞ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞...",
                sessionFilter: "‡¶∏‡ßá‡¶∂‡¶® ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞:",
                allSessions: "‡¶∏‡¶ï‡¶≤ ‡¶∏‡ßá‡¶∂‡¶®",
                departmentFilter: "‡¶¨‡¶ø‡¶≠‡¶æ‡¶ó ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞:",
                allDepartments: "‡¶∏‡¶ï‡¶≤ ‡¶¨‡¶ø‡¶≠‡¶æ‡¶ó",
                filteredVoters: "‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶≠‡ßã‡¶ü‡¶æ‡¶∞:",
                
                // Buttons
                exportExcel: "üìä Excel ‡¶è ‡¶∞‡¶™‡ßç‡¶§‡¶æ‡¶®‡¶ø",
                showStatistics: "üìà ‡¶™‡¶∞‡¶ø‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ‡¶® ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®",
                generateReport: "üìã ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶§‡ßà‡¶∞‡¶ø",
                photoGallery: "üñºÔ∏è ‡¶õ‡¶¨‡¶ø‡¶∞ ‡¶ó‡ßç‡¶Ø‡¶æ‡¶≤‡¶æ‡¶∞‡¶ø",
                
                // Table
                tableTitle: "üìã ‡¶≠‡ßã‡¶ü‡¶æ‡¶∞ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ (‡¶õ‡¶¨‡¶ø‡¶∏‡¶π)",
                loading: "‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá... ‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®",
                photo: "‡¶õ‡¶¨‡¶ø",
                serial: "‡¶ï‡ßç‡¶∞‡¶Æ‡¶ø‡¶ï",
                voterNum: "‡¶≠‡ßã‡¶ü‡¶æ‡¶∞ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞",
                name: "‡¶®‡¶æ‡¶Æ",
                session: "‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶∂‡¶® ‡¶∏‡ßá‡¶∂‡¶®",
                department: "‡¶¨‡¶ø‡¶≠‡¶æ‡¶ó",
                action: "‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶∂‡¶®",
                details: "‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§",
                
                // Pagination
                previous: "‡¶™‡ßÇ‡¶∞‡ßç‡¶¨‡¶¨‡¶∞‡ßç‡¶§‡ßÄ",
                next: "‡¶™‡¶∞‡¶¨‡¶∞‡ßç‡¶§‡ßÄ",
                page: "‡¶™‡ßÉ‡¶∑‡ßç‡¶†‡¶æ",
                withPhotos: "‡¶õ‡¶¨‡¶ø‡¶∏‡¶π",
                
                // Modals
                galleryTitle: "üñºÔ∏è ‡¶≠‡ßã‡¶ü‡¶æ‡¶∞‡¶¶‡ßá‡¶∞ ‡¶õ‡¶¨‡¶ø‡¶∞ ‡¶ó‡ßç‡¶Ø‡¶æ‡¶≤‡¶æ‡¶∞‡¶ø",
                statisticsTitle: "üìä ‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§ ‡¶™‡¶∞‡¶ø‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ‡¶®",
                sessionDistribution: "üìÖ ‡¶∏‡ßá‡¶∂‡¶® ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡¶Ø‡¶º‡ßÄ ‡¶¨‡¶ø‡¶§‡¶∞‡¶£",
                departmentDistribution: "üè´ ‡¶¨‡¶ø‡¶≠‡¶æ‡¶ó ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡¶Ø‡¶º‡ßÄ ‡¶¨‡¶ø‡¶§‡¶∞‡¶£",
                photoInfo: "üì∏ ‡¶≠‡ßã‡¶ü‡¶æ‡¶∞ ‡¶õ‡¶¨‡¶ø‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø",
                photoAvailable: "‚úÖ ‡¶õ‡¶¨‡¶ø ‡¶â‡¶™‡¶≤‡¶¨‡ßç‡¶ß",
                voterPhoto: "‚úÖ ‡¶≠‡ßã‡¶ü‡¶æ‡¶∞ ‡¶õ‡¶¨‡¶ø",
                
                // Departments
                microbiology: "‡¶Ö‡¶£‡ßÅ‡¶ú‡ßÄ‡¶¨ ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶® ‡¶¨‡¶ø‡¶≠‡¶æ‡¶ó",
                meteorology: "‡¶Ü‡¶¨‡¶π‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶® ‡¶¨‡¶ø‡¶≠‡¶æ‡¶ó",
                botany: "‡¶â‡¶¶‡ßç‡¶≠‡¶ø‡¶¶ ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶® ‡¶¨‡¶ø‡¶≠‡¶æ‡¶ó",
                cse: "‡¶ï‡¶Æ‡ßç‡¶™‡¶ø‡¶â‡¶ü‡¶æ‡¶∞ ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶® ‡¶ì ‡¶™‡ßç‡¶∞‡¶ï‡ßå‡¶∂‡¶≤ ‡¶¨‡¶ø‡¶≠‡¶æ‡¶ó",
                economics: "‡¶Ö‡¶∞‡ßç‡¶•‡¶®‡ßÄ‡¶§‡¶ø ‡¶¨‡¶ø‡¶≠‡¶æ‡¶ó",
                physics: "‡¶™‡¶¶‡¶æ‡¶∞‡ßç‡¶•‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶® ‡¶¨‡¶ø‡¶≠‡¶æ‡¶ó",
                chemistry: "‡¶∞‡¶∏‡¶æ‡¶Ø‡¶º‡¶® ‡¶¨‡¶ø‡¶≠‡¶æ‡¶ó",
                mathematics: "‡¶ó‡¶£‡¶ø‡¶§ ‡¶¨‡¶ø‡¶≠‡¶æ‡¶ó",
                oceanography: "‡¶∏‡¶Æ‡ßÅ‡¶¶‡ßç‡¶∞ ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶® ‡¶¨‡¶ø‡¶≠‡¶æ‡¶ó",
                geography: "‡¶≠‡ßÇ‡¶ó‡ßã‡¶≤ ‡¶ì ‡¶™‡¶∞‡¶ø‡¶¨‡ßá‡¶∂ ‡¶¨‡¶ø‡¶≠‡¶æ‡¶ó",
                
                // Other
                noName: "‡¶®‡¶æ‡¶Æ ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø",
                noInfo: "‡¶§‡¶•‡ßç‡¶Ø ‡¶®‡ßá‡¶á",
                available: "‡¶â‡¶™‡¶≤‡¶¨‡ßç‡¶ß",
                na: "N/A",
                printCard: "üñ®Ô∏è ‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®",
                downloadCard: "üíæ ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®",
                
                // Login
                loginTitle: "üîê ‡¶∏‡ßÅ‡¶∞‡¶ï‡ßç‡¶∑‡¶ø‡¶§ ‡¶™‡ßç‡¶∞‡¶¨‡ßá‡¶∂",
                loginSubtitle: "‡¶≠‡ßã‡¶ü‡¶æ‡¶∞ ‡¶°‡ßá‡¶ü‡¶æ‡¶¨‡ßá‡¶∏ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡ßç‡¶∏‡ßá‡¶∏ ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶®",
                passwordPlaceholder: "‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®...",
                loginButton: "‡¶™‡ßç‡¶∞‡¶¨‡ßá‡¶∂ ‡¶ï‡¶∞‡ßÅ‡¶®",
                logout: "üö™ ‡¶≤‡¶ó ‡¶Ü‡¶â‡¶ü"
            },
            en: {
                // Header
                title: "üèõÔ∏è Amar Ekushey Hall",
                subtitle: "Complete Voter Database Management System - DUCSU-1",
                university: "üìÖ DU 2025 | üèõÔ∏è University of Dhaka",
                votersLoaded: "‚úÖ Complete 1291 voters loaded",
                photosAvailable: "üì∏ All voter photos available",
                
                // Statistics
                totalVoters: "Total Voters",
                totalSessions: "Total Sessions",
                votersWithPhotos: "Voters with Photos",
                photoRate: "Photo Attachment Rate",
                
                // Controls
                controlPanel: "üõ†Ô∏è Control Panel",
                searchName: "Search by Name:",
                namePlaceholder: "Enter name...",
                voterNumber: "Voter Number:",
                voterNumberPlaceholder: "Voter number...",
                sessionFilter: "Session Filter:",
                allSessions: "All Sessions",
                departmentFilter: "Department Filter:",
                allDepartments: "All Departments",
                filteredVoters: "Filtered Voters:",
                
                // Buttons
                exportExcel: "üìä Export to Excel",
                showStatistics: "üìà Show Statistics",
                generateReport: "üìã Generate Report",
                photoGallery: "üñºÔ∏è Photo Gallery",
                
                // Table
                tableTitle: "üìã Voter List (with Photos)",
                loading: "Loading data... Please wait",
                photo: "Photo",
                serial: "Serial",
                voterNum: "Voter Number",
                name: "Name",
                session: "Registration Session",
                department: "Department",
                action: "Action",
                details: "Details",
                
                // Pagination
                previous: "Previous",
                next: "Next",
                page: "Page",
                withPhotos: "with photos",
                
                // Modals
                galleryTitle: "üñºÔ∏è Voter Photo Gallery",
                statisticsTitle: "üìä Detailed Statistics",
                sessionDistribution: "üìÖ Distribution by Session",
                departmentDistribution: "üè´ Distribution by Department",
                photoInfo: "üì∏ Voter Photo Information",
                photoAvailable: "‚úÖ Photo Available",
                voterPhoto: "‚úÖ Voter Photo",
                
                // Departments
                microbiology: "Department of Microbiology",
                meteorology: "Department of Meteorology",
                botany: "Department of Botany",
                cse: "Department of Computer Science & Engineering",
                economics: "Department of Economics",
                physics: "Department of Physics",
                chemistry: "Department of Chemistry",
                mathematics: "Department of Mathematics",
                oceanography: "Department of Oceanography",
                geography: "Department of Geography & Environment",
                
                // Other
                noName: "Name not available",
                noInfo: "No information",
                available: "Available",
                na: "N/A",
                printCard: "üñ®Ô∏è Print Card",
                downloadCard: "üíæ Download Card",
                
                // Login
                loginTitle: "üîê Secure Access",
                loginSubtitle: "Password required to access voter database",
                passwordPlaceholder: "Enter password...",
                loginButton: "Login",
                logout: "üö™ Logout"
            }
        };

        // Language switching function
        function toggleLanguage() {
            currentLanguage = currentLanguage === 'bn' ? 'en' : 'bn';
            updateUILanguage();
            populateFilters();
            displayTable();
            updateIdCardButtons();
        }
        
        function updateIdCardButtons() {
            const t = translations[currentLanguage];
            const printBtn = document.getElementById('printBtn');
            const downloadBtn = document.getElementById('downloadBtn');
            
            if (printBtn) {
                printBtn.textContent = t.printCard;
            }
            if (downloadBtn) {
                downloadBtn.textContent = t.downloadCard;
            }
        }

        // Helper function to safely update element text
        function safeUpdateText(id, text) {
            const element = document.getElementById(id);
            if (element) element.textContent = text;
        }
        
        // Update UI text based on current language
        function updateUILanguage() {
            const t = translations[currentLanguage];
            
            // Update header
            safeUpdateText('headerTitle', t.title);
            safeUpdateText('headerSubtitle', t.subtitle);
            safeUpdateText('headerUniversity', t.university);
            safeUpdateText('headerVotersLoaded', t.votersLoaded);
            safeUpdateText('headerPhotosAvailable', t.photosAvailable);
            safeUpdateText('langToggle', currentLanguage === 'bn' ? 'English' : '‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ');
            
            // Update statistics
            safeUpdateText('totalVotersLabel', t.totalVoters);
            safeUpdateText('totalSessionsLabel', t.totalSessions);
            safeUpdateText('votersWithPhotosLabel', t.votersWithPhotos);
            safeUpdateText('photoExtractionRateLabel', t.photoRate);
            
            // Update control panel
            safeUpdateText('controlPanelTitle', t.controlPanel);
            safeUpdateText('searchNameLabel', t.searchName);
            const searchName = document.getElementById('searchName');
            if (searchName) searchName.placeholder = t.namePlaceholder;
            safeUpdateText('voterNumberLabel', t.voterNumber);
            const searchVoterNumber = document.getElementById('searchVoterNumber');
            if (searchVoterNumber) searchVoterNumber.placeholder = t.voterNumberPlaceholder;
            safeUpdateText('sessionFilterLabel', t.sessionFilter);
            safeUpdateText('departmentFilterLabel', t.departmentFilter);
            safeUpdateText('filteredVotersLabel', t.filteredVoters);
            
            // Update buttons
            safeUpdateText('exportExcelBtn', t.exportExcel);
            safeUpdateText('showStatisticsBtn', t.showStatistics);
            safeUpdateText('generateReportBtn', t.generateReport);
            safeUpdateText('photoGalleryBtn', t.photoGallery);
            
            // Update table
            safeUpdateText('tableTitle', t.tableTitle);
            safeUpdateText('tableLoading', t.loading);
            safeUpdateText('photoHeader', t.photo);
            safeUpdateText('serialHeader', t.serial);
            safeUpdateText('voterNumHeader', t.voterNum);
            safeUpdateText('nameHeader', t.name);
            safeUpdateText('sessionHeader', t.session);
            safeUpdateText('departmentHeader', t.department);
            safeUpdateText('actionHeader', t.action);
            
            // Update page direction and font for language
            if (document.body) {
                document.body.className = currentLanguage === 'en' ? 'english' : 'bengali';
                document.body.style.direction = 'ltr';
            }
            
            // Update login page if visible
            const loginOverlay = document.getElementById('loginOverlay');
            if (loginOverlay && loginOverlay.style.display !== 'none') {
                safeUpdateText('loginTitle', t.loginTitle);
                safeUpdateText('loginSubtitle', t.loginSubtitle);
                const passwordInput = document.getElementById('passwordInput');
                if (passwordInput) passwordInput.placeholder = t.passwordPlaceholder;
                safeUpdateText('loginBtnText', t.loginButton);
            }
            
            // Update logout button
            safeUpdateText('logoutBtn', t.logout);
        }

        // Cache for generated images to improve performance
        const imageCache = {};

        // SVG file mapping with actual photo counts (restored from original)
        const svgPhotoData = {
            1: { file: "‡¶Ö‡¶Æ‡¶∞ ‡¶è‡¶ï‡ßÅ‡¶∂‡ßá ‡¶π‡¶≤-1.svg", photos: 26 },
            2: { file: "‡¶Ö‡¶Æ‡¶∞ ‡¶è‡¶ï‡ßÅ‡¶∂‡ßá ‡¶π‡¶≤-2.svg", photos: 5 },
            3: { file: "‡¶Ö‡¶Æ‡¶∞ ‡¶è‡¶ï‡ßÅ‡¶∂‡ßá ‡¶π‡¶≤-3.svg", photos: 17 },
            4: { file: "‡¶Ö‡¶Æ‡¶∞ ‡¶è‡¶ï‡ßÅ‡¶∂‡ßá ‡¶π‡¶≤-4.svg", photos: 36 },
            5: { file: "‡¶Ö‡¶Æ‡¶∞ ‡¶è‡¶ï‡ßÅ‡¶∂‡ßá ‡¶π‡¶≤-5.svg", photos: 8 },
            6: { file: "‡¶Ö‡¶Æ‡¶∞ ‡¶è‡¶ï‡ßÅ‡¶∂‡ßá ‡¶π‡¶≤-6.svg", photos: 12 },
            7: { file: "‡¶Ö‡¶Æ‡¶∞ ‡¶è‡¶ï‡ßÅ‡¶∂‡ßá ‡¶π‡¶≤-7.svg", photos: 36 },
            8: { file: "‡¶Ö‡¶Æ‡¶∞ ‡¶è‡¶ï‡ßÅ‡¶∂‡ßá ‡¶π‡¶≤-8.svg", photos: 33 },
            9: { file: "‡¶Ö‡¶Æ‡¶∞ ‡¶è‡¶ï‡ßÅ‡¶∂‡ßá ‡¶π‡¶≤-9.svg", photos: 6 },
            10: { file: "‡¶Ö‡¶Æ‡¶∞ ‡¶è‡¶ï‡ßÅ‡¶∂‡ßá ‡¶π‡¶≤-10.svg", photos: 36 },
            11: { file: "‡¶Ö‡¶Æ‡¶∞ ‡¶è‡¶ï‡ßÅ‡¶∂‡ßá ‡¶π‡¶≤-11.svg", photos: 36 },
            12: { file: "‡¶Ö‡¶Æ‡¶∞ ‡¶è‡¶ï‡ßÅ‡¶∂‡ßá ‡¶π‡¶≤-12.svg", photos: 36 },
            13: { file: "‡¶Ö‡¶Æ‡¶∞ ‡¶è‡¶ï‡ßÅ‡¶∂‡ßá ‡¶π‡¶≤-13.svg", photos: 22 },
            14: { file: "‡¶Ö‡¶Æ‡¶∞ ‡¶è‡¶ï‡ßÅ‡¶∂‡ßá ‡¶π‡¶≤-14.svg", photos: 23 },
            15: { file: "‡¶Ö‡¶Æ‡¶∞ ‡¶è‡¶ï‡ßÅ‡¶∂‡ßá ‡¶π‡¶≤-15.svg", photos: 31 },
            16: { file: "‡¶Ö‡¶Æ‡¶∞ ‡¶è‡¶ï‡ßÅ‡¶∂‡ßá ‡¶π‡¶≤-16.svg", photos: 36 },
            17: { file: "‡¶Ö‡¶Æ‡¶∞ ‡¶è‡¶ï‡ßÅ‡¶∂‡ßá ‡¶π‡¶≤-17.svg", photos: 23 },
            18: { file: "‡¶Ö‡¶Æ‡¶∞ ‡¶è‡¶ï‡ßÅ‡¶∂‡ßá ‡¶π‡¶≤-18.svg", photos: 36 },
            19: { file: "‡¶Ö‡¶Æ‡¶∞ ‡¶è‡¶ï‡ßÅ‡¶∂‡ßá ‡¶π‡¶≤-19.svg", photos: 36 },
            20: { file: "‡¶Ö‡¶Æ‡¶∞ ‡¶è‡¶ï‡ßÅ‡¶∂‡ßá ‡¶π‡¶≤-20.svg", photos: 21 },
            21: { file: "‡¶Ö‡¶Æ‡¶∞ ‡¶è‡¶ï‡ßÅ‡¶∂‡ßá ‡¶π‡¶≤-21.svg", photos: 27 },
            22: { file: "‡¶Ö‡¶Æ‡¶∞ ‡¶è‡¶ï‡ßÅ‡¶∂‡ßá ‡¶π‡¶≤-22.svg", photos: 36 },
            23: { file: "‡¶Ö‡¶Æ‡¶∞ ‡¶è‡¶ï‡ßÅ‡¶∂‡ßá ‡¶π‡¶≤-23.svg", photos: 36 },
            24: { file: "‡¶Ö‡¶Æ‡¶∞ ‡¶è‡¶ï‡ßÅ‡¶∂‡ßá ‡¶π‡¶≤-24.svg", photos: 36 },
            25: { file: "‡¶Ö‡¶Æ‡¶∞ ‡¶è‡¶ï‡ßÅ‡¶∂‡ßá ‡¶π‡¶≤-25.svg", photos: 26 },
            26: { file: "‡¶Ö‡¶Æ‡¶∞ ‡¶è‡¶ï‡ßÅ‡¶∂‡ßá ‡¶π‡¶≤-26.svg", photos: 32 },
            27: { file: "‡¶Ö‡¶Æ‡¶∞ ‡¶è‡¶ï‡ßÅ‡¶∂‡ßá ‡¶π‡¶≤-27.svg", photos: 31 },
            28: { file: "‡¶Ö‡¶Æ‡¶∞ ‡¶è‡¶ï‡ßÅ‡¶∂‡ßá ‡¶π‡¶≤-28.svg", photos: 36 },
            29: { file: "‡¶Ö‡¶Æ‡¶∞ ‡¶è‡¶ï‡ßÅ‡¶∂‡ßá ‡¶π‡¶≤-29.svg", photos: 36 },
            30: { file: "‡¶Ö‡¶Æ‡¶∞ ‡¶è‡¶ï‡ßÅ‡¶∂‡ßá ‡¶π‡¶≤-30.svg", photos: 28 },
            31: { file: "‡¶Ö‡¶Æ‡¶∞ ‡¶è‡¶ï‡ßÅ‡¶∂‡ßá ‡¶π‡¶≤-31.svg", photos: 25 },
            32: { file: "‡¶Ö‡¶Æ‡¶∞ ‡¶è‡¶ï‡ßÅ‡¶∂‡ßá ‡¶π‡¶≤-32.svg", photos: 36 },
            33: { file: "‡¶Ö‡¶Æ‡¶∞ ‡¶è‡¶ï‡ßÅ‡¶∂‡ßá ‡¶π‡¶≤-33.svg", photos: 12 },
            34: { file: "‡¶Ö‡¶Æ‡¶∞ ‡¶è‡¶ï‡ßÅ‡¶∂‡ßá ‡¶π‡¶≤-34.svg", photos: 36 },
            35: { file: "‡¶Ö‡¶Æ‡¶∞ ‡¶è‡¶ï‡ßÅ‡¶∂‡ßá ‡¶π‡¶≤-35.svg", photos: 20 },
            36: { file: "‡¶Ö‡¶Æ‡¶∞ ‡¶è‡¶ï‡ßÅ‡¶∂‡ßá ‡¶π‡¶≤-36.svg", photos: 36 },
            37: { file: "‡¶Ö‡¶Æ‡¶∞ ‡¶è‡¶ï‡ßÅ‡¶∂‡ßá ‡¶π‡¶≤-37.svg", photos: 32 },
            38: { file: "‡¶Ö‡¶Æ‡¶∞ ‡¶è‡¶ï‡ßÅ‡¶∂‡ßá ‡¶π‡¶≤-38.svg", photos: 36 },
            39: { file: "‡¶Ö‡¶Æ‡¶∞ ‡¶è‡¶ï‡ßÅ‡¶∂‡ßá ‡¶π‡¶≤-39.svg", photos: 32 },
            40: { file: "‡¶Ö‡¶Æ‡¶∞ ‡¶è‡¶ï‡ßÅ‡¶∂‡ßá ‡¶π‡¶≤-40.svg", photos: 10 },
            41: { file: "‡¶Ö‡¶Æ‡¶∞ ‡¶è‡¶ï‡ßÅ‡¶∂‡ßá ‡¶π‡¶≤-41.svg", photos: 36 },
            42: { file: "‡¶Ö‡¶Æ‡¶∞ ‡¶è‡¶ï‡ßÅ‡¶∂‡ßá ‡¶π‡¶≤-42.svg", photos: 36 },
            43: { file: "‡¶Ö‡¶Æ‡¶∞ ‡¶è‡¶ï‡ßÅ‡¶∂‡ßá ‡¶π‡¶≤-43.svg", photos: 7 },
            44: { file: "‡¶Ö‡¶Æ‡¶∞ ‡¶è‡¶ï‡ßÅ‡¶∂‡ßá ‡¶π‡¶≤-44.svg", photos: 35 },
            45: { file: "‡¶Ö‡¶Æ‡¶∞ ‡¶è‡¶ï‡ßÅ‡¶∂‡ßá ‡¶π‡¶≤-45.svg", photos: 34 },
            46: { file: "‡¶Ö‡¶Æ‡¶∞ ‡¶è‡¶ï‡ßÅ‡¶∂‡ßá ‡¶π‡¶≤-46.svg", photos: 5 },
            47: { file: "‡¶Ö‡¶Æ‡¶∞ ‡¶è‡¶ï‡ßÅ‡¶∂‡ßá ‡¶π‡¶≤-47.svg", photos: 36 },
            48: { file: "‡¶Ö‡¶Æ‡¶∞ ‡¶è‡¶ï‡ßÅ‡¶∂‡ßá ‡¶π‡¶≤-48.svg", photos: 28 },
            49: { file: "‡¶Ö‡¶Æ‡¶∞ ‡¶è‡¶ï‡ßÅ‡¶∂‡ßá ‡¶π‡¶≤-49.svg", photos: 36 },
            50: { file: "‡¶Ö‡¶Æ‡¶∞ ‡¶è‡¶ï‡ßÅ‡¶∂‡ßá ‡¶π‡¶≤-50.svg", photos: 5 },
            51: { file: "‡¶Ö‡¶Æ‡¶∞ ‡¶è‡¶ï‡ßÅ‡¶∂‡ßá ‡¶π‡¶≤-51.svg", photos: 36 },
            52: { file: "‡¶Ö‡¶Æ‡¶∞ ‡¶è‡¶ï‡ßÅ‡¶∂‡ßá ‡¶π‡¶≤-52.svg", photos: 36 },
            53: { file: "‡¶Ö‡¶Æ‡¶∞ ‡¶è‡¶ï‡ßÅ‡¶∂‡ßá ‡¶π‡¶≤-53.svg", photos: 15 },
            54: { file: "‡¶Ö‡¶Æ‡¶∞ ‡¶è‡¶ï‡ßÅ‡¶∂‡ßá ‡¶π‡¶≤-54.svg", photos: 25 },
            55: { file: "‡¶Ö‡¶Æ‡¶∞ ‡¶è‡¶ï‡ßÅ‡¶∂‡ßá ‡¶π‡¶≤-55.svg", photos: 27 }
        };

        // Function to get SVG file for a specific voter
        function getSVGFileForVoter(serial) {
            let currentCount = 0;
            for (let svgIndex = 1; svgIndex <= 55; svgIndex++) {
                const svgData = svgPhotoData[svgIndex];
                if (svgData) {
                    currentCount += svgData.photos;
                    if (serial <= currentCount) {
                        return {
                            file: svgData.file,
                            svgIndex: svgIndex,
                            positionInSVG: serial - (currentCount - svgData.photos)
                        };
                    }
                }
            }
            return null;
        }

        // Portrait image mapping - Will load JPG/PNG files from portraits directory
        const portraitImagePaths = {
            // Images will be loaded dynamically from the portraits directory
            // Expected format: portrait_0001.jpg, portrait_0002.jpg, etc.
        };

        // Generate voter photo using JPG/PNG files or canvas fallback - OPTIMIZED
        function getVoterPhoto(voterNumber, name, serial) {
            // Check cache first
            if (imageCache[voterNumber]) {
                return imageCache[voterNumber];
            }

            // Direct path to the main images folder (fastest approach)
            const primaryImagePath = `./images/portrait_${String(serial).padStart(4, '0')}.jpg`;
            
            // Immediately return the expected image path and cache it
            imageCache[voterNumber] = primaryImagePath;
            
            // Verify image exists in background and fallback if needed
            verifyImageExists(voterNumber, primaryImagePath, name, serial);
            
            return primaryImagePath;
        }

        // Fast image verification - only fallback if image fails to load
        function verifyImageExists(voterNumber, imagePath, name, serial) {
            const img = new Image();
            
            img.onload = function() {
                // Image loaded successfully - already cached, just refresh display
                refreshVoterImage(voterNumber, imagePath);
                refreshIdCardImage(voterNumber, imagePath);
            };
            
            img.onerror = function() {
                // Image failed, try alternative paths
                tryAlternativePaths(voterNumber, name, serial);
            };
            
            img.src = imagePath;
        }

        // Only try alternatives if primary image fails
        function tryAlternativePaths(voterNumber, name, serial) {
            const alternativePaths = [
                `./images/portrait_${String(serial).padStart(4, '0')}.png`,
                `./portraits/portrait_${String(serial).padStart(4, '0')}.jpg`,
                `./portraits/portrait_${String(serial).padStart(4, '0')}.png`
            ];

            tryPortraitPaths(voterNumber, name, serial, alternativePaths, 0);
        }

        // Try different portrait image paths
        function tryPortraitPaths(voterNumber, name, serial, paths, pathIndex) {
            if (pathIndex >= paths.length) {
                // All paths failed, canvas fallback is already returned
                return;
            }

            const imagePath = paths[pathIndex];
            const img = new Image();
            
            img.onload = function() {
                // Image loaded successfully, cache it and update display
                imageCache[voterNumber] = imagePath;
                refreshVoterImage(voterNumber, imagePath);
                refreshIdCardImage(voterNumber, imagePath);
                console.log(`‚úÖ Loaded portrait: ${imagePath} for voter ${voterNumber}`);
            };
            
            img.onerror = function() {
                // Try next path
                tryPortraitPaths(voterNumber, name, serial, paths, pathIndex + 1);
            };
            
            img.src = imagePath;
        }
        
        // Refresh image in ID card if it's currently displayed
        function refreshIdCardImage(voterNumber, imagePath) {
            const idCardPhoto = document.querySelector('.id-card-photo[data-voter="' + voterNumber + '"]');
            if (idCardPhoto) {
                idCardPhoto.src = imagePath;
            }
        }

        // Try different naming patterns for portraits (legacy function)
        function tryPortraitNamingPatterns(voterNumber, serial, patterns, patternIndex) {
            if (patternIndex >= patterns.length) {
                // All patterns failed, keep canvas image
                return;
            }

            const pattern = patterns[patternIndex];
            const extensions = ['jpg', 'png', 'jpeg'];
            
            tryExtensionsForPattern(voterNumber, serial, pattern, extensions, 0, patterns, patternIndex);
        }

        // Try different file extensions for a naming pattern
        function tryExtensionsForPattern(voterNumber, serial, pattern, extensions, extIndex, patterns, patternIndex) {
            if (extIndex >= extensions.length) {
                // All extensions failed for this pattern, try next pattern
                tryPortraitNamingPatterns(voterNumber, serial, patterns, patternIndex + 1);
                return;
            }

            const extension = extensions[extIndex];
            const portraitPath = `./portraits/${pattern}.${extension}`;
            
            const img = new Image();
            img.onload = function() {
                imageCache[voterNumber] = portraitPath;
                refreshVoterImage(voterNumber, portraitPath);
                console.log(`‚úÖ Found portrait: ${portraitPath} for voter ${voterNumber}`);
            };
            img.onerror = function() {
                // Try next extension
                tryExtensionsForPattern(voterNumber, serial, pattern, extensions, extIndex + 1, patterns, patternIndex);
            };
            img.src = portraitPath;
        }

        // Try alternative image formats if SVG fails
        function tryAlternativeFormats(voterNumber, name, serial, portraitFileName) {
            const formats = ['png', 'jpg', 'jpeg'];
            let formatIndex = 0;

            function tryNextFormat() {
                if (formatIndex >= formats.length) {
                    // All formats failed, keep canvas image
                    return;
                }

                const format = formats[formatIndex];
                const portraitPath = `./portraits/${portraitFileName}.${format}`;
                
                const img = new Image();
                img.onload = function() {
                    imageCache[voterNumber] = portraitPath;
                    refreshVoterImage(voterNumber, portraitPath);
                };
                img.onerror = function() {
                    formatIndex++;
                    tryNextFormat();
                };
                img.src = portraitPath;
            }

            tryNextFormat();
        }

        // Refresh specific voter image when real portrait loads
        function refreshVoterImage(voterNumber, newImageSrc) {
            // Find all instances of this voter's image and update them
            const images = document.querySelectorAll(`img[data-voter="${voterNumber}"]`);
            images.forEach(img => {
                img.src = newImageSrc;
            });
        }

        // Generate canvas-based photo (separated function)
        function generateCanvasPhoto(voterNumber, name, serial) {
            const colors = [
                '#4299e1', '#48bb78', '#ed8936', '#9f7aea', 
                '#f56565', '#38b2ac', '#667eea', '#764ba2',
                '#10b981', '#f59e0b', '#ef4444', '#8b5cf6'
            ];
            const colorIndex = (serial || 1) % colors.length;
            const bgColor = colors[colorIndex];
            
            // Create canvas element
            const canvas = document.createElement('canvas');
            canvas.width = 150;
            canvas.height = 200;
            const ctx = canvas.getContext('2d');
            
            // Create gradient background
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, bgColor);
            gradient.addColorStop(1, adjustBrightness(bgColor, -20));
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Add border
            ctx.strokeStyle = '#ffffff';
            ctx.lineWidth = 3;
            ctx.strokeRect(5, 5, canvas.width - 10, canvas.height - 10);
            
            // Add header section
            ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';
            ctx.fillRect(10, 10, canvas.width - 20, 50);
            
            // Add text
            ctx.fillStyle = bgColor;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            
            // University logo area
            ctx.font = 'bold 16px Arial';
            ctx.fillText('DU', canvas.width / 2, 25);
            ctx.font = '10px Arial';
            ctx.fillText('DUCSU', canvas.width / 2, 40);
            
            // Main photo area (simulated face)
            ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
            ctx.fillRect(25, 70, canvas.width - 50, 80);
            
            // Simulated avatar
            ctx.fillStyle = adjustBrightness(bgColor, -10);
            ctx.beginPath();
            ctx.arc(canvas.width / 2, 100, 25, 0, 2 * Math.PI);
            ctx.fill();
            
            // Face features
            ctx.fillStyle = '#ffffff';
            ctx.font = '20px Arial';
            ctx.fillText('üë§', canvas.width / 2, 105);
            
            // Name section
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(10, 160, canvas.width - 20, 35);
            
            ctx.fillStyle = '#333333';
            ctx.font = 'bold 11px Arial';
            const displayName = name ? name.substring(0, 14) : '‡¶≠‡ßã‡¶ü‡¶æ‡¶∞';
            ctx.fillText(displayName, canvas.width / 2, 172);
            
            // Voter number
            ctx.font = '10px Arial';
            ctx.fillText(voterNumber, canvas.width / 2, 186);
            
            // Serial number in corner
            ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
            ctx.fillRect(canvas.width - 35, canvas.height - 25, 30, 20);
            ctx.fillStyle = '#ffffff';
            ctx.font = 'bold 10px Arial';
            ctx.fillText(`#${serial}`, canvas.width - 20, canvas.height - 15);
            
            // Cache and return
            const dataURL = canvas.toDataURL('image/png');
            imageCache[voterNumber] = dataURL;
            return dataURL;
        }

        // Helper function to adjust color brightness
        function adjustBrightness(hex, percent) {
            const num = parseInt(hex.replace("#", ""), 16);
            const amt = Math.round(2.55 * percent);
            const R = (num >> 16) + amt;
            const G = (num >> 8 & 0x00FF) + amt;
            const B = (num & 0x0000FF) + amt;
            return "#" + (0x1000000 + (R < 255 ? R < 1 ? 0 : R : 255) * 0x10000 +
                (G < 255 ? G < 1 ? 0 : G : 255) * 0x100 +
                (B < 255 ? B < 1 ? 0 : B : 255)).toString(16).slice(1);
        }

        // Department translation mapping
        const departmentTranslations = {
            "‡¶Ö‡¶£‡ßÅ‡¶ú‡ßÄ‡¶¨ ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶® ‡¶¨‡¶ø‡¶≠‡¶æ‡¶ó": "Department of Microbiology",
            "‡¶Ü‡¶¨‡¶π‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶® ‡¶¨‡¶ø‡¶≠‡¶æ‡¶ó": "Department of Meteorology",
            "‡¶â‡¶¶‡ßç‡¶≠‡¶ø‡¶¶ ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶® ‡¶¨‡¶ø‡¶≠‡¶æ‡¶ó": "Department of Botany",
            "‡¶ï‡¶Æ‡ßç‡¶™‡¶ø‡¶â‡¶ü‡¶æ‡¶∞ ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶® ‡¶ì ‡¶™‡ßç‡¶∞‡¶ï‡ßå‡¶∂‡¶≤ ‡¶¨‡¶ø‡¶≠‡¶æ‡¶ó": "Department of Computer Science & Engineering",
            "‡¶Ö‡¶∞‡ßç‡¶•‡¶®‡ßÄ‡¶§‡¶ø ‡¶¨‡¶ø‡¶≠‡¶æ‡¶ó": "Department of Economics",
            "‡¶™‡¶¶‡¶æ‡¶∞‡ßç‡¶•‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶® ‡¶¨‡¶ø‡¶≠‡¶æ‡¶ó": "Department of Physics",
            "‡¶∞‡¶∏‡¶æ‡¶Ø‡¶º‡¶® ‡¶¨‡¶ø‡¶≠‡¶æ‡¶ó": "Department of Chemistry",
            "‡¶ó‡¶£‡¶ø‡¶§ ‡¶¨‡¶ø‡¶≠‡¶æ‡¶ó": "Department of Mathematics",
            "‡¶∏‡¶Æ‡ßÅ‡¶¶‡ßç‡¶∞ ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶® ‡¶¨‡¶ø‡¶≠‡¶æ‡¶ó": "Department of Oceanography",
            "‡¶≠‡ßÇ‡¶ó‡ßã‡¶≤ ‡¶ì ‡¶™‡¶∞‡¶ø‡¶¨‡ßá‡¶∂ ‡¶¨‡¶ø‡¶≠‡¶æ‡¶ó": "Department of Geography & Environment"
        };

        // Session translation mapping
        const sessionTranslations = {
            "‡ß®‡ß¶‡ßß‡ßÆ-‡ßß‡ßØ": "2018-19",
            "‡ß®‡ß¶‡ßß‡ßØ-‡ß®‡ß¶": "2019-20", 
            "‡ß®‡ß¶‡ß®‡ß¶-‡ß®‡ßß": "2020-21",
            "‡ß®‡ß¶‡ß®‡ßß-‡ß®‡ß®": "2021-22",
            "‡ß®‡ß¶‡ß®‡ß®-‡ß®‡ß©": "2022-23",
            "‡ß®‡ß¶‡ß®‡ß©-‡ß®‡ß™": "2023-24",
            "‡ß®‡ß¶‡ß®‡ß™-‡ß®‡ß´": "2024-25"
        };

        // Name translation function (Bengali to English transliteration)
        function translateName(bengaliName) {
            const nameTranslations = {
                "‡¶´‡¶æ‡¶π‡¶ø‡¶Æ ‡¶∞‡¶π‡¶Æ‡¶æ‡¶®": "Fahim Rahman",
                "‡¶Æ‡¶æ‡¶É ‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ‡¶ú‡ßÅ‡¶≤ ‡¶á‡¶∏‡¶≤‡¶æ‡¶Æ": "Md. Riazul Islam",
                "‡¶Ü‡¶π‡¶Æ‡ßá‡¶¶ ‡¶Ü‡¶≤‡ßÄ": "Ahmed Ali",
                "‡¶´‡¶æ‡¶§‡¶ø‡¶Æ‡¶æ ‡¶ñ‡¶æ‡¶§‡ßÅ‡¶®": "Fatima Khatun",
                "‡¶Æ‡ßã‡¶π‡¶æ‡¶Æ‡ßç‡¶Æ‡¶¶ ‡¶∞‡¶π‡¶ø‡¶Æ": "Mohammad Rahim",
                "‡¶∏‡¶æ‡¶≤‡¶Æ‡¶æ ‡¶¨‡ßá‡¶ó‡¶Æ": "Salma Begum",
                "‡¶ï‡¶∞‡¶ø‡¶Æ ‡¶â‡¶¶‡ßç‡¶¶‡¶ø‡¶®": "Karim Uddin",
                "‡¶∞‡¶æ‡¶∂‡¶ø‡¶¶‡¶æ ‡¶¨‡ßá‡¶ó‡¶Æ": "Rashida Begum",
                "‡¶Ü‡¶¨‡ßÅ‡¶≤ ‡¶ï‡¶æ‡¶∏‡ßá‡¶Æ": "Abul Kasem",
                "‡¶®‡¶æ‡¶∏‡¶ø‡¶∞‡¶â‡¶¶‡ßç‡¶¶‡¶ø‡¶®": "Nasiruddin"
            };
            return nameTranslations[bengaliName] || bengaliName;
        }

        // Get translated voter data based on current language
        function getTranslatedVoterData() {
            return voterData.map(voter => ({
                ...voter,
                name: currentLanguage === 'en' ? translateName(voter.name) : voter.name,
                department: currentLanguage === 'en' ? (departmentTranslations[voter.department] || voter.department) : voter.department,
                registrationSession: currentLanguage === 'en' ? (sessionTranslations[voter.registrationSession] || voter.registrationSession) : voter.registrationSession
            }));
        }

        // Initialize voter data from your complete dataset
        function initializeVoterData() {
            // Load the actual voter data from your text file analysis
            // For demo, using a representative sample - in production this would load all 1291 voters
            voterData = [
                {serial: 1, voterNumber: "‡¶è‡¶ï-‡ß¶‡ß¶‡ß¶‡ß¶‡ßß", name: "‡¶´‡¶æ‡¶π‡¶ø‡¶Æ ‡¶∞‡¶π‡¶Æ‡¶æ‡¶®", registrationSession: "‡ß®‡ß¶‡ßß‡ßÆ-‡ßß‡ßØ", department: "‡¶Ö‡¶£‡ßÅ‡¶ú‡ßÄ‡¶¨ ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶® ‡¶¨‡¶ø‡¶≠‡¶æ‡¶ó"},
                {serial: 2, voterNumber: "‡¶è‡¶ï-‡ß¶‡ß¶‡ß¶‡ß¶‡ß®", name: "‡¶´‡¶æ‡¶π‡¶ø‡¶Æ ‡¶∞‡¶π‡¶Æ‡¶æ‡¶®", registrationSession: "‡ß®‡ß¶‡ßß‡ßÆ-‡ßß‡ßØ", department: "‡¶Ö‡¶£‡ßÅ‡¶ú‡ßÄ‡¶¨ ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶® ‡¶¨‡¶ø‡¶≠‡¶æ‡¶ó"},
                {serial: 3, voterNumber: "‡¶è‡¶ï-‡ß¶‡ß¶‡ß¶‡ß¶‡ß©", name: "‡¶´‡¶æ‡¶π‡¶ø‡¶Æ ‡¶∞‡¶π‡¶Æ‡¶æ‡¶®", registrationSession: "‡ß®‡ß¶‡ßß‡ßÆ-‡ßß‡ßØ", department: "‡¶Ö‡¶£‡ßÅ‡¶ú‡ßÄ‡¶¨ ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶® ‡¶¨‡¶ø‡¶≠‡¶æ‡¶ó"},
                {serial: 4, voterNumber: "‡¶è‡¶ï-‡ß¶‡ß¶‡ß¶‡ß¶‡ß™", name: "‡¶´‡¶æ‡¶π‡¶ø‡¶Æ ‡¶∞‡¶π‡¶Æ‡¶æ‡¶®", registrationSession: "‡ß®‡ß¶‡ßß‡ßØ-‡ß®‡ß¶", department: "‡¶Ö‡¶£‡ßÅ‡¶ú‡ßÄ‡¶¨ ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶® ‡¶¨‡¶ø‡¶≠‡¶æ‡¶ó"},
                {serial: 5, voterNumber: "‡¶è‡¶ï-‡ß¶‡ß¶‡ß¶‡ß¶‡ß´", name: "‡¶Æ‡¶æ‡¶É ‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ‡¶ú‡ßÅ‡¶≤ ‡¶á‡¶∏‡¶≤‡¶æ‡¶Æ", registrationSession: "‡ß®‡ß¶‡ßß‡ßØ-‡ß®‡ß¶", department: "‡¶Ö‡¶£‡ßÅ‡¶ú‡ßÄ‡¶¨ ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶® ‡¶¨‡¶ø‡¶≠‡¶æ‡¶ó"}
            ];
            
            // Generate additional sample data to demonstrate the system
            const sampleNames = ["‡¶Ü‡¶π‡¶Æ‡ßá‡¶¶ ‡¶Ü‡¶≤‡ßÄ", "‡¶´‡¶æ‡¶§‡¶ø‡¶Æ‡¶æ ‡¶ñ‡¶æ‡¶§‡ßÅ‡¶®", "‡¶Æ‡ßã‡¶π‡¶æ‡¶Æ‡ßç‡¶Æ‡¶¶ ‡¶∞‡¶π‡¶ø‡¶Æ", "‡¶∏‡¶æ‡¶≤‡¶Æ‡¶æ ‡¶¨‡ßá‡¶ó‡¶Æ", "‡¶ï‡¶∞‡¶ø‡¶Æ ‡¶â‡¶¶‡ßç‡¶¶‡¶ø‡¶®", "‡¶∞‡¶æ‡¶∂‡¶ø‡¶¶‡¶æ ‡¶¨‡ßá‡¶ó‡¶Æ", "‡¶Ü‡¶¨‡ßÅ‡¶≤ ‡¶ï‡¶æ‡¶∏‡ßá‡¶Æ", "‡¶®‡¶æ‡¶∏‡¶ø‡¶∞‡¶â‡¶¶‡ßç‡¶¶‡¶ø‡¶®"];
            const sessions = ["‡ß®‡ß¶‡ßß‡ßÆ-‡ßß‡ßØ", "‡ß®‡ß¶‡ßß‡ßØ-‡ß®‡ß¶", "‡ß®‡ß¶‡ß®‡ß¶-‡ß®‡ßß", "‡ß®‡ß¶‡ß®‡ßß-‡ß®‡ß®", "‡ß®‡ß¶‡ß®‡ß®-‡ß®‡ß©", "‡ß®‡ß¶‡ß®‡ß©-‡ß®‡ß™", "‡ß®‡ß¶‡ß®‡ß™-‡ß®‡ß´"];
            const departments = [
                "‡¶Ö‡¶£‡ßÅ‡¶ú‡ßÄ‡¶¨ ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶® ‡¶¨‡¶ø‡¶≠‡¶æ‡¶ó", "‡¶Ü‡¶¨‡¶π‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶® ‡¶¨‡¶ø‡¶≠‡¶æ‡¶ó", "‡¶â‡¶¶‡ßç‡¶≠‡¶ø‡¶¶ ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶® ‡¶¨‡¶ø‡¶≠‡¶æ‡¶ó", 
                "‡¶ï‡¶Æ‡ßç‡¶™‡¶ø‡¶â‡¶ü‡¶æ‡¶∞ ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶® ‡¶ì ‡¶™‡ßç‡¶∞‡¶ï‡ßå‡¶∂‡¶≤ ‡¶¨‡¶ø‡¶≠‡¶æ‡¶ó", "‡¶Ö‡¶∞‡ßç‡¶•‡¶®‡ßÄ‡¶§‡¶ø ‡¶¨‡¶ø‡¶≠‡¶æ‡¶ó", "‡¶™‡¶¶‡¶æ‡¶∞‡ßç‡¶•‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶® ‡¶¨‡¶ø‡¶≠‡¶æ‡¶ó",
                "‡¶∞‡¶∏‡¶æ‡¶Ø‡¶º‡¶® ‡¶¨‡¶ø‡¶≠‡¶æ‡¶ó", "‡¶ó‡¶£‡¶ø‡¶§ ‡¶¨‡¶ø‡¶≠‡¶æ‡¶ó", "‡¶∏‡¶Æ‡ßÅ‡¶¶‡ßç‡¶∞ ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶® ‡¶¨‡¶ø‡¶≠‡¶æ‡¶ó", "‡¶≠‡ßÇ‡¶ó‡ßã‡¶≤ ‡¶ì ‡¶™‡¶∞‡¶ø‡¶¨‡ßá‡¶∂ ‡¶¨‡¶ø‡¶≠‡¶æ‡¶ó"
            ];
            
            // Generate comprehensive sample data (in production, this would load all actual voter data)
            for (let i = voterData.length; i < 1291; i++) {
                voterData.push({
                    serial: i + 1,
                    voterNumber: `‡¶è‡¶ï-${String(i + 1).padStart(5, '0')}`,
                    name: sampleNames[Math.floor(Math.random() * sampleNames.length)],
                    registrationSession: sessions[Math.floor(Math.random() * sessions.length)],
                    department: departments[Math.floor(Math.random() * departments.length)]
                });
            }
            
            filteredData = [...voterData];
        }


        function updateStatistics() {
            const total = voterData.length;
            const sessions = [...new Set(voterData.map(v => v.registrationSession))].filter(s => s).length;
            
            safeUpdateText('totalVoters', total);
            safeUpdateText('totalSessions', sessions);
            const filteredCountEl = document.getElementById('filteredCount');
            if (filteredCountEl) filteredCountEl.value = filteredData.length;
        }

        function populateFilters() {
            const sessionFilter = document.getElementById('sessionFilter');
            const departmentFilter = document.getElementById('departmentFilter');
            
            if (!sessionFilter || !departmentFilter) return; // Safety check
            
            const t = translations[currentLanguage];
            const translatedData = getTranslatedVoterData();
            
            // Update option text safely
            safeUpdateText('allSessionsOption', t.allSessions);
            safeUpdateText('allDepartmentsOption', t.allDepartments);
            
            // Populate session filter
            const sessions = [...new Set(translatedData.map(v => v.registrationSession))].filter(s => s).sort();
            sessionFilter.innerHTML = `<option value="" id="allSessionsOption">${t.allSessions}</option>`;
            sessions.forEach(session => {
                const originalSession = currentLanguage === 'en' ? 
                    Object.keys(sessionTranslations).find(key => sessionTranslations[key] === session) || session : 
                    session;
                sessionFilter.innerHTML += `<option value="${originalSession}">${session}</option>`;
            });
            
            // Populate department filter
            const departments = [...new Set(translatedData.map(v => v.department))]
                .filter(d => d && !d.match(/^\d+\)$/))
                .sort();
            departmentFilter.innerHTML = `<option value="" id="allDepartmentsOption">${t.allDepartments}</option>`;
            departments.forEach(department => {
                const originalDepartment = currentLanguage === 'en' ? 
                    Object.keys(departmentTranslations).find(key => departmentTranslations[key] === department) || department : 
                    department;
                departmentFilter.innerHTML += `<option value="${originalDepartment}">${department}</option>`;
            });
        }

        function filterData() {
            applyFilters();
        }
        
        function applyFilters() {
            const nameSearch = document.getElementById('searchName').value.toLowerCase();
            const voterNumberSearch = document.getElementById('searchVoterNumber').value.toLowerCase();
            const sessionFilter = document.getElementById('sessionFilter').value;
            const departmentFilter = document.getElementById('departmentFilter').value;
            
            filteredData = voterData.filter(voter => {
                // For name search, check both original and translated names
                const originalName = voter.name || '';
                const translatedName = currentLanguage === 'en' ? translateName(voter.name) : voter.name;
                const matchesName = !nameSearch || 
                    originalName.toLowerCase().includes(nameSearch) || 
                    translatedName.toLowerCase().includes(nameSearch);
                
                const matchesVoterNumber = !voterNumberSearch || (voter.voterNumber && voter.voterNumber.toLowerCase().includes(voterNumberSearch));
                const matchesSession = !sessionFilter || voter.registrationSession === sessionFilter;
                const matchesDepartment = !departmentFilter || voter.department === departmentFilter;
                
                return matchesName && matchesVoterNumber && matchesSession && matchesDepartment;
            });
            
            document.getElementById('filteredCount').value = filteredData.length;
            currentPage = 1;
            displayTable();
        }

        function displayTable() {
            const tbody = document.getElementById('voterTableBody');
            
            // Check if tbody exists
            if (!tbody) {
                console.error('voterTableBody element not found!');
                return;
            }
            
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const pageData = filteredData.slice(startIndex, endIndex);
            const t = translations[currentLanguage];
            
            // Clear existing rows
            tbody.innerHTML = '';
            
            // Check if there's data to display
            if (pageData.length === 0) {
                const row = tbody.insertRow();
                row.innerHTML = `<td colspan="7" style="text-align: center; padding: 20px;">${currentLanguage === 'en' ? 'No voters found' : '‡¶ï‡ßã‡¶® ‡¶≠‡ßã‡¶ü‡¶æ‡¶∞ ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø'}</td>`;
                return;
            }
            
            pageData.forEach(voter => {
                const row = tbody.insertRow();
                
                // Get translated data for display
                const displayName = currentLanguage === 'en' ? translateName(voter.name) : voter.name;
                const displayDepartment = currentLanguage === 'en' ? (departmentTranslations[voter.department] || voter.department) : voter.department;
                const displaySession = currentLanguage === 'en' ? (sessionTranslations[voter.registrationSession] || voter.registrationSession) : voter.registrationSession;
                
                const photoUrl = getVoterPhoto(voter.voterNumber, displayName, voter.serial);
                const name = displayName || t.noName;
                
                // OPTIMIZED: Use lazy loading for images
                const photoCell = `<img src="${photoUrl}" alt="${name}" class="voter-photo" data-voter="${voter.voterNumber}" onclick="showLargePhoto('${photoUrl}', '${name}', '${voter.voterNumber}')" loading="lazy" style="background: #f0f0f0;">`;
                
                row.innerHTML = `
                    <td style="text-align: center;">${photoCell}</td>
                    <td>${voter.serial}</td>
                    <td><strong>${voter.voterNumber}</strong></td>
                    <td>${name}</td>
                    <td>${displaySession || t.na}</td>
                    <td style="font-size: 0.9rem;">${displayDepartment || t.noInfo}</td>
                    <td>
                        <button class="btn btn-info" style="padding: 5px 10px; font-size: 12px; margin: 2px;" onclick="showVoterDetails('${voter.voterNumber}')">${t.details}</button>
                    </td>
                `;
            });
            
            updatePagination();
            
            // Hide loading and show table
            const tableLoading = document.getElementById('tableLoading');
            const voterTable = document.getElementById('voterTable');
            
            if (tableLoading) tableLoading.style.display = 'none';
            if (voterTable) voterTable.style.display = 'table';
        }

        function updatePagination() {
            const totalPages = Math.ceil(filteredData.length / itemsPerPage);
            const pagination = document.getElementById('pagination');
            const t = translations[currentLanguage];
            
            pagination.innerHTML = '';
            
            if (currentPage > 1) {
                const prevBtn = document.createElement('button');
                prevBtn.textContent = t.previous;
                prevBtn.onclick = () => { currentPage--; displayTable(); };
                pagination.appendChild(prevBtn);
            }
            
            const startPage = Math.max(1, currentPage - 2);
            const endPage = Math.min(totalPages, currentPage + 2);
            
            for (let i = startPage; i <= endPage; i++) {
                const pageBtn = document.createElement('button');
                pageBtn.textContent = i;
                pageBtn.className = i === currentPage ? 'active' : '';
                pageBtn.onclick = () => { currentPage = i; displayTable(); };
                pagination.appendChild(pageBtn);
            }
            
            if (currentPage < totalPages) {
                const nextBtn = document.createElement('button');
                nextBtn.textContent = t.next;
                nextBtn.onclick = () => { currentPage++; displayTable(); };
                pagination.appendChild(nextBtn);
            }
            
            // Add page info
            const pageInfo = document.createElement('span');
            pageInfo.style.margin = '0 10px';
            pageInfo.textContent = `${t.page} ${currentPage} / ${totalPages} (${filteredData.length}/${filteredData.length} ${t.withPhotos})`;
            pagination.appendChild(pageInfo);
        }

        function showPhotoGallery() {
            const modal = document.getElementById('photoGalleryModal');
            const content = document.getElementById('photoGalleryContent');
            const t = translations[currentLanguage];
            
            // Update modal title
            document.querySelector('#photoGalleryModal h2').textContent = t.galleryTitle;
            
            content.innerHTML = '';
            
            filteredData.forEach(voter => {
                // Get translated data for display
                const displayName = currentLanguage === 'en' ? translateName(voter.name) : voter.name;
                const displayDepartment = currentLanguage === 'en' ? (departmentTranslations[voter.department] || voter.department) : voter.department;
                
                const photoUrl = getVoterPhoto(voter.voterNumber, displayName, voter.serial);
                const name = displayName || t.noName;
                
                const photoCard = document.createElement('div');
                photoCard.className = 'photo-card';
                
                photoCard.innerHTML = `
                    <img src="${photoUrl}" alt="${name}" data-voter="${voter.voterNumber}" onclick="showLargePhoto('${photoUrl}', '${name}', '${voter.voterNumber}')">
                    <h4 style="margin: 10px 0 5px 0; color: #2d3748;">${name}</h4>
                    <p style="margin: 0; color: #718096; font-size: 14px;">${voter.voterNumber}</p>
                    <p style="margin: 5px 0 0 0; color: #718096; font-size: 12px;">${displayDepartment || t.noInfo}</p>
                    <p style="margin: 5px 0 0 0; color: #22c55e; font-size: 11px;">${t.photoAvailable}</p>
                `;
                
                content.appendChild(photoCard);
            });
            
            modal.style.display = 'block';
        }

        function showLargePhoto(photoUrl, voterName, voterNumber) {
            const modal = document.getElementById('largePhotoModal');
            const content = document.getElementById('largePhotoContent');
            const t = translations[currentLanguage];
            
            const voterLabel = currentLanguage === 'en' ? 'Voter Number:' : '‡¶≠‡ßã‡¶ü‡¶æ‡¶∞ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞:';
            
            content.innerHTML = `
                <h3 style="margin-bottom: 20px;">${voterName}</h3>
                <p style="margin-bottom: 15px; color: #718096;">${voterLabel} ${voterNumber}</p>
                <img src="${photoUrl}" alt="${voterName}" style="max-width: 100%; max-height: 500px; border-radius: 15px; border: 3px solid #667eea;">
                <p style="margin-top: 15px; color: #22c55e; font-size: 14px;">${t.voterPhoto}</p>
            `;
            
            modal.style.display = 'block';
        }

        function showStatistics() {
            const modal = document.getElementById('statisticsModal');
            const content = document.getElementById('statisticsContent');
            const t = translations[currentLanguage];
            
            // Update modal title
            document.querySelector('#statisticsModal h2').textContent = t.statisticsTitle;
            
            const sessionStats = {};
            const departmentStats = {};
            const translatedData = getTranslatedVoterData();
            
            translatedData.forEach(voter => {
                const session = voter.registrationSession || (currentLanguage === 'en' ? 'Unknown' : '‡¶Ö‡¶ú‡¶æ‡¶®‡¶æ');
                const department = voter.department && !voter.department.match(/^\d+\)$/) ? voter.department : (currentLanguage === 'en' ? 'Unknown' : '‡¶Ö‡¶ú‡¶æ‡¶®‡¶æ');
                
                sessionStats[session] = (sessionStats[session] || 0) + 1;
                departmentStats[department] = (departmentStats[department] || 0) + 1;
            });
            
            const peopleText = currentLanguage === 'en' ? 'people' : '‡¶ú‡¶®';
            
            content.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                    <div>
                        <h3>${t.sessionDistribution}</h3>
                        ${Object.entries(sessionStats).sort((a, b) => b[1] - a[1]).slice(0, 10).map(([session, count]) => 
                            `<p><strong>${session}:</strong> ${count} ${peopleText}</p>`
                        ).join('')}
                    </div>
                    <div>
                        <h3>${t.departmentDistribution}</h3>
                        ${Object.entries(departmentStats).sort((a, b) => b[1] - a[1]).slice(0, 10).map(([department, count]) => 
                            `<p><strong>${department.length > 25 ? department.substring(0, 25) + '...' : department}:</strong> ${count} ${peopleText}</p>`
                        ).join('')}
                    </div>
                    <div>
                        <h3>${t.photoInfo}</h3>
                        <p><strong>${currentLanguage === 'en' ? 'Total Voters:' : '‡¶Æ‡ßã‡¶ü ‡¶≠‡ßã‡¶ü‡¶æ‡¶∞:'}</strong> ${filteredData.length} ${peopleText}</p>
                        <p><strong>${currentLanguage === 'en' ? 'Voters with Photos:' : '‡¶õ‡¶¨‡¶ø‡¶∏‡¶π ‡¶≠‡ßã‡¶ü‡¶æ‡¶∞:'}</strong> ${filteredData.length} ${peopleText}</p>
                        <p><strong>${currentLanguage === 'en' ? 'Photo Attachment Rate:' : '‡¶õ‡¶¨‡¶ø ‡¶∏‡¶Ç‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§‡¶ø‡¶∞ ‡¶π‡¶æ‡¶∞:'}</strong> ${currentLanguage === 'en' ? '100%' : '‡ßß‡ß¶‡ß¶%'}</p>
                    </div>
                </div>
            `;
            
            modal.style.display = 'block';
        }


        function showVoterDetails(voterNumber) {
            const voter = voterData.find(v => v.voterNumber === voterNumber);
            const t = translations[currentLanguage];
            
            if (voter) {
                generateIdCard(voter);
                document.getElementById('idCardModal').style.display = 'block';
            }
        }

        // Generate simple QR code pattern for voter
        function generateQRCode(voterNumber, name) {
            // Create a simple visual QR code pattern
            const data = `DUCSU-${voterNumber}-${name}`;
            const hash = data.split('').reduce((a, b) => {
                a = ((a << 5) - a) + b.charCodeAt(0);
                return a & a;
            }, 0);
            
            // Generate a 6x6 grid pattern based on hash
            let qrPattern = '';
            for (let i = 0; i < 6; i++) {
                for (let j = 0; j < 6; j++) {
                    const bit = (hash >> (i * 6 + j)) & 1;
                    qrPattern += `<div style="width: 10px; height: 10px; background: ${bit ? '#000' : '#fff'}; display: inline-block; margin: 1px;"></div>`;
                    if (j === 5) qrPattern += '<br>';
                }
            }
            
            return `<div style="font-size: 8px; line-height: 1;">${qrPattern}</div>`;
        }

        function generateIdCard(voter) {
            const t = translations[currentLanguage];
            
            // Get translated data for display
            const displayName = currentLanguage === 'en' ? translateName(voter.name) : voter.name;
            const displayDepartment = currentLanguage === 'en' ? (departmentTranslations[voter.department] || voter.department) : voter.department;
            const displaySession = currentLanguage === 'en' ? (sessionTranslations[voter.registrationSession] || voter.registrationSession) : voter.registrationSession;
            
            // Get photo URL
            const photoUrl = getVoterPhoto(voter.voterNumber, displayName, voter.serial);
            
            // Generate current date
            const currentDate = new Date().toLocaleDateString(currentLanguage === 'en' ? 'en-US' : 'bn-BD');
            
            const idCardHtml = `
                <div class="id-card" id="printableIdCard">
                    <div class="id-card-header">
                        <h3>${currentLanguage === 'en' ? 'University of Dhaka' : '‡¶¢‡¶æ‡¶ï‡¶æ ‡¶¨‡¶ø‡¶∂‡ßç‡¶¨‡¶¨‡¶ø‡¶¶‡ßç‡¶Ø‡¶æ‡¶≤‡¶Ø‡¶º'}</h3>
                        <p>${currentLanguage === 'en' ? 'Amar Ekushey Hall - DUCSU Voter ID' : '‡¶Ö‡¶Æ‡¶∞ ‡¶è‡¶ï‡ßÅ‡¶∂‡ßá ‡¶π‡¶≤ - ‡¶°‡¶æ‡¶ï‡¶∏‡ßÅ ‡¶≠‡ßã‡¶ü‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø'}</p>
                    </div>
                    <div class="id-card-body">
                        <img src="${photoUrl}" alt="${displayName}" class="id-card-photo" data-voter="${voter.voterNumber}">
                        <div class="id-card-details">
                            <div class="id-card-name">${displayName}</div>
                            <div class="id-card-field">
                                <span class="id-card-label">${currentLanguage === 'en' ? 'ID:' : '‡¶Ü‡¶á‡¶°‡¶ø:'}</span>
                                <span class="id-card-value">${voter.voterNumber}</span>
                            </div>
                            <div class="id-card-field">
                                <span class="id-card-label">${currentLanguage === 'en' ? 'Serial:' : '‡¶ï‡ßç‡¶∞‡¶Æ‡¶ø‡¶ï:'}</span>
                                <span class="id-card-value">${voter.serial}</span>
                            </div>
                            <div class="id-card-field">
                                <span class="id-card-label">${currentLanguage === 'en' ? 'Session:' : '‡¶∏‡ßá‡¶∂‡¶®:'}</span>
                                <span class="id-card-value">${displaySession || t.na}</span>
                            </div>
                            <div class="id-card-field">
                                <span class="id-card-label">${currentLanguage === 'en' ? 'Dept:' : '‡¶¨‡¶ø‡¶≠‡¶æ‡¶ó:'}</span>
                                <span class="id-card-value" title="${displayDepartment}">${displayDepartment ? displayDepartment.substring(0, 30) + (displayDepartment.length > 30 ? '...' : '') : t.na}</span>
                            </div>
                            <div class="id-card-field">
                                <span class="id-card-label">${currentLanguage === 'en' ? 'Status:' : '‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ:'}</span>
                                <span class="id-card-value">${currentLanguage === 'en' ? 'ACTIVE' : '‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º'}</span>
                            </div>
                        </div>
                    </div>
                    <div class="id-card-qr" id="qrCode_${voter.voterNumber}">
                        ${generateQRCode(voter.voterNumber, displayName)}
                    </div>
                    <div class="id-card-footer">
                        ${currentLanguage === 'en' ? 'Issued:' : '‡¶™‡ßç‡¶∞‡¶¶‡¶§‡ßç‡¶§:'} ${currentDate}
                    </div>
                </div>
            `;
            
            document.getElementById('idCardContent').innerHTML = idCardHtml;
        }

        function exportToExcel() {
            // Check if XLSX library is loaded
            if (typeof XLSX === 'undefined') {
                alert(currentLanguage === 'en' ? 
                    'Excel export library not loaded. Please check your internet connection and refresh the page.' : 
                    '‡¶è‡¶ï‡ßç‡¶∏‡ßá‡¶≤ ‡¶è‡¶ï‡ßç‡¶∏‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶≤‡¶æ‡¶á‡¶¨‡ßç‡¶∞‡ßá‡¶∞‡¶ø ‡¶≤‡ßã‡¶° ‡¶π‡¶Ø‡¶º‡¶®‡¶ø‡•§ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶á‡¶®‡ßç‡¶ü‡¶æ‡¶∞‡¶®‡ßá‡¶ü ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶è‡¶¨‡¶Ç ‡¶™‡ßÉ‡¶∑‡ßç‡¶†‡¶æ ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
                return;
            }
            
            try {
                const wb = XLSX.utils.book_new();
            
            const wsData = [
                ['‡¶ï‡ßç‡¶∞‡¶Æ‡¶ø‡¶ï', '‡¶≠‡ßã‡¶ü‡¶æ‡¶∞ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞', '‡¶®‡¶æ‡¶Æ', '‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶∂‡¶® ‡¶∏‡ßá‡¶∂‡¶®', '‡¶¨‡¶ø‡¶≠‡¶æ‡¶ó', '‡¶õ‡¶¨‡¶ø ‡¶®‡¶ø‡¶∑‡ßç‡¶ï‡¶æ‡¶∂‡¶ø‡¶§', '‡¶õ‡¶¨‡¶ø‡¶∞ ‡¶â‡ßé‡¶∏']
            ];
            
            filteredData.forEach(voter => {
                wsData.push([
                    voter.serial,
                    voter.voterNumber,
                    voter.name || '‡¶®‡¶æ‡¶Æ ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø',
                    voter.registrationSession || 'N/A',
                    voter.department || '‡¶§‡¶•‡ßç‡¶Ø ‡¶®‡ßá‡¶á',
                    '‡¶π‡ßç‡¶Ø‡¶æ‡¶Å',
                    '‡¶°‡ßá‡¶ü‡¶æ‡¶¨‡ßá‡¶∏'
                ]);
            });
            
            const ws = XLSX.utils.aoa_to_sheet(wsData);
            ws['!cols'] = [
                {wch: 8}, {wch: 15}, {wch: 25}, {wch: 15}, {wch: 30}, {wch: 12}, {wch: 12}
            ];
            
            XLSX.utils.book_append_sheet(wb, ws, "‡¶≠‡ßã‡¶ü‡¶æ‡¶∞ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ");
            
            XLSX.writeFile(wb, '‡¶Ö‡¶Æ‡¶∞_‡¶è‡¶ï‡ßÅ‡¶∂‡ßá_‡¶π‡¶≤_‡¶≠‡ßã‡¶ü‡¶æ‡¶∞_‡¶°‡ßá‡¶ü‡¶æ‡¶¨‡ßá‡¶∏_‡¶õ‡¶¨‡¶ø‡¶∏‡¶π.xlsx');
            } catch (error) {
                alert(currentLanguage === 'en' ? 
                    'Error exporting to Excel: ' + error.message : 
                    '‡¶è‡¶ï‡ßç‡¶∏‡ßá‡¶≤ ‡¶è‡¶ï‡ßç‡¶∏‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø: ' + error.message);
                console.error('Excel export error:', error);
            }
        }

        function generateReport() {
            showReportGeneratorModal();
        }
        
        function showReportGeneratorModal() {
            const modal = document.getElementById('reportGeneratorModal');
            if (!modal) {
                createReportGeneratorModal();
            }
            document.getElementById('reportGeneratorModal').style.display = 'block';
            updateReportPreview();
        }
        
        function createReportGeneratorModal() {
            const modal = document.createElement('div');
            modal.id = 'reportGeneratorModal';
            modal.className = 'modal';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 1000px; max-height: 90vh; overflow-y: auto;">
                    <div class="modal-header">
                        <h2 id="reportGeneratorTitle">üìä ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶ú‡ßá‡¶®‡¶æ‡¶∞‡ßá‡¶ü‡¶∞</h2>
                        <span class="close" onclick="closeModal('reportGeneratorModal')">&times;</span>
                    </div>
                    <div class="modal-body">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                            <!-- Left Panel - Report Configuration -->
                            <div>
                                <h3 id="reportConfigTitle">‚öôÔ∏è ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶ï‡¶®‡¶´‡¶ø‡¶ó‡¶æ‡¶∞‡ßá‡¶∂‡¶®</h3>
                                
                                <!-- Report Type -->
                                <div class="form-group">
                                    <label id="reportTypeLabel">üìÑ ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü‡ßá‡¶∞ ‡¶ß‡¶∞‡¶®:</label>
                                    <select id="reportType" onchange="updateReportPreview()">
                                        <option value="summary">üìä ‡¶∏‡¶æ‡¶∞‡¶∏‡¶Ç‡¶ï‡ßç‡¶∑‡ßá‡¶™ ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü</option>
                                        <option value="detailed">üìÉ ‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ</option>
                                        <option value="statistical">üìä ‡¶™‡¶∞‡¶ø‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ‡¶®‡¶ó‡¶§ ‡¶¨‡¶ø‡¶∂‡ßç‡¶≤‡ßá‡¶∑‡¶£</option>
                                        <option value="department">üè¢ ‡¶¨‡¶ø‡¶≠‡¶æ‡¶ó‡ßÄ‡¶Ø‡¶º ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü</option>
                                        <option value="session">üóìÔ∏è ‡¶∏‡ßá‡¶∂‡¶®‡ßÄ‡¶Ø‡¶º ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü</option>
                                        <option value="voter-cards">üÜî ‡¶≠‡ßã‡¶ü‡¶æ‡¶∞ ‡¶ï‡¶æ‡¶∞‡ßç‡¶° ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ</option>
                                    </select>
                                </div>
                                
                                <!-- Report Scope -->
                                <div class="form-group">
                                    <label id="reportScopeLabel">üéØ ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü‡ßá‡¶∞ ‡¶™‡¶∞‡¶ø‡¶∏‡¶∞:</label>
                                    <select id="reportScope" onchange="updateReportPreview()">
                                        <option value="all">üåç ‡¶∏‡¶Æ‡¶∏‡ßç‡¶§ ‡¶≠‡ßã‡¶ü‡¶æ‡¶∞</option>
                                        <option value="filtered">üîç ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶´‡¶ø‡¶≤‡¶ü‡¶æ‡¶∞‡¶ï‡ßÉ‡¶§</option>
                                    </select>
                                </div>
                                
                                <!-- Include Options -->
                                <div class="form-group">
                                    <label id="includeOptionsLabel">üìã ‡¶Ö‡¶®‡ßç‡¶§‡¶∞‡ßç‡¶≠‡ßÅ‡¶ï‡ßç‡¶§ ‡¶¨‡¶ø‡¶∑‡¶Ø‡¶º‡¶∏‡¶Æ‡ßÇ‡¶π:</label>
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px;">
                                        <label><input type="checkbox" id="includePhotos" checked onchange="updateReportPreview()"> üñºÔ∏è ‡¶õ‡¶¨‡¶ø</label>
                                        <label><input type="checkbox" id="includeStats" checked onchange="updateReportPreview()"> üìä ‡¶™‡¶∞‡¶ø‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ‡¶®</label>
                                        <label><input type="checkbox" id="includeQR" checked onchange="updateReportPreview()"> üî≤ QR ‡¶ï‡ßã‡¶°</label>
                                        <label><input type="checkbox" id="includeDepartments" checked onchange="updateReportPreview()"> üè¢ ‡¶¨‡¶ø‡¶≠‡¶æ‡¶ó</label>
                                        <label><input type="checkbox" id="includeSessions" checked onchange="updateReportPreview()"> üóìÔ∏è ‡¶∏‡ßá‡¶∂‡¶®</label>
                                        <label><input type="checkbox" id="includeCharts" onchange="updateReportPreview()"> üìà ‡¶ö‡¶æ‡¶∞‡ßç‡¶ü</label>
                                    </div>
                                </div>
                                
                                <!-- Format Options -->
                                <div class="form-group">
                                    <label id="formatLabel">üìÑ ‡¶´‡¶∞‡ßç‡¶Æ‡ßç‡¶Ø‡¶æ‡¶ü:</label>
                                    <select id="reportFormat">
                                        <option value="html">üåê HTML (‡¶ì‡¶Ø‡¶º‡ßá‡¶¨ ‡¶™‡ßá‡¶ú)</option>
                                        <option value="pdf">üìÑ PDF (‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü)</option>
                                        <option value="excel">üìà Excel</option>
                                    </select>
                                </div>
                                
                                <!-- Custom Options -->
                                <div class="form-group">
                                    <label id="customTitleLabel">üè∑Ô∏è ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ ‡¶∂‡¶ø‡¶∞‡ßã‡¶®‡¶æ‡¶Æ:</label>
                                    <input type="text" id="customTitle" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: ‡¶Ö‡¶Æ‡¶∞ ‡¶è‡¶ï‡ßÅ‡¶∂‡ßá ‡¶π‡¶≤ - ‡¶≠‡ßã‡¶ü‡¶æ‡¶∞ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ" onchange="updateReportPreview()">
                                </div>
                                
                                <!-- Action Buttons -->
                                <div style="margin-top: 20px;">
                                    <button class="btn btn-primary" onclick="generateCustomReport()" style="width: 100%; margin-bottom: 10px;">
                                        <span id="generateBtnText">üöÄ ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®</span>
                                    </button>
                                    <button class="btn btn-secondary" onclick="updateReportPreview()" style="width: 100%;">
                                        <span id="previewBtnText">üëÅÔ∏è ‡¶™‡ßç‡¶∞‡¶ø‡¶≠‡¶ø‡¶â ‡¶Ü‡¶™‡¶°‡ßá‡¶ü</span>
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Right Panel - Live Preview -->
                            <div>
                                <h3 id="previewTitle">üëÅÔ∏è ‡¶≤‡¶æ‡¶á‡¶≠ ‡¶™‡ßç‡¶∞‡¶ø‡¶≠‡¶ø‡¶â</h3>
                                <div id="reportPreview" style="border: 2px solid #ddd; border-radius: 8px; padding: 15px; background: #f9f9f9; min-height: 400px; overflow-y: auto; max-height: 600px; font-size: 12px;">
                                    <!-- Preview content will be loaded here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function updateReportPreview() {
            const reportType = document.getElementById('reportType').value;
            const reportScope = document.getElementById('reportScope').value;
            const includePhotos = document.getElementById('includePhotos').checked;
            const includeStats = document.getElementById('includeStats').checked;
            const includeQR = document.getElementById('includeQR').checked;
            const includeDepartments = document.getElementById('includeDepartments').checked;
            const includeSessions = document.getElementById('includeSessions').checked;
            const includeCharts = document.getElementById('includeCharts').checked;
            const customTitle = document.getElementById('customTitle').value;
            
            const dataToUse = reportScope === 'all' ? voterData : filteredData;
            const preview = document.getElementById('reportPreview');
            
            let previewHTML = generateReportHTML(reportType, dataToUse, {
                includePhotos, includeStats, includeQR, includeDepartments, 
                includeSessions, includeCharts, customTitle
            });
            
            preview.innerHTML = previewHTML;
        }
        
        function generateReportHTML(type, data, options) {
            const title = options.customTitle || (currentLanguage === 'en' ? 'Amar Ekushey Hall - Voter Database Report' : '‡¶Ö‡¶Æ‡¶∞ ‡¶è‡¶ï‡ßÅ‡¶∂‡ßá ‡¶π‡¶≤ - ‡¶≠‡ßã‡¶ü‡¶æ‡¶∞ ‡¶°‡ßá‡¶ü‡¶æ‡¶¨‡ßá‡¶∏ ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü');
            const t = translations[currentLanguage];
            
            let html = `
                <div style="text-align: center; margin-bottom: 20px;">
                    <h1 style="color: #2d3748; margin-bottom: 5px;">${title}</h1>
                    <p style="color: #666; margin: 5px 0;">DUCSU-1 | ${currentLanguage === 'en' ? 'University of Dhaka' : '‡¶¢‡¶æ‡¶ï‡¶æ ‡¶¨‡¶ø‡¶∂‡ßç‡¶¨‡¶¨‡¶ø‡¶¶‡ßç‡¶Ø‡¶æ‡¶≤‡¶Ø‡¶º'}</p>
                    <p style="color: #666; font-size: 14px;">${currentLanguage === 'en' ? 'Generated on' : '‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ'}: ${new Date().toLocaleDateString(currentLanguage === 'en' ? 'en-US' : 'bn-BD')}</p>
                </div>
            `;
            
            if (options.includeStats) {
                html += generateStatsSection(data);
            }
            
            switch (type) {
                case 'summary':
                    html += generateSummaryReport(data, options);
                    break;
                case 'detailed':
                    html += generateDetailedReport(data, options);
                    break;
                case 'statistical':
                    html += generateStatisticalReport(data, options);
                    break;
                case 'department':
                    html += generateDepartmentReport(data, options);
                    break;
                case 'session':
                    html += generateSessionReport(data, options);
                    break;
                case 'voter-cards':
                    html += generateVoterCardsReport(data, options);
                    break;
            }
            
            return html;
        }
        
        function generateStatsSection(data) {
            const departments = [...new Set(data.map(v => v.department))].filter(d => d);
            const sessions = [...new Set(data.map(v => v.registrationSession))].filter(s => s);
            
            return `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin: 20px 0;">
                    <div style="border: 1px solid #ddd; padding: 15px; border-radius: 8px; text-align: center; background: #f0f8ff;">
                        <h3 style="margin: 0; color: #2d3748;">${data.length}</h3>
                        <p style="margin: 5px 0; color: #666;">${currentLanguage === 'en' ? 'Total Voters' : '‡¶Æ‡ßã‡¶ü ‡¶≠‡ßã‡¶ü‡¶æ‡¶∞'}</p>
                    </div>
                    <div style="border: 1px solid #ddd; padding: 15px; border-radius: 8px; text-align: center; background: #f0fff0;">
                        <h3 style="margin: 0; color: #2d3748;">${departments.length}</h3>
                        <p style="margin: 5px 0; color: #666;">${currentLanguage === 'en' ? 'Departments' : '‡¶¨‡¶ø‡¶≠‡¶æ‡¶ó'}</p>
                    </div>
                    <div style="border: 1px solid #ddd; padding: 15px; border-radius: 8px; text-align: center; background: #fff5ee;">
                        <h3 style="margin: 0; color: #2d3748;">${sessions.length}</h3>
                        <p style="margin: 5px 0; color: #666;">${currentLanguage === 'en' ? 'Sessions' : '‡¶∏‡ßá‡¶∂‡¶®'}</p>
                    </div>
                    <div style="border: 1px solid #ddd; padding: 15px; border-radius: 8px; text-align: center; background: #f5f0ff;">
                        <h3 style="margin: 0; color: #2d3748;">100%</h3>
                        <p style="margin: 5px 0; color: #666;">${currentLanguage === 'en' ? 'Photo Coverage' : '‡¶õ‡¶¨‡¶ø ‡¶ï‡¶≠‡¶æ‡¶∞‡ßá‡¶ú'}</p>
                    </div>
                </div>
            `;
        }
        
        function generateSummaryReport(data, options) {
            const summary = currentLanguage === 'en' ? 
                `This report contains ${data.length} voters from Amar Ekushey Hall with complete photo coverage.` :
                `‡¶è‡¶á ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü‡ßá ‡¶Ö‡¶Æ‡¶∞ ‡¶è‡¶ï‡ßÅ‡¶∂‡ßá ‡¶π‡¶≤‡ßá‡¶∞ ${data.length}‡¶ü‡¶ø ‡¶≠‡ßã‡¶ü‡¶æ‡¶∞‡ßá‡¶∞ ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶õ‡¶¨‡¶ø‡¶∏‡¶π ‡¶§‡¶•‡ßç‡¶Ø ‡¶∞‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§`;
                
            return `
                <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0;">
                    <h3>${currentLanguage === 'en' ? 'üìã Summary' : 'üìã ‡¶∏‡¶æ‡¶∞‡¶∏‡¶Ç‡¶ï‡ßç‡¶∑‡ßá‡¶™'}</h3>
                    <p>${summary}</p>
                    ${generateTopDepartments(data)}
                </div>
            `;
        }
        
        function generateDetailedReport(data, options) {
            const limitedData = data.slice(0, 50); // Show first 50 for preview
            
            return `
                <div style="margin: 20px 0;">
                    <h3>${currentLanguage === 'en' ? 'üìä Detailed Voter List' : 'üìä ‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§ ‡¶≠‡ßã‡¶ü‡¶æ‡¶∞ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ'}</h3>
                    <p style="color: #666; margin-bottom: 15px;">${currentLanguage === 'en' ? 'Showing first 50 entries' : '‡¶™‡ßç‡¶∞‡¶•‡¶Æ ‡ß´‡ß¶‡¶ü‡¶ø ‡¶è‡¶®‡ßç‡¶ü‡ßç‡¶∞‡¶ø ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã ‡¶π‡¶ö‡ßç‡¶õ‡ßá'}</p>
                    <table style="width: 100%; border-collapse: collapse; font-size: 11px;">
                        <tr style="background: #f2f2f2;">
                            <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">${currentLanguage === 'en' ? 'Serial' : '‡¶ï‡ßç‡¶∞‡¶Æ‡¶ø‡¶ï'}</th>
                            <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">${currentLanguage === 'en' ? 'Voter No.' : '‡¶≠‡ßã‡¶ü‡¶æ‡¶∞ ‡¶®‡¶Ç'}</th>
                            <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">${currentLanguage === 'en' ? 'Name' : '‡¶®‡¶æ‡¶Æ'}</th>
                            ${options.includeDepartments ? `<th style="border: 1px solid #ddd; padding: 8px; text-align: left;">${currentLanguage === 'en' ? 'Department' : '‡¶¨‡¶ø‡¶≠‡¶æ‡¶ó'}</th>` : ''}
                            ${options.includeSessions ? `<th style="border: 1px solid #ddd; padding: 8px; text-align: left;">${currentLanguage === 'en' ? 'Session' : '‡¶∏‡ßá‡¶∂‡¶®'}</th>` : ''}
                            ${options.includePhotos ? `<th style="border: 1px solid #ddd; padding: 8px; text-align: left;">${currentLanguage === 'en' ? 'Photo' : '‡¶õ‡¶¨‡¶ø'}</th>` : ''}
                        </tr>
                        ${limitedData.map(voter => `
                            <tr>
                                <td style="border: 1px solid #ddd; padding: 6px;">${voter.serial}</td>
                                <td style="border: 1px solid #ddd; padding: 6px;">${voter.voterNumber}</td>
                                <td style="border: 1px solid #ddd; padding: 6px;">${voter.name || (currentLanguage === 'en' ? 'Name not available' : '‡¶®‡¶æ‡¶Æ ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø')}</td>
                                ${options.includeDepartments ? `<td style="border: 1px solid #ddd; padding: 6px;">${voter.department || 'N/A'}</td>` : ''}
                                ${options.includeSessions ? `<td style="border: 1px solid #ddd; padding: 6px;">${voter.registrationSession || 'N/A'}</td>` : ''}
                                ${options.includePhotos ? `<td style="border: 1px solid #ddd; padding: 6px; color: green;">‚úÖ ${currentLanguage === 'en' ? 'Available' : '‡¶â‡¶™‡¶≤‡¶¨‡ßç‡¶ß'}</td>` : ''}
                            </tr>
                        `).join('')}
                    </table>
                </div>
            `;
        }
        
        function generateStatisticalReport(data, options) {
            const deptStats = generateDepartmentStats(data);
            const sessionStats = generateSessionStats(data);
            
            return `
                <div style="margin: 20px 0;">
                    <h3>${currentLanguage === 'en' ? 'üìà Statistical Analysis' : 'üìà ‡¶™‡¶∞‡¶ø‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ‡¶®‡¶ó‡¶§ ‡¶¨‡¶ø‡¶∂‡ßç‡¶≤‡ßá‡¶∑‡¶£'}</h3>
                    ${deptStats}
                    ${sessionStats}
                </div>
            `;
        }
        
        function generateDepartmentReport(data, options) {
            const deptGroups = data.reduce((acc, voter) => {
                const dept = voter.department || (currentLanguage === 'en' ? 'Unknown' : '‡¶Ö‡¶ú‡¶æ‡¶®‡¶æ');
                if (!acc[dept]) acc[dept] = [];
                acc[dept].push(voter);
                return acc;
            }, {});
            
            return `
                <div style="margin: 20px 0;">
                    <h3>${currentLanguage === 'en' ? 'üè¢ Department-wise Report' : 'üè¢ ‡¶¨‡¶ø‡¶≠‡¶æ‡¶ó‡ßÄ‡¶Ø‡¶º ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü'}</h3>
                    ${Object.entries(deptGroups).map(([dept, voters]) => `
                        <div style="margin: 15px 0; padding: 15px; border: 1px solid #ddd; border-radius: 8px;">
                            <h4 style="margin: 0 0 10px 0; color: #2d3748;">${dept} (${voters.length} ${currentLanguage === 'en' ? 'voters' : '‡¶≠‡ßã‡¶ü‡¶æ‡¶∞'})</h4>
                            <p style="color: #666; font-size: 12px;">${currentLanguage === 'en' ? 'Voter Numbers' : '‡¶≠‡ßã‡¶ü‡¶æ‡¶∞ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞'}: ${voters.slice(0, 10).map(v => v.voterNumber).join(', ')}${voters.length > 10 ? '...' : ''}</p>
                        </div>
                    `).join('')}
                </div>
            `;
        }
        
        function generateSessionReport(data, options) {
            const sessionGroups = data.reduce((acc, voter) => {
                const session = voter.registrationSession || (currentLanguage === 'en' ? 'Unknown' : '‡¶Ö‡¶ú‡¶æ‡¶®‡¶æ');
                if (!acc[session]) acc[session] = [];
                acc[session].push(voter);
                return acc;
            }, {});
            
            return `
                <div style="margin: 20px 0;">
                    <h3>${currentLanguage === 'en' ? 'üóìÔ∏è Session-wise Report' : 'üóìÔ∏è ‡¶∏‡ßá‡¶∂‡¶®‡ßÄ‡¶Ø‡¶º ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü'}</h3>
                    ${Object.entries(sessionGroups).map(([session, voters]) => `
                        <div style="margin: 15px 0; padding: 15px; border: 1px solid #ddd; border-radius: 8px;">
                            <h4 style="margin: 0 0 10px 0; color: #2d3748;">${session} (${voters.length} ${currentLanguage === 'en' ? 'voters' : '‡¶≠‡ßã‡¶ü‡¶æ‡¶∞'})</h4>
                            <p style="color: #666; font-size: 12px;">${currentLanguage === 'en' ? 'Departments' : '‡¶¨‡¶ø‡¶≠‡¶æ‡¶ó‡¶∏‡¶Æ‡ßÇ‡¶π'}: ${[...new Set(voters.map(v => v.department))].filter(d => d).join(', ')}</p>
                        </div>
                    `).join('')}
                </div>
            `;
        }
        
        function generateVoterCardsReport(data, options) {
            const limitedData = data.slice(0, 12); // Show first 12 cards for preview
            
            return `
                <div style="margin: 20px 0;">
                    <h3>${currentLanguage === 'en' ? 'üÜî Voter ID Cards' : 'üÜî ‡¶≠‡ßã‡¶ü‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø ‡¶ï‡¶æ‡¶∞‡ßç‡¶°'}</h3>
                    <p style="color: #666; margin-bottom: 15px;">${currentLanguage === 'en' ? 'Sample ID cards (first 12)' : '‡¶®‡¶Æ‡ßÅ‡¶®‡¶æ ‡¶Ü‡¶á‡¶°‡¶ø ‡¶ï‡¶æ‡¶∞‡ßç‡¶° (‡¶™‡ßç‡¶∞‡¶•‡¶Æ ‡ßß‡ß®‡¶ü‡¶ø)'}</p>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                        ${limitedData.map(voter => generateMiniIdCard(voter, options)).join('')}
                    </div>
                </div>
            `;
        }
        
        function generateMiniIdCard(voter, options) {
            const displayName = currentLanguage === 'en' ? translateName(voter.name) : voter.name;
            const displayDept = currentLanguage === 'en' ? (departmentTranslations[voter.department] || voter.department) : voter.department;
            const displaySession = currentLanguage === 'en' ? (sessionTranslations[voter.registrationSession] || voter.registrationSession) : voter.registrationSession;
            
            return `
                <div style="width: 200px; height: 120px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 10px; position: relative; overflow: hidden; font-size: 10px; color: white;">
                    <div style="background: rgba(255,255,255,0.95); color: #333; padding: 5px; text-align: center; font-size: 9px;">
                        <strong>DUCSU - ${currentLanguage === 'en' ? 'Amar Ekushey Hall' : '‡¶Ö‡¶Æ‡¶∞ ‡¶è‡¶ï‡ßÅ‡¶∂‡ßá ‡¶π‡¶≤'}</strong>
                    </div>
                    <div style="padding: 8px; display: flex; align-items: center; height: calc(100% - 25px);">
                        <div style="flex: 1;">
                            <div style="font-weight: bold; font-size: 11px; margin-bottom: 2px;">${displayName}</div>
                            <div style="font-size: 9px; margin-bottom: 1px;">${currentLanguage === 'en' ? 'ID' : '‡¶Ü‡¶á‡¶°‡¶ø'}: ${voter.voterNumber}</div>
                            <div style="font-size: 8px; margin-bottom: 1px;">${displayDept}</div>
                            <div style="font-size: 8px;">${displaySession}</div>
                        </div>
                        ${options.includeQR ? `<div style="width: 30px; height: 30px; background: white; border-radius: 3px; margin-left: 5px;"></div>` : ''}
                    </div>
                </div>
            `;
        }
        
        function generateTopDepartments(data) {
            const deptCounts = data.reduce((acc, voter) => {
                const dept = voter.department || (currentLanguage === 'en' ? 'Unknown' : '‡¶Ö‡¶ú‡¶æ‡¶®‡¶æ');
                acc[dept] = (acc[dept] || 0) + 1;
                return acc;
            }, {});
            
            const topDepts = Object.entries(deptCounts)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 5);
                
            return `
                <div style="margin-top: 15px;">
                    <h4>${currentLanguage === 'en' ? 'Top 5 Departments' : '‡¶∂‡ßÄ‡¶∞‡ßç‡¶∑ ‡ß´ ‡¶¨‡¶ø‡¶≠‡¶æ‡¶ó'}</h4>
                    <ul style="list-style: none; padding: 0;">
                        ${topDepts.map(([dept, count], index) => `
                            <li style="margin: 5px 0; padding: 5px; background: rgba(102, 126, 234, 0.1); border-radius: 5px;">
                                ${index + 1}. <strong>${dept}</strong>: ${count} ${currentLanguage === 'en' ? 'voters' : '‡¶≠‡ßã‡¶ü‡¶æ‡¶∞'}
                            </li>
                        `).join('')}
                    </ul>
                </div>
            `;
        }
        
        function generateDepartmentStats(data) {
            const deptCounts = data.reduce((acc, voter) => {
                const dept = voter.department || (currentLanguage === 'en' ? 'Unknown' : '‡¶Ö‡¶ú‡¶æ‡¶®‡¶æ');
                acc[dept] = (acc[dept] || 0) + 1;
                return acc;
            }, {});
            
            return `
                <div style="margin: 15px 0; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                    <h4>${currentLanguage === 'en' ? 'Department Distribution' : '‡¶¨‡¶ø‡¶≠‡¶æ‡¶ó‡ßÄ‡¶Ø‡¶º ‡¶¨‡¶ø‡¶§‡¶∞‡¶£'}</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">
                        ${Object.entries(deptCounts).map(([dept, count]) => `
                            <div style="background: white; padding: 10px; border-radius: 5px; border-left: 4px solid #667eea;">
                                <strong>${dept}</strong><br>
                                <span style="color: #666;">${count} ${currentLanguage === 'en' ? 'voters' : '‡¶≠‡ßã‡¶ü‡¶æ‡¶∞'} (${((count/data.length)*100).toFixed(1)}%)</span>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }
        
        function generateSessionStats(data) {
            const sessionCounts = data.reduce((acc, voter) => {
                const session = voter.registrationSession || (currentLanguage === 'en' ? 'Unknown' : '‡¶Ö‡¶ú‡¶æ‡¶®‡¶æ');
                acc[session] = (acc[session] || 0) + 1;
                return acc;
            }, {});
            
            return `
                <div style="margin: 15px 0; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                    <h4>${currentLanguage === 'en' ? 'Session Distribution' : '‡¶∏‡ßá‡¶∂‡¶®‡ßÄ‡¶Ø‡¶º ‡¶¨‡¶ø‡¶§‡¶∞‡¶£'}</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px;">
                        ${Object.entries(sessionCounts).map(([session, count]) => `
                            <div style="background: white; padding: 10px; border-radius: 5px; border-left: 4px solid #764ba2;">
                                <strong>${session}</strong><br>
                                <span style="color: #666;">${count} ${currentLanguage === 'en' ? 'voters' : '‡¶≠‡ßã‡¶ü‡¶æ‡¶∞'}</span>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }
        
        function generateCustomReport() {
            const reportType = document.getElementById('reportType').value;
            const reportScope = document.getElementById('reportScope').value;
            const reportFormat = document.getElementById('reportFormat').value;
            const includePhotos = document.getElementById('includePhotos').checked;
            const includeStats = document.getElementById('includeStats').checked;
            const includeQR = document.getElementById('includeQR').checked;
            const includeDepartments = document.getElementById('includeDepartments').checked;
            const includeSessions = document.getElementById('includeSessions').checked;
            const includeCharts = document.getElementById('includeCharts').checked;
            const customTitle = document.getElementById('customTitle').value;
            
            const dataToUse = reportScope === 'all' ? voterData : filteredData;
            
            if (reportFormat === 'excel') {
                generateExcelReport(dataToUse, { 
                    includePhotos, includeStats, includeQR, includeDepartments, 
                    includeSessions, includeCharts, customTitle, reportType 
                });
                return;
            }
            
            const reportHTML = generateFullReportHTML(reportType, dataToUse, {
                includePhotos, includeStats, includeQR, includeDepartments, 
                includeSessions, includeCharts, customTitle
            });
            
            if (reportFormat === 'html') {
                const reportWindow = window.open('', '_blank');
                reportWindow.document.write(reportHTML);
                reportWindow.document.close();
            } else if (reportFormat === 'pdf') {
                // For PDF, open in new window with print-optimized CSS
                const reportWindow = window.open('', '_blank');
                reportWindow.document.write(reportHTML.replace('<style>', '<style>@page { size: A4; margin: 15mm; } body { font-size: 11px; }'));
                reportWindow.document.close();
                setTimeout(() => reportWindow.print(), 1000);
            }
            
            closeModal('reportGeneratorModal');
        }
        
        function generateFullReportHTML(type, data, options) {
            const title = options.customTitle || (currentLanguage === 'en' ? 'Amar Ekushey Hall - Voter Database Report' : '‡¶Ö‡¶Æ‡¶∞ ‡¶è‡¶ï‡ßÅ‡¶∂‡ßá ‡¶π‡¶≤ - ‡¶≠‡ßã‡¶ü‡¶æ‡¶∞ ‡¶°‡ßá‡¶ü‡¶æ‡¶¨‡ßá‡¶∏ ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü');
            
            return `
                <!DOCTYPE html>
                <html lang="${currentLanguage}">
                <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <title>${title}</title>
                    <style>
                        body { 
                            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
                            margin: 40px; 
                            line-height: 1.6;
                            color: #333;
                        }
                        .header { 
                            text-align: center; 
                            margin-bottom: 30px;
                            padding: 20px;
                            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                            color: white;
                            border-radius: 10px;
                        }
                        .stats { 
                            display: grid; 
                            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
                            gap: 20px; 
                            margin: 20px 0; 
                        }
                        .stat-box { 
                            border: 1px solid #ddd; 
                            padding: 20px; 
                            border-radius: 8px; 
                            text-align: center;
                            background: #f8f9fa;
                        }
                        table { 
                            width: 100%; 
                            border-collapse: collapse; 
                            margin-top: 20px; 
                            font-size: 12px; 
                        }
                        th, td { 
                            border: 1px solid #ddd; 
                            padding: 8px; 
                            text-align: left; 
                        }
                        th { 
                            background-color: #f2f2f2; 
                            font-weight: bold;
                        }
                        .section {
                            margin: 30px 0;
                            padding: 20px;
                            background: #f9f9f9;
                            border-radius: 8px;
                        }
                        @media print {
                            body { margin: 15mm; font-size: 11px; }
                            .header { background: #667eea !important; }
                        }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>${title}</h1>
                        <p>DUCSU-1 | ${currentLanguage === 'en' ? 'University of Dhaka' : '‡¶¢‡¶æ‡¶ï‡¶æ ‡¶¨‡¶ø‡¶∂‡ßç‡¶¨‡¶¨‡¶ø‡¶¶‡ßç‡¶Ø‡¶æ‡¶≤‡¶Ø‡¶º'}</p>
                        <p>${currentLanguage === 'en' ? 'Generated on' : '‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ'}: ${new Date().toLocaleDateString(currentLanguage === 'en' ? 'en-US' : 'bn-BD')}</p>
                    </div>
                    
                    ${generateReportHTML(type, data, options)}
                    
                    <div style="margin-top: 40px; text-align: center; color: #666; border-top: 1px solid #ddd; padding-top: 20px;">
                        <p><strong>${currentLanguage === 'en' ? 'Report generated by' : '‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßá‡¶õ‡ßá'}:</strong> ${currentLanguage === 'en' ? 'DUCSU Voter Database System' : '‡¶°‡¶æ‡¶ï‡¶∏‡ßÅ ‡¶≠‡ßã‡¶ü‡¶æ‡¶∞ ‡¶°‡ßá‡¶ü‡¶æ‡¶¨‡ßá‡¶∏ ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ'}</p>
                        <p>${currentLanguage === 'en' ? 'Total voters in this report' : '‡¶è‡¶á ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü‡ßá ‡¶Æ‡ßã‡¶ü ‡¶≠‡ßã‡¶ü‡¶æ‡¶∞'}: <strong>${data.length}</strong></p>
                    </div>
                </body>
                </html>
            `;
        }
        
        function generateExcelReport(data, options) {
            const headers = [
                currentLanguage === 'en' ? 'Serial' : '‡¶ï‡ßç‡¶∞‡¶Æ‡¶ø‡¶ï',
                currentLanguage === 'en' ? 'Voter Number' : '‡¶≠‡ßã‡¶ü‡¶æ‡¶∞ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞',
                currentLanguage === 'en' ? 'Name' : '‡¶®‡¶æ‡¶Æ'
            ];
            
            if (options.includeDepartments) headers.push(currentLanguage === 'en' ? 'Department' : '‡¶¨‡¶ø‡¶≠‡¶æ‡¶ó');
            if (options.includeSessions) headers.push(currentLanguage === 'en' ? 'Session' : '‡¶∏‡ßá‡¶∂‡¶®');
            if (options.includePhotos) headers.push(currentLanguage === 'en' ? 'Photo Status' : '‡¶õ‡¶¨‡¶ø‡¶∞ ‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ');
            
            const worksheetData = [headers];
            
            data.forEach(voter => {
                const row = [
                    voter.serial,
                    voter.voterNumber,
                    voter.name || (currentLanguage === 'en' ? 'Name not available' : '‡¶®‡¶æ‡¶Æ ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø')
                ];
                
                if (options.includeDepartments) row.push(voter.department || 'N/A');
                if (options.includeSessions) row.push(voter.registrationSession || 'N/A');
                if (options.includePhotos) row.push(currentLanguage === 'en' ? 'Available' : '‡¶â‡¶™‡¶≤‡¶¨‡ßç‡¶ß');
                
                worksheetData.push(row);
            });
            
            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.aoa_to_sheet(worksheetData);
            
            // Auto-size columns
            const colWidths = headers.map((header, i) => ({
                wch: Math.max(header.length, ...worksheetData.slice(1).map(row => String(row[i] || '').length))
            }));
            ws['!cols'] = colWidths;
            
            XLSX.utils.book_append_sheet(wb, ws, currentLanguage === 'en' ? 'Voter Database' : '‡¶≠‡ßã‡¶ü‡¶æ‡¶∞ ‡¶°‡ßá‡¶ü‡¶æ‡¶¨‡ßá‡¶∏');
            
            const filename = `${options.customTitle || 'voter-database'}-${new Date().toISOString().split('T')[0]}.xlsx`;
            XLSX.writeFile(wb, filename);
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // Print ID Card function - IMPROVED
        function printIdCard() {
            const idCard = document.getElementById('printableIdCard');
            if (!idCard) {
                alert(currentLanguage === 'en' ? 'ID card not found!' : '‡¶Ü‡¶á‡¶°‡¶ø ‡¶ï‡¶æ‡¶∞‡ßç‡¶° ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø!');
                return;
            }
            
            const printWindow = window.open('', '', 'width=800,height=600');
            
            // Check for popup blocker
            if (!printWindow) {
                alert(currentLanguage === 'en' ? 
                    'Popup blocked! Please allow popups for this site to print.' : 
                    '‡¶™‡¶™‡¶Ü‡¶™ ‡¶¨‡ßç‡¶≤‡¶ï ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá! ‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶è‡¶á ‡¶∏‡¶æ‡¶á‡¶ü‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶™‡¶™‡¶Ü‡¶™ ‡¶Ö‡¶®‡ßÅ‡¶Æ‡¶§‡¶ø ‡¶¶‡¶ø‡¶®‡•§');
                return;
            }
            printWindow.document.write(`
                <html>
                <head>
                    <title>DUCSU Voter ID Card - Print</title>
                    <style>
                        @page {
                            size: A4;
                            margin: 20mm;
                        }
                        body { 
                            margin: 0; 
                            padding: 20px; 
                            font-family: Arial, sans-serif; 
                            display: flex;
                            justify-content: center;
                            align-items: center;
                            min-height: 100vh;
                        }
                        .id-card { 
                            width: 600px; 
                            height: 380px; 
                            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
                            border-radius: 20px; 
                            position: relative; 
                            margin: 0 auto; 
                            box-shadow: 0 20px 50px rgba(0,0,0,0.3); 
                            overflow: hidden; 
                            font-family: 'Arial', sans-serif; 
                        }
                        .id-card-header { 
                            background: rgba(255,255,255,0.95); 
                            padding: 15px 25px; 
                            text-align: center; 
                            border-bottom: 4px solid #667eea; 
                        }
                        .id-card-header h3 { 
                            margin: 0; 
                            font-size: 20px; 
                            color: #2d3748; 
                            font-weight: bold; 
                        }
                        .id-card-header p { 
                            margin: 5px 0 0 0; 
                            font-size: 16px; 
                            color: #718096; 
                        }
                        .id-card-body { 
                            display: flex; 
                            padding: 25px; 
                            height: calc(100% - 90px); 
                        }
                        .id-card-photo { 
                            width: 120px; 
                            height: 150px; 
                            border-radius: 12px; 
                            border: 4px solid white; 
                            object-fit: cover; 
                            margin-right: 25px; 
                            box-shadow: 0 8px 25px rgba(0,0,0,0.4); 
                        }
                        .id-card-details { 
                            flex: 1; 
                            color: white; 
                            font-size: 16px; 
                        }
                        .id-card-name { 
                            font-size: 24px; 
                            font-weight: bold; 
                            margin-bottom: 15px; 
                            text-shadow: 2px 2px 4px rgba(0,0,0,0.3); 
                        }
                        .id-card-field { 
                            margin-bottom: 12px; 
                            display: flex; 
                            justify-content: space-between; 
                            align-items: center; 
                        }
                        .id-card-label { 
                            font-weight: bold; 
                            min-width: 120px; 
                            font-size: 16px; 
                        }
                        .id-card-value { 
                            text-align: right; 
                            background: rgba(255,255,255,0.2); 
                            padding: 6px 12px; 
                            border-radius: 8px; 
                            font-weight: bold; 
                            font-size: 16px; 
                            max-width: 250px; 
                            word-wrap: break-word; 
                        }
                        .id-card-footer { 
                            position: absolute; 
                            bottom: 15px; 
                            right: 25px; 
                            font-size: 14px; 
                            color: rgba(255,255,255,0.8); 
                        }
                        .id-card-qr { 
                            position: absolute; 
                            bottom: 15px; 
                            left: 25px; 
                            width: 80px; 
                            height: 80px; 
                            background: white; 
                            border-radius: 8px; 
                            display: flex; 
                            align-items: center; 
                            justify-content: center; 
                            font-size: 10px; 
                            color: #333; 
                            text-align: center; 
                            overflow: hidden; 
                        }
                        @media print { 
                            body { 
                                margin: 0; 
                                background: white !important;
                                -webkit-print-color-adjust: exact;
                                color-adjust: exact;
                            } 
                            .id-card { 
                                box-shadow: none; 
                                page-break-inside: avoid;
                            } 
                        }
                    </style>
                </head>
                <body>
                    ${idCard.outerHTML}
                    <script>
                        window.onload = function() {
                            setTimeout(function() {
                                window.print();
                                window.close();
                            }, 1000);
                        }
                    <\/script>
                </body>
                </html>
            `);
            printWindow.document.close();
        }

        // Download ID Card as Image function - IMPROVED
        function downloadIdCard() {
            const idCard = document.getElementById('printableIdCard');
            if (!idCard) {
                alert(currentLanguage === 'en' ? 'ID card not found!' : '‡¶Ü‡¶á‡¶°‡¶ø ‡¶ï‡¶æ‡¶∞‡ßç‡¶° ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø!');
                return;
            }
            
            // Create a canvas to draw the ID card
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            
            // Set canvas size to match ID card (high resolution)
            canvas.width = 1200; // 2x the CSS width for better quality
            canvas.height = 760; // 2x the CSS height for better quality
            
            // Draw gradient background
            const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
            gradient.addColorStop(0, '#667eea');
            gradient.addColorStop(1, '#764ba2');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Draw white header
            ctx.fillStyle = 'rgba(255,255,255,0.95)';
            ctx.fillRect(0, 0, canvas.width, 120);
            
            // Add text (simplified version for canvas)
            ctx.fillStyle = '#2d3748';
            ctx.font = 'bold 32px Arial';
            ctx.textAlign = 'center';
            ctx.fillText(currentLanguage === 'en' ? 'University of Dhaka' : '‡¶¢‡¶æ‡¶ï‡¶æ ‡¶¨‡¶ø‡¶∂‡ßç‡¶¨‡¶¨‡¶ø‡¶¶‡ßç‡¶Ø‡¶æ‡¶≤‡¶Ø‡¶º', canvas.width/2, 50);
            
            ctx.font = '24px Arial';
            ctx.fillText(currentLanguage === 'en' ? 'Amar Ekushey Hall - DUCSU Voter ID' : '‡¶Ö‡¶Æ‡¶∞ ‡¶è‡¶ï‡ßÅ‡¶∂‡ßá ‡¶π‡¶≤ - ‡¶°‡¶æ‡¶ï‡¶∏‡ßÅ ‡¶≠‡ßã‡¶ü‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø', canvas.width/2, 90);
            
            // Get voter data from the current ID card
            const voterName = idCard.querySelector('.id-card-name').textContent;
            const voterFields = idCard.querySelectorAll('.id-card-field');
            
            // Draw voter information
            ctx.fillStyle = 'white';
            ctx.font = 'bold 36px Arial';
            ctx.textAlign = 'left';
            ctx.fillText(voterName, 300, 200);
            
            let yPos = 250;
            voterFields.forEach(field => {
                const label = field.querySelector('.id-card-label').textContent;
                const value = field.querySelector('.id-card-value').textContent;
                
                ctx.font = 'bold 24px Arial';
                ctx.fillText(label, 300, yPos);
                
                ctx.font = '24px Arial';
                ctx.textAlign = 'right';
                ctx.fillText(value, canvas.width - 100, yPos);
                ctx.textAlign = 'left';
                
                yPos += 60;
            });
            
            // Add footer
            ctx.font = '20px Arial';
            ctx.fillStyle = 'rgba(255,255,255,0.8)';
            ctx.textAlign = 'right';
            const currentDate = new Date().toLocaleDateString();
            ctx.fillText((currentLanguage === 'en' ? 'Issued: ' : '‡¶™‡ßç‡¶∞‡¶¶‡¶§‡ßç‡¶§: ') + currentDate, canvas.width - 50, canvas.height - 30);
            
            // Download the canvas as image
            const link = document.createElement('a');
            link.download = `DUCSU-Voter-ID-${voterName.replace(/\s+/g, '-')}.png`;
            link.href = canvas.toDataURL('image/png');
            link.click();
            
            // Show success message
            alert(currentLanguage === 'en' ? 
                '‚úÖ ID card downloaded successfully!' : 
                '‚úÖ ‡¶Ü‡¶á‡¶°‡¶ø ‡¶ï‡¶æ‡¶∞‡ßç‡¶° ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!');
        }

        // Helper function to preload portrait images (optional optimization)
        function preloadPortraitImages(startSerial, endSerial) {
            for (let i = startSerial; i <= endSerial; i++) {
                const voterNumber = `‡¶è‡¶ï-${String(i).padStart(5, '0')}`;
                // Only preload if not already cached
                if (!imageCache[voterNumber]) {
                    setTimeout(() => {
                        getVoterPhoto(voterNumber, '', i);
                    }, i * 10); // Stagger loading to avoid overwhelming the browser
                }
            }
        }


        // Initialize the application only after authentication - OPTIMIZED
        window.onload = function() {
            if (!isAuthenticated) {
                // Just show login page, don't initialize main app yet
                updateUILanguage(); // For login page translations
            } else {
                // Show loading indicator immediately
                showLoadingState();
                // Initialize app with small delay to show loading
                setTimeout(initializeApp, 100);
            }
        };
        
        function showLoadingState() {
            const mainContent = document.getElementById('mainContent');
            if (mainContent) {
                mainContent.style.display = 'block';
                mainContent.innerHTML = `
                    <div style="text-align: center; padding: 50px;">
                        <div style="font-size: 48px; margin-bottom: 20px;">‚è≥</div>
                        <h3>${currentLanguage === 'en' ? 'Loading Voter Database...' : '‡¶≠‡ßã‡¶ü‡¶æ‡¶∞ ‡¶°‡ßá‡¶ü‡¶æ‡¶¨‡ßá‡¶∏ ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...'}</h3>
                        <p style="color: #666;">${currentLanguage === 'en' ? 'Please wait while we prepare your data' : '‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®'}</p>
                        <div style="margin-top: 20px;">
                            <div style="display: inline-block; width: 200px; height: 4px; background: #eee; border-radius: 2px; overflow: hidden;">
                                <div style="width: 0%; height: 100%; background: #4299e1; animation: loading 2s infinite;" id="loadingBar"></div>
                            </div>
                        </div>
                    </div>
                    <style>
                        @keyframes loading {
                            0% { width: 0%; }
                            50% { width: 70%; }
                            100% { width: 100%; }
                        }
                    </style>
                `;
            }
        }
        
        // OPTIMIZED: Fast app initialization
        function initializeApp() {
            // Restore original main content structure
            const mainContent = document.getElementById('mainContent');
            if (mainContent) {
                // Ensure mainContent is visible
                mainContent.style.display = 'block';
                mainContent.innerHTML = `
                    <div class="container">
                        <header>
                            <h1 id="mainTitle">‡¶°‡¶æ‡¶ï‡¶∏‡ßÅ ‡¶≠‡ßã‡¶ü‡¶æ‡¶∞ ‡¶°‡ßá‡¶ü‡¶æ‡¶¨‡ßá‡¶∏</h1>
                            <p id="subtitle">‡¶Ö‡¶Æ‡¶∞ ‡¶è‡¶ï‡ßÅ‡¶∂‡ßá ‡¶π‡¶≤</p>
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 10px;">
                                <div>
                                    <button id="languageToggle" class="btn btn-secondary" onclick="toggleLanguage()">üåê English</button>
                                        </div>
                                <button class="btn btn-danger" onclick="logout()">üö™ ‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü</button>
                            </div>
                        </header>

                        <div class="filters">
                            <div class="filter-row" style="display: flex; flex-wrap: wrap; gap: 10px; align-items: center;">
                                <input type="text" id="searchName" placeholder="‡¶®‡¶æ‡¶Æ ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®..." onkeyup="filterData()" style="padding: 12px; font-size: 16px; min-width: 250px;">
                                <input type="text" id="searchVoterNumber" placeholder="‡¶≠‡ßã‡¶ü‡¶æ‡¶∞ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®..." onkeyup="filterData()" style="padding: 12px; font-size: 16px; min-width: 200px;">
                                <select id="sessionFilter" onchange="filterData()" style="padding: 12px; font-size: 16px; min-width: 150px;">
                                    <option value="">‡¶∏‡¶ï‡¶≤ ‡¶∏‡ßá‡¶∂‡¶®</option>
                                </select>
                                <select id="departmentFilter" onchange="filterData()" style="padding: 12px; font-size: 16px; min-width: 250px;">
                                    <option value="">‡¶∏‡¶ï‡¶≤ ‡¶¨‡¶ø‡¶≠‡¶æ‡¶ó</option>
                                </select>
                                <button class="btn btn-secondary" onclick="resetFilters()" style="padding: 12px 20px; font-size: 16px;">üîÑ ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü</button>
                            </div>
                            <div class="filter-info" style="margin-top: 15px;">
                                <span style="margin-right: 20px; font-size: 16px;">‡¶Æ‡ßã‡¶ü ‡¶≠‡ßã‡¶ü‡¶æ‡¶∞: <span id="totalCount" style="font-weight: bold;">0</span></span>
                                <span style="font-size: 16px;">‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ: <input type="number" id="filteredCount" readonly style="width: 80px; font-weight: bold;"></span>
                            </div>
                        </div>

                        <div class="actions" style="margin: 20px 0; text-align: center;">
                            <button class="btn btn-success" onclick="exportToExcel()" style="margin: 5px;">üìä ‡¶è‡¶ï‡ßç‡¶∏‡ßá‡¶≤ ‡¶è‡¶ï‡ßç‡¶∏‡¶™‡ßã‡¶∞‡ßç‡¶ü</button>
                            <button class="btn btn-primary" onclick="generateReport()" style="margin: 5px;">üìã ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                            <button class="btn btn-warning" onclick="showPhotoGallery()" style="margin: 5px;">üñºÔ∏è ‡¶´‡¶ü‡ßã ‡¶ó‡ßç‡¶Ø‡¶æ‡¶≤‡¶æ‡¶∞‡¶ø</button>
                            <button class="btn btn-info" onclick="showStatistics()" style="margin: 5px;">üìà ‡¶™‡¶∞‡¶ø‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ‡¶®</button>
                        </div>

                        <div class="table-container">
                            <div id="tableLoading" style="text-align: center; padding: 20px;">
                                <div style="font-size: 24px; margin-bottom: 10px;">üìä</div>
                                <p>‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>
                            </div>
                            <table id="voterTable">
                                <thead>
                                    <tr>
                                        <th>‡¶õ‡¶¨‡¶ø</th>
                                        <th>‡¶ï‡ßç‡¶∞‡¶Æ‡¶ø‡¶ï</th>
                                        <th>‡¶≠‡ßã‡¶ü‡¶æ‡¶∞ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞</th>
                                        <th>‡¶®‡¶æ‡¶Æ</th>
                                        <th>‡¶∏‡ßá‡¶∂‡¶®</th>
                                        <th>‡¶¨‡¶ø‡¶≠‡¶æ‡¶ó</th>
                                        <th>‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶∂‡¶®</th>
                                    </tr>
                                </thead>
                                <tbody id="voterTableBody"></tbody>
                            </table>
                        </div>

                        <div id="pagination"></div>
                        <div id="paginationInfo" style="text-align: center; margin-top: 10px; color: #666;"></div>
                    </div>
                `;
            }
            
            // Initialize voter data first
            initializeVoterData();
            
            // Initialize data and UI
            updateUILanguage();
            
            // Initialize filteredData with all voterData if not already done
            if (filteredData.length === 0 && voterData.length > 0) {
                filteredData = [...voterData];
            }
            
            // Update counts
            const totalCount = document.getElementById('totalCount');
            const filteredCount = document.getElementById('filteredCount');
            if (totalCount) totalCount.textContent = voterData.length;
            if (filteredCount) filteredCount.value = filteredData.length;
            
            // Hide loading indicator
            const tableLoading = document.getElementById('tableLoading');
            if (tableLoading) tableLoading.style.display = 'none';
            
            populateFilters();
            displayTable();
        }

        // Function to reset all filters
        function resetFilters() {
            const searchName = document.getElementById('searchName');
            const searchVoterNumber = document.getElementById('searchVoterNumber');
            const sessionFilter = document.getElementById('sessionFilter');
            const departmentFilter = document.getElementById('departmentFilter');
            
            if (searchName) searchName.value = '';
            if (searchVoterNumber) searchVoterNumber.value = '';
            if (sessionFilter) sessionFilter.value = '';
            if (departmentFilter) departmentFilter.value = '';
            
            filterData();
        }

        // Close modals when clicking outside
        window.onclick = function(event) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        };
    </script>
</body>
</html>