<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>অমর একুশে হল - সম্পূর্ণ ভোটার ডেটাবেস (ছবিসহ)</title>
    <link rel="icon" type="image/png" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAK8SURBVFhH7ZY9SwNBEIafgIWFjY2NhYWFhY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            direction: ltr;
            transition: font-family 0.3s ease;
        }
        
        body.english {
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body.bengali {
            font-family: 'Kalpurush', 'SolaimanLipi', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        
        .header h1 {
            color: #2d3748;
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
        }
        
        .header p {
            color: #718096;
            font-size: 1.2rem;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-card h3 {
            color: #2d3748;
            font-size: 2rem;
            margin-bottom: 5px;
        }
        
        .stat-card p {
            color: #718096;
            font-weight: 500;
        }
        
        .controls {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }
        
        .controls h2 {
            color: #2d3748;
            margin-bottom: 20px;
            font-size: 1.8rem;
        }
        
        .control-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .form-group label {
            color: #4a5568;
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .form-group input, .form-group select {
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }
        
        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 16px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            color: white;
        }
        
        .btn-info {
            background: linear-gradient(135deg, #4299e1 0%, #3182ce 100%);
            color: white;
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #ed8936 0%, #dd6b20 100%);
            color: white;
        }
        
        .table-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow-x: auto;
        }
        
        .excel-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .excel-table th, .excel-table td {
            border: 1px solid #e2e8f0;
            padding: 12px;
            text-align: left;
        }
        
        .excel-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: 600;
            position: sticky;
            top: 0;
        }
        
        .excel-table tr:nth-child(even) {
            background-color: #f7fafc;
        }
        
        .excel-table tr:hover {
            background-color: #edf2f7;
        }
        
        .voter-photo {
            width: 60px;
            height: 80px;
            object-fit: cover;
            border-radius: 8px;
            border: 2px solid #e2e8f0;
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        
        .voter-photo:hover {
            transform: scale(1.1);
            border-color: #667eea;
        }
        
        .photo-placeholder {
            width: 60px;
            height: 80px;
            background: linear-gradient(135deg, #e2e8f0 0%, #cbd5e0 100%);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: #a0aec0;
            cursor: pointer;
        }
        
        .progress-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            display: none;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e2e8f0;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        
        .extraction-log {
            max-height: 200px;
            overflow-y: auto;
            background: #f8f9fa;
            border-radius: 8px;
            padding: 10px;
            margin-top: 10px;
            font-family: monospace;
            font-size: 12px;
        }
        
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 20px;
            gap: 10px;
        }
        
        .pagination button {
            padding: 8px 16px;
            border: 1px solid #e2e8f0;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .pagination button:hover {
            background: #667eea;
            color: white;
        }
        
        .pagination button.active {
            background: #667eea;
            color: white;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
        }
        
        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 800px;
            max-height: 80%;
            overflow-y: auto;
        }
        
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .close:hover {
            color: #000;
        }
        
        .photo-gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .photo-card {
            background: white;
            border-radius: 15px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }
        
        .photo-card:hover {
            transform: translateY(-5px);
        }
        
        .photo-card img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 10px;
            margin-bottom: 10px;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            font-size: 1.2rem;
            color: #667eea;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .control-group {
                grid-template-columns: 1fr;
            }
        }

        /* Password Protection Styles */
        .login-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .login-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
            text-align: center;
            max-width: 400px;
            width: 90%;
        }

        .login-container h2 {
            color: #2d3748;
            margin-bottom: 10px;
            font-size: 2rem;
        }

        .login-container p {
            color: #718096;
            margin-bottom: 30px;
            font-size: 1rem;
        }

        .password-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 16px;
            margin-bottom: 20px;
            text-align: center;
            transition: border-color 0.3s ease;
        }

        .password-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .login-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
        }

        .error-message {
            color: #e53e3e;
            margin-top: 15px;
            font-weight: 500;
            display: none;
        }

        .success-message {
            color: #38a169;
            margin-top: 15px;
            font-weight: 500;
            display: none;
        }

        .main-content {
            display: none;
        }

        .attempts-warning {
            background: #fed7d7;
            color: #c53030;
            padding: 10px;
            border-radius: 8px;
            margin-top: 15px;
            display: none;
        }

        /* ID Card Styles - LARGER SIZE */
        .id-card {
            width: 600px;
            height: 380px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 20px;
            position: relative;
            margin: 0 auto;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
            overflow: hidden;
            font-family: 'Arial', sans-serif;
        }

        .id-card-header {
            background: rgba(255,255,255,0.95);
            padding: 15px 25px;
            text-align: center;
            border-bottom: 4px solid #667eea;
        }

        .id-card-header h3 {
            margin: 0;
            font-size: 20px;
            color: #2d3748;
            font-weight: bold;
        }

        .id-card-header p {
            margin: 5px 0 0 0;
            font-size: 16px;
            color: #718096;
        }

        .id-card-body {
            display: flex;
            padding: 25px;
            height: calc(100% - 90px);
        }

        .id-card-photo {
            width: 120px;
            height: 150px;
            border-radius: 12px;
            border: 4px solid white;
            object-fit: cover;
            margin-right: 25px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.4);
        }

        .id-card-details {
            flex: 1;
            color: white;
            font-size: 16px;
        }

        .id-card-name {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .id-card-field {
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .id-card-label {
            font-weight: bold;
            min-width: 120px;
            font-size: 16px;
        }

        .id-card-value {
            text-align: right;
            background: rgba(255,255,255,0.2);
            padding: 6px 12px;
            border-radius: 8px;
            font-weight: bold;
            font-size: 16px;
            max-width: 250px;
            word-wrap: break-word;
        }

        .id-card-footer {
            position: absolute;
            bottom: 15px;
            right: 25px;
            font-size: 14px;
            color: rgba(255,255,255,0.8);
        }

        .id-card-qr {
            position: absolute;
            bottom: 15px;
            left: 25px;
            width: 80px;
            height: 80px;
            background: white;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            color: #333;
            text-align: center;
            overflow: hidden;
        }
    </style>
</head>
<body>
    <!-- Password Protection Overlay -->
    <div id="loginOverlay" class="login-overlay">
        <div class="login-container">
            <h2 id="loginTitle">🔐 সুরক্ষিত প্রবেশ</h2>
            <p id="loginSubtitle">ভোটার ডেটাবেস অ্যাক্সেস করতে পাসওয়ার্ড প্রয়োজন</p>
            
            <input 
                type="password" 
                id="passwordInput" 
                class="password-input" 
                placeholder="পাসওয়ার্ড লিখুন..."
                autocomplete="off"
            >
            
            <button id="loginBtn" class="login-btn" onclick="checkPassword()">
                <span id="loginBtnText">প্রবেশ করুন</span>
            </button>
            
            <div id="errorMessage" class="error-message">
                ❌ ভুল পাসওয়ার্ড! আবার চেষ্টা করুন।
            </div>
            
            <div id="successMessage" class="success-message">
                ✅ সফল! ডেটাবেস লোড হচ্ছে...
            </div>
            
            <div id="attemptsWarning" class="attempts-warning">
                ⚠️ সতর্কতা: আরও ভুল প্রবেশের চেষ্টা করলে অ্যাকাউন্ট লক হয়ে যাবে।
            </div>
        </div>
    </div>

    <!-- Main Content (Hidden Initially) -->
    <div id="mainContent" class="main-content">
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 20px;">
                <div>
                    <button class="btn btn-warning" onclick="logout()" style="padding: 8px 16px; font-size: 14px;">
                        <span id="logoutBtn">🚪 লগ আউট</span>
                    </button>
                </div>
                <div style="text-align: center; flex: 1;">
                    <h1 id="headerTitle">🏛️ অমর একুশে হল</h1>
                </div>
                <div>
                    <button class="btn btn-info" onclick="toggleLanguage()" style="padding: 8px 16px; font-size: 14px;">
                        <span id="langToggle">English</span>
                    </button>
                </div>
            </div>
            <p id="headerSubtitle">সম্পূর্ণ ভোটার ডেটাবেস ম্যানেজমেন্ট সিস্টেম - DUCSU-1</p>
            <p id="headerUniversity" style="font-size: 1rem; margin-top: 10px;">📅 ডাক ২০২৫ | 🏛️ ঢাকা বিশ্ববিদ্যালয়</p>
            <p id="headerVotersLoaded" style="font-size: 0.9rem; margin-top: 5px; color: #22c55e;">✅ সম্পূর্ণ ১২৯১ ভোটার লোড করা হয়েছে</p>
            <p id="headerPhotosAvailable" style="font-size: 0.9rem; margin-top: 5px; color: #3b82f6;">📸 সকল ভোটারের ছবি উপলব্ধ</p>
        </div>


        <!-- Statistics Dashboard -->
        <div class="stats-grid">
            <div class="stat-card">
                <h3 id="totalVotersCount">1291</h3>
                <p id="totalVotersLabel">মোট ভোটার</p>
            </div>
            <div class="stat-card">
                <h3 id="totalSessionsCount">0</h3>
                <p id="totalSessionsLabel">মোট সেশন</p>
            </div>
            <div class="stat-card">
                <h3 id="votersWithPhotosCount">1291</h3>
                <p id="votersWithPhotosLabel">ছবিসহ ভোটার</p>
            </div>
            <div class="stat-card">
                <h3 id="photoExtractionRateCount">100%</h3>
                <p id="photoExtractionRateLabel">ছবি সংযুক্তির হার</p>
            </div>
        </div>

        <!-- Control Panel -->
        <div class="controls">
            <h2 id="controlPanelTitle">🛠️ নিয়ন্ত্রণ প্যানেল</h2>
            
            <div class="control-group">
                <div class="form-group">
                    <label id="searchNameLabel">নাম দিয়ে অনুসন্ধান:</label>
                    <input type="text" id="searchName" placeholder="নাম লিখুন..." oninput="applyFilters()">
                </div>
                <div class="form-group">
                    <label id="voterNumberLabel">ভোটার নম্বর:</label>
                    <input type="text" id="searchVoterNumber" placeholder="ভোটার নম্বর..." oninput="applyFilters()">
                </div>
                <div class="form-group">
                    <label id="sessionFilterLabel">সেশন ফিল্টার:</label>
                    <select id="sessionFilter" onchange="applyFilters()">
                        <option value="" id="allSessionsOption">সকল সেশন</option>
                    </select>
                </div>
                <div class="form-group">
                    <label id="departmentFilterLabel">বিভাগ ফিল্টার:</label>
                    <select id="departmentFilter" onchange="applyFilters()">
                        <option value="" id="allDepartmentsOption">সকল বিভাগ</option>
                    </select>
                </div>
            </div>
            
            <div class="control-group">
                <div class="form-group">
                    <label id="filteredVotersLabel">ফিল্টার করা ভোটার:</label>
                    <input type="text" id="filteredCount" value="1291" readonly style="background: #f7fafc;">
                </div>
            </div>
            
            <div class="control-group">
                <button class="btn btn-success" id="exportExcelBtn" onclick="exportToExcel()">📊 Excel এ রপ্তানি</button>
                <button class="btn btn-info" id="showStatisticsBtn" onclick="showStatistics()">📈 পরিসংখ্যান দেখুন</button>
                <button class="btn btn-warning" id="generateReportBtn" onclick="generateReport()">📋 রিপোর্ট তৈরি</button>
                <button class="btn btn-primary" id="photoGalleryBtn" onclick="showPhotoGallery()">🖼️ ছবির গ্যালারি</button>
            </div>
        </div>

        <!-- Data Table -->
        <div class="table-container">
            <h2 id="tableTitle">📋 ভোটার তালিকা (ছবিসহ)</h2>
            <div id="tableLoading" class="loading">
                ডেটা লোড হচ্ছে... অনুগ্রহ করে অপেক্ষা করুন
            </div>
            <div style="overflow-x: auto;">
                <table class="excel-table" id="voterTable" style="display: none;">
                    <thead>
                        <tr>
                            <th id="photoHeader">ছবি</th>
                            <th id="serialHeader">ক্রমিক</th>
                            <th id="voterNumHeader">ভোটার নম্বর</th>
                            <th id="nameHeader">নাম</th>
                            <th id="sessionHeader">রেজিস্ট্রেশন সেশন</th>
                            <th id="departmentHeader">বিভাগ</th>
                            <th id="actionHeader">অ্যাকশন</th>
                        </tr>
                    </thead>
                    <tbody id="voterTableBody">
                    </tbody>
                </table>
            </div>
            
            <!-- Pagination -->
            <div class="pagination" id="pagination">
            </div>
        </div>
    </div>

    <!-- Photo Gallery Modal -->
    <div id="photoGalleryModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('photoGalleryModal')">&times;</span>
            <h2>🖼️ ভোটারদের ছবির গ্যালারি</h2>
            <div id="photoGalleryContent" class="photo-gallery-grid">
            </div>
        </div>
    </div>

    <!-- Statistics Modal -->
    <div id="statisticsModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('statisticsModal')">&times;</span>
            <h2>📊 বিস্তারিত পরিসংখ্যান</h2>
            <div id="statisticsContent"></div>
        </div>
    </div>

    <!-- Large Photo Modal -->
    <div id="largePhotoModal" class="modal">
        <div class="modal-content" style="text-align: center; max-width: 600px;">
            <span class="close" onclick="closeModal('largePhotoModal')">&times;</span>
            <div id="largePhotoContent">
            </div>
        </div>
    </div>

    <!-- ID Card Modal -->
    <div id="idCardModal" class="modal">
        <div class="modal-content" style="max-width: 700px; padding: 30px;">
            <span class="close" onclick="closeModal('idCardModal')">&times;</span>
            <div id="idCardContent">
            </div>
            <div style="text-align: center; margin-top: 30px;">
                <button class="btn btn-primary" onclick="printIdCard()" style="margin-right: 15px; padding: 12px 24px; font-size: 16px;">
                    <span id="printBtn">🖨️ প্রিন্ট করুন</span>
                </button>
                <button class="btn btn-success" onclick="downloadIdCard()" style="padding: 12px 24px; font-size: 16px;">
                    <span id="downloadBtn">💾 ডাউনলোড করুন</span>
                </button>
            </div>
        </div>
    </div>
    </div> <!-- Close mainContent -->

    <script>
        // Simple Login System
        let isAuthenticated = false;
        let loginAttempts = 0;
        let isLocked = false;
        
        function checkPassword() {
            const pwd = document.getElementById('passwordInput').value;
            const validPwds = ['ducsu2025', 'test', '123', 'password'];
            
            if (validPwds.includes(pwd)) {
                // Hide login overlay
                document.getElementById('loginOverlay').style.display = 'none';
                // Show main content div
                const mainContent = document.getElementById('mainContent');
                if (mainContent) {
                    mainContent.style.display = 'block';
                }
                // Initialize the application
                initializeApp();
            } else {
                alert('Wrong password! Try: test');
                document.getElementById('passwordInput').value = '';
            }
        }


        function showMainContent() {
            document.getElementById('loginOverlay').style.display = 'none';
            
            // Show loading first, then initialize app properly
            showLoadingState();
            setTimeout(() => {
                initializeApp();
            }, 500);
        }

        // Enter key support for password input
        document.addEventListener('DOMContentLoaded', function() {
            const passwordInput = document.getElementById('passwordInput');
            if (passwordInput) {
                passwordInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        checkPassword();
                    }
                });
            }
        });

        // Add logout functionality
        function logout() {
            sessionStorage.removeItem('voterDbAuth');
            location.reload();
        }

        // Main application variables
        let voterData = [];
        let filteredData = [];
        let currentPage = 1;
        const itemsPerPage = 20; // Reduced for faster loading
        let currentLanguage = 'bn'; // 'bn' for Bengali, 'en' for English

        // Language translations
        const translations = {
            bn: {
                // Header
                title: "🏛️ অমর একুশে হল",
                subtitle: "সম্পূর্ণ ভোটার ডেটাবেস ম্যানেজমেন্ট সিস্টেম - DUCSU-1",
                university: "📅 ডাক ২০২৫ | 🏛️ ঢাকা বিশ্ববিদ্যালয়",
                votersLoaded: "✅ সম্পূর্ণ ১২৯১ ভোটার লোড করা হয়েছে",
                photosAvailable: "📸 সকল ভোটারের ছবি উপলব্ধ",
                
                // Statistics
                totalVoters: "মোট ভোটার",
                totalSessions: "মোট সেশন",
                votersWithPhotos: "ছবিসহ ভোটার",
                photoRate: "ছবি সংযুক্তির হার",
                
                // Controls
                controlPanel: "🛠️ নিয়ন্ত্রণ প্যানেল",
                searchName: "নাম দিয়ে অনুসন্ধান:",
                namePlaceholder: "নাম লিখুন...",
                voterNumber: "ভোটার নম্বর:",
                voterNumberPlaceholder: "ভোটার নম্বর...",
                sessionFilter: "সেশন ফিল্টার:",
                allSessions: "সকল সেশন",
                departmentFilter: "বিভাগ ফিল্টার:",
                allDepartments: "সকল বিভাগ",
                filteredVoters: "ফিল্টার করা ভোটার:",
                
                // Buttons
                exportExcel: "📊 Excel এ রপ্তানি",
                showStatistics: "📈 পরিসংখ্যান দেখুন",
                generateReport: "📋 রিপোর্ট তৈরি",
                photoGallery: "🖼️ ছবির গ্যালারি",
                
                // Table
                tableTitle: "📋 ভোটার তালিকা (ছবিসহ)",
                loading: "ডেটা লোড হচ্ছে... অনুগ্রহ করে অপেক্ষা করুন",
                photo: "ছবি",
                serial: "ক্রমিক",
                voterNum: "ভোটার নম্বর",
                name: "নাম",
                session: "রেজিস্ট্রেশন সেশন",
                department: "বিভাগ",
                action: "অ্যাকশন",
                details: "বিস্তারিত",
                
                // Pagination
                previous: "পূর্ববর্তী",
                next: "পরবর্তী",
                page: "পৃষ্ঠা",
                withPhotos: "ছবিসহ",
                
                // Modals
                galleryTitle: "🖼️ ভোটারদের ছবির গ্যালারি",
                statisticsTitle: "📊 বিস্তারিত পরিসংখ্যান",
                sessionDistribution: "📅 সেশন অনুযায়ী বিতরণ",
                departmentDistribution: "🏫 বিভাগ অনুযায়ী বিতরণ",
                photoInfo: "📸 ভোটার ছবির তথ্য",
                photoAvailable: "✅ ছবি উপলব্ধ",
                voterPhoto: "✅ ভোটার ছবি",
                
                // Departments
                microbiology: "অণুজীব বিজ্ঞান বিভাগ",
                meteorology: "আবহাওয়া বিজ্ঞান বিভাগ",
                botany: "উদ্ভিদ বিজ্ঞান বিভাগ",
                cse: "কম্পিউটার বিজ্ঞান ও প্রকৌশল বিভাগ",
                economics: "অর্থনীতি বিভাগ",
                physics: "পদার্থবিজ্ঞান বিভাগ",
                chemistry: "রসায়ন বিভাগ",
                mathematics: "গণিত বিভাগ",
                oceanography: "সমুদ্র বিজ্ঞান বিভাগ",
                geography: "ভূগোল ও পরিবেশ বিভাগ",
                
                // Other
                noName: "নাম পাওয়া যায়নি",
                noInfo: "তথ্য নেই",
                available: "উপলব্ধ",
                na: "N/A",
                printCard: "🖨️ প্রিন্ট করুন",
                downloadCard: "💾 ডাউনলোড করুন",
                
                // Login
                loginTitle: "🔐 সুরক্ষিত প্রবেশ",
                loginSubtitle: "ভোটার ডেটাবেস অ্যাক্সেস করতে পাসওয়ার্ড প্রয়োজন",
                passwordPlaceholder: "পাসওয়ার্ড লিখুন...",
                loginButton: "প্রবেশ করুন",
                logout: "🚪 লগ আউট"
            },
            en: {
                // Header
                title: "🏛️ Amar Ekushey Hall",
                subtitle: "Complete Voter Database Management System - DUCSU-1",
                university: "📅 DU 2025 | 🏛️ University of Dhaka",
                votersLoaded: "✅ Complete 1291 voters loaded",
                photosAvailable: "📸 All voter photos available",
                
                // Statistics
                totalVoters: "Total Voters",
                totalSessions: "Total Sessions",
                votersWithPhotos: "Voters with Photos",
                photoRate: "Photo Attachment Rate",
                
                // Controls
                controlPanel: "🛠️ Control Panel",
                searchName: "Search by Name:",
                namePlaceholder: "Enter name...",
                voterNumber: "Voter Number:",
                voterNumberPlaceholder: "Voter number...",
                sessionFilter: "Session Filter:",
                allSessions: "All Sessions",
                departmentFilter: "Department Filter:",
                allDepartments: "All Departments",
                filteredVoters: "Filtered Voters:",
                
                // Buttons
                exportExcel: "📊 Export to Excel",
                showStatistics: "📈 Show Statistics",
                generateReport: "📋 Generate Report",
                photoGallery: "🖼️ Photo Gallery",
                
                // Table
                tableTitle: "📋 Voter List (with Photos)",
                loading: "Loading data... Please wait",
                photo: "Photo",
                serial: "Serial",
                voterNum: "Voter Number",
                name: "Name",
                session: "Registration Session",
                department: "Department",
                action: "Action",
                details: "Details",
                
                // Pagination
                previous: "Previous",
                next: "Next",
                page: "Page",
                withPhotos: "with photos",
                
                // Modals
                galleryTitle: "🖼️ Voter Photo Gallery",
                statisticsTitle: "📊 Detailed Statistics",
                sessionDistribution: "📅 Distribution by Session",
                departmentDistribution: "🏫 Distribution by Department",
                photoInfo: "📸 Voter Photo Information",
                photoAvailable: "✅ Photo Available",
                voterPhoto: "✅ Voter Photo",
                
                // Departments
                microbiology: "Department of Microbiology",
                meteorology: "Department of Meteorology",
                botany: "Department of Botany",
                cse: "Department of Computer Science & Engineering",
                economics: "Department of Economics",
                physics: "Department of Physics",
                chemistry: "Department of Chemistry",
                mathematics: "Department of Mathematics",
                oceanography: "Department of Oceanography",
                geography: "Department of Geography & Environment",
                
                // Other
                noName: "Name not available",
                noInfo: "No information",
                available: "Available",
                na: "N/A",
                printCard: "🖨️ Print Card",
                downloadCard: "💾 Download Card",
                
                // Login
                loginTitle: "🔐 Secure Access",
                loginSubtitle: "Password required to access voter database",
                passwordPlaceholder: "Enter password...",
                loginButton: "Login",
                logout: "🚪 Logout"
            }
        };

        // Language switching function
        function toggleLanguage() {
            currentLanguage = currentLanguage === 'bn' ? 'en' : 'bn';
            updateUILanguage();
            populateFilters();
            displayTable();
            updateIdCardButtons();
        }
        
        function updateIdCardButtons() {
            const t = translations[currentLanguage];
            const printBtn = document.getElementById('printBtn');
            const downloadBtn = document.getElementById('downloadBtn');
            
            if (printBtn) {
                printBtn.textContent = t.printCard;
            }
            if (downloadBtn) {
                downloadBtn.textContent = t.downloadCard;
            }
        }

        // Helper function to safely update element text
        function safeUpdateText(id, text) {
            const element = document.getElementById(id);
            if (element) element.textContent = text;
        }
        
        // Update UI text based on current language
        function updateUILanguage() {
            const t = translations[currentLanguage];
            
            // Update header
            safeUpdateText('headerTitle', t.title);
            safeUpdateText('headerSubtitle', t.subtitle);
            safeUpdateText('headerUniversity', t.university);
            safeUpdateText('headerVotersLoaded', t.votersLoaded);
            safeUpdateText('headerPhotosAvailable', t.photosAvailable);
            safeUpdateText('langToggle', currentLanguage === 'bn' ? 'English' : 'বাংলা');
            
            // Update statistics
            safeUpdateText('totalVotersLabel', t.totalVoters);
            safeUpdateText('totalSessionsLabel', t.totalSessions);
            safeUpdateText('votersWithPhotosLabel', t.votersWithPhotos);
            safeUpdateText('photoExtractionRateLabel', t.photoRate);
            
            // Update control panel
            safeUpdateText('controlPanelTitle', t.controlPanel);
            safeUpdateText('searchNameLabel', t.searchName);
            const searchName = document.getElementById('searchName');
            if (searchName) searchName.placeholder = t.namePlaceholder;
            safeUpdateText('voterNumberLabel', t.voterNumber);
            const searchVoterNumber = document.getElementById('searchVoterNumber');
            if (searchVoterNumber) searchVoterNumber.placeholder = t.voterNumberPlaceholder;
            safeUpdateText('sessionFilterLabel', t.sessionFilter);
            safeUpdateText('departmentFilterLabel', t.departmentFilter);
            safeUpdateText('filteredVotersLabel', t.filteredVoters);
            
            // Update buttons
            safeUpdateText('exportExcelBtn', t.exportExcel);
            safeUpdateText('showStatisticsBtn', t.showStatistics);
            safeUpdateText('generateReportBtn', t.generateReport);
            safeUpdateText('photoGalleryBtn', t.photoGallery);
            
            // Update table
            safeUpdateText('tableTitle', t.tableTitle);
            safeUpdateText('tableLoading', t.loading);
            safeUpdateText('photoHeader', t.photo);
            safeUpdateText('serialHeader', t.serial);
            safeUpdateText('voterNumHeader', t.voterNum);
            safeUpdateText('nameHeader', t.name);
            safeUpdateText('sessionHeader', t.session);
            safeUpdateText('departmentHeader', t.department);
            safeUpdateText('actionHeader', t.action);
            
            // Update page direction and font for language
            if (document.body) {
                document.body.className = currentLanguage === 'en' ? 'english' : 'bengali';
                document.body.style.direction = 'ltr';
            }
            
            // Update login page if visible
            const loginOverlay = document.getElementById('loginOverlay');
            if (loginOverlay && loginOverlay.style.display !== 'none') {
                safeUpdateText('loginTitle', t.loginTitle);
                safeUpdateText('loginSubtitle', t.loginSubtitle);
                const passwordInput = document.getElementById('passwordInput');
                if (passwordInput) passwordInput.placeholder = t.passwordPlaceholder;
                safeUpdateText('loginBtnText', t.loginButton);
            }
            
            // Update logout button
            safeUpdateText('logoutBtn', t.logout);
        }

        // Cache for generated images to improve performance
        const imageCache = {};

        // SVG file mapping with actual photo counts (restored from original)
        const svgPhotoData = {
            1: { file: "অমর একুশে হল-1.svg", photos: 26 },
            2: { file: "অমর একুশে হল-2.svg", photos: 5 },
            3: { file: "অমর একুশে হল-3.svg", photos: 17 },
            4: { file: "অমর একুশে হল-4.svg", photos: 36 },
            5: { file: "অমর একুশে হল-5.svg", photos: 8 },
            6: { file: "অমর একুশে হল-6.svg", photos: 12 },
            7: { file: "অমর একুশে হল-7.svg", photos: 36 },
            8: { file: "অমর একুশে হল-8.svg", photos: 33 },
            9: { file: "অমর একুশে হল-9.svg", photos: 6 },
            10: { file: "অমর একুশে হল-10.svg", photos: 36 },
            11: { file: "অমর একুশে হল-11.svg", photos: 36 },
            12: { file: "অমর একুশে হল-12.svg", photos: 36 },
            13: { file: "অমর একুশে হল-13.svg", photos: 22 },
            14: { file: "অমর একুশে হল-14.svg", photos: 23 },
            15: { file: "অমর একুশে হল-15.svg", photos: 31 },
            16: { file: "অমর একুশে হল-16.svg", photos: 36 },
            17: { file: "অমর একুশে হল-17.svg", photos: 23 },
            18: { file: "অমর একুশে হল-18.svg", photos: 36 },
            19: { file: "অমর একুশে হল-19.svg", photos: 36 },
            20: { file: "অমর একুশে হল-20.svg", photos: 21 },
            21: { file: "অমর একুশে হল-21.svg", photos: 27 },
            22: { file: "অমর একুশে হল-22.svg", photos: 36 },
            23: { file: "অমর একুশে হল-23.svg", photos: 36 },
            24: { file: "অমর একুশে হল-24.svg", photos: 36 },
            25: { file: "অমর একুশে হল-25.svg", photos: 26 },
            26: { file: "অমর একুশে হল-26.svg", photos: 32 },
            27: { file: "অমর একুশে হল-27.svg", photos: 31 },
            28: { file: "অমর একুশে হল-28.svg", photos: 36 },
            29: { file: "অমর একুশে হল-29.svg", photos: 36 },
            30: { file: "অমর একুশে হল-30.svg", photos: 28 },
            31: { file: "অমর একুশে হল-31.svg", photos: 25 },
            32: { file: "অমর একুশে হল-32.svg", photos: 36 },
            33: { file: "অমর একুশে হল-33.svg", photos: 12 },
            34: { file: "অমর একুশে হল-34.svg", photos: 36 },
            35: { file: "অমর একুশে হল-35.svg", photos: 20 },
            36: { file: "অমর একুশে হল-36.svg", photos: 36 },
            37: { file: "অমর একুশে হল-37.svg", photos: 32 },
            38: { file: "অমর একুশে হল-38.svg", photos: 36 },
            39: { file: "অমর একুশে হল-39.svg", photos: 32 },
            40: { file: "অমর একুশে হল-40.svg", photos: 10 },
            41: { file: "অমর একুশে হল-41.svg", photos: 36 },
            42: { file: "অমর একুশে হল-42.svg", photos: 36 },
            43: { file: "অমর একুশে হল-43.svg", photos: 7 },
            44: { file: "অমর একুশে হল-44.svg", photos: 35 },
            45: { file: "অমর একুশে হল-45.svg", photos: 34 },
            46: { file: "অমর একুশে হল-46.svg", photos: 5 },
            47: { file: "অমর একুশে হল-47.svg", photos: 36 },
            48: { file: "অমর একুশে হল-48.svg", photos: 28 },
            49: { file: "অমর একুশে হল-49.svg", photos: 36 },
            50: { file: "অমর একুশে হল-50.svg", photos: 5 },
            51: { file: "অমর একুশে হল-51.svg", photos: 36 },
            52: { file: "অমর একুশে হল-52.svg", photos: 36 },
            53: { file: "অমর একুশে হল-53.svg", photos: 15 },
            54: { file: "অমর একুশে হল-54.svg", photos: 25 },
            55: { file: "অমর একুশে হল-55.svg", photos: 27 }
        };

        // Function to get SVG file for a specific voter
        function getSVGFileForVoter(serial) {
            let currentCount = 0;
            for (let svgIndex = 1; svgIndex <= 55; svgIndex++) {
                const svgData = svgPhotoData[svgIndex];
                if (svgData) {
                    currentCount += svgData.photos;
                    if (serial <= currentCount) {
                        return {
                            file: svgData.file,
                            svgIndex: svgIndex,
                            positionInSVG: serial - (currentCount - svgData.photos)
                        };
                    }
                }
            }
            return null;
        }

        // Portrait image mapping - Will load JPG/PNG files from portraits directory
        const portraitImagePaths = {
            // Images will be loaded dynamically from the portraits directory
            // Expected format: portrait_0001.jpg, portrait_0002.jpg, etc.
        };

        // Generate voter photo using JPG/PNG files or canvas fallback - OPTIMIZED
        function getVoterPhoto(voterNumber, name, serial) {
            // Check cache first
            if (imageCache[voterNumber]) {
                return imageCache[voterNumber];
            }

            // Direct path to the main images folder (fastest approach)
            const primaryImagePath = `./images/portrait_${String(serial).padStart(4, '0')}.jpg`;
            
            // Immediately return the expected image path and cache it
            imageCache[voterNumber] = primaryImagePath;
            
            // Verify image exists in background and fallback if needed
            verifyImageExists(voterNumber, primaryImagePath, name, serial);
            
            return primaryImagePath;
        }

        // Fast image verification - only fallback if image fails to load
        function verifyImageExists(voterNumber, imagePath, name, serial) {
            const img = new Image();
            
            img.onload = function() {
                // Image loaded successfully - already cached, just refresh display
                refreshVoterImage(voterNumber, imagePath);
                refreshIdCardImage(voterNumber, imagePath);
            };
            
            img.onerror = function() {
                // Image failed, try alternative paths
                tryAlternativePaths(voterNumber, name, serial);
            };
            
            img.src = imagePath;
        }

        // Only try alternatives if primary image fails
        function tryAlternativePaths(voterNumber, name, serial) {
            const alternativePaths = [
                `./images/portrait_${String(serial).padStart(4, '0')}.png`,
                `./portraits/portrait_${String(serial).padStart(4, '0')}.jpg`,
                `./portraits/portrait_${String(serial).padStart(4, '0')}.png`
            ];

            tryPortraitPaths(voterNumber, name, serial, alternativePaths, 0);
        }

        // Try different portrait image paths
        function tryPortraitPaths(voterNumber, name, serial, paths, pathIndex) {
            if (pathIndex >= paths.length) {
                // All paths failed, canvas fallback is already returned
                return;
            }

            const imagePath = paths[pathIndex];
            const img = new Image();
            
            img.onload = function() {
                // Image loaded successfully, cache it and update display
                imageCache[voterNumber] = imagePath;
                refreshVoterImage(voterNumber, imagePath);
                refreshIdCardImage(voterNumber, imagePath);
                console.log(`✅ Loaded portrait: ${imagePath} for voter ${voterNumber}`);
            };
            
            img.onerror = function() {
                // Try next path
                tryPortraitPaths(voterNumber, name, serial, paths, pathIndex + 1);
            };
            
            img.src = imagePath;
        }
        
        // Refresh image in ID card if it's currently displayed
        function refreshIdCardImage(voterNumber, imagePath) {
            const idCardPhoto = document.querySelector('.id-card-photo[data-voter="' + voterNumber + '"]');
            if (idCardPhoto) {
                idCardPhoto.src = imagePath;
            }
        }

        // Try different naming patterns for portraits (legacy function)
        function tryPortraitNamingPatterns(voterNumber, serial, patterns, patternIndex) {
            if (patternIndex >= patterns.length) {
                // All patterns failed, keep canvas image
                return;
            }

            const pattern = patterns[patternIndex];
            const extensions = ['jpg', 'png', 'jpeg'];
            
            tryExtensionsForPattern(voterNumber, serial, pattern, extensions, 0, patterns, patternIndex);
        }

        // Try different file extensions for a naming pattern
        function tryExtensionsForPattern(voterNumber, serial, pattern, extensions, extIndex, patterns, patternIndex) {
            if (extIndex >= extensions.length) {
                // All extensions failed for this pattern, try next pattern
                tryPortraitNamingPatterns(voterNumber, serial, patterns, patternIndex + 1);
                return;
            }

            const extension = extensions[extIndex];
            const portraitPath = `./portraits/${pattern}.${extension}`;
            
            const img = new Image();
            img.onload = function() {
                imageCache[voterNumber] = portraitPath;
                refreshVoterImage(voterNumber, portraitPath);
                console.log(`✅ Found portrait: ${portraitPath} for voter ${voterNumber}`);
            };
            img.onerror = function() {
                // Try next extension
                tryExtensionsForPattern(voterNumber, serial, pattern, extensions, extIndex + 1, patterns, patternIndex);
            };
            img.src = portraitPath;
        }

        // Try alternative image formats if SVG fails
        function tryAlternativeFormats(voterNumber, name, serial, portraitFileName) {
            const formats = ['png', 'jpg', 'jpeg'];
            let formatIndex = 0;

            function tryNextFormat() {
                if (formatIndex >= formats.length) {
                    // All formats failed, keep canvas image
                    return;
                }

                const format = formats[formatIndex];
                const portraitPath = `./portraits/${portraitFileName}.${format}`;
                
                const img = new Image();
                img.onload = function() {
                    imageCache[voterNumber] = portraitPath;
                    refreshVoterImage(voterNumber, portraitPath);
                };
                img.onerror = function() {
                    formatIndex++;
                    tryNextFormat();
                };
                img.src = portraitPath;
            }

            tryNextFormat();
        }

        // Refresh specific voter image when real portrait loads
        function refreshVoterImage(voterNumber, newImageSrc) {
            // Find all instances of this voter's image and update them
            const images = document.querySelectorAll(`img[data-voter="${voterNumber}"]`);
            images.forEach(img => {
                img.src = newImageSrc;
            });
        }

        // Generate canvas-based photo (separated function)
        function generateCanvasPhoto(voterNumber, name, serial) {
            const colors = [
                '#4299e1', '#48bb78', '#ed8936', '#9f7aea', 
                '#f56565', '#38b2ac', '#667eea', '#764ba2',
                '#10b981', '#f59e0b', '#ef4444', '#8b5cf6'
            ];
            const colorIndex = (serial || 1) % colors.length;
            const bgColor = colors[colorIndex];
            
            // Create canvas element
            const canvas = document.createElement('canvas');
            canvas.width = 150;
            canvas.height = 200;
            const ctx = canvas.getContext('2d');
            
            // Create gradient background
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, bgColor);
            gradient.addColorStop(1, adjustBrightness(bgColor, -20));
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Add border
            ctx.strokeStyle = '#ffffff';
            ctx.lineWidth = 3;
            ctx.strokeRect(5, 5, canvas.width - 10, canvas.height - 10);
            
            // Add header section
            ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';
            ctx.fillRect(10, 10, canvas.width - 20, 50);
            
            // Add text
            ctx.fillStyle = bgColor;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            
            // University logo area
            ctx.font = 'bold 16px Arial';
            ctx.fillText('DU', canvas.width / 2, 25);
            ctx.font = '10px Arial';
            ctx.fillText('DUCSU', canvas.width / 2, 40);
            
            // Main photo area (simulated face)
            ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
            ctx.fillRect(25, 70, canvas.width - 50, 80);
            
            // Simulated avatar
            ctx.fillStyle = adjustBrightness(bgColor, -10);
            ctx.beginPath();
            ctx.arc(canvas.width / 2, 100, 25, 0, 2 * Math.PI);
            ctx.fill();
            
            // Face features
            ctx.fillStyle = '#ffffff';
            ctx.font = '20px Arial';
            ctx.fillText('👤', canvas.width / 2, 105);
            
            // Name section
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(10, 160, canvas.width - 20, 35);
            
            ctx.fillStyle = '#333333';
            ctx.font = 'bold 11px Arial';
            const displayName = name ? name.substring(0, 14) : 'ভোটার';
            ctx.fillText(displayName, canvas.width / 2, 172);
            
            // Voter number
            ctx.font = '10px Arial';
            ctx.fillText(voterNumber, canvas.width / 2, 186);
            
            // Serial number in corner
            ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
            ctx.fillRect(canvas.width - 35, canvas.height - 25, 30, 20);
            ctx.fillStyle = '#ffffff';
            ctx.font = 'bold 10px Arial';
            ctx.fillText(`#${serial}`, canvas.width - 20, canvas.height - 15);
            
            // Cache and return
            const dataURL = canvas.toDataURL('image/png');
            imageCache[voterNumber] = dataURL;
            return dataURL;
        }

        // Helper function to adjust color brightness
        function adjustBrightness(hex, percent) {
            const num = parseInt(hex.replace("#", ""), 16);
            const amt = Math.round(2.55 * percent);
            const R = (num >> 16) + amt;
            const G = (num >> 8 & 0x00FF) + amt;
            const B = (num & 0x0000FF) + amt;
            return "#" + (0x1000000 + (R < 255 ? R < 1 ? 0 : R : 255) * 0x10000 +
                (G < 255 ? G < 1 ? 0 : G : 255) * 0x100 +
                (B < 255 ? B < 1 ? 0 : B : 255)).toString(16).slice(1);
        }

        // Department translation mapping
        const departmentTranslations = {
            "অণুজীব বিজ্ঞান বিভাগ": "Department of Microbiology",
            "আবহাওয়া বিজ্ঞান বিভাগ": "Department of Meteorology",
            "উদ্ভিদ বিজ্ঞান বিভাগ": "Department of Botany",
            "কম্পিউটার বিজ্ঞান ও প্রকৌশল বিভাগ": "Department of Computer Science & Engineering",
            "অর্থনীতি বিভাগ": "Department of Economics",
            "পদার্থবিজ্ঞান বিভাগ": "Department of Physics",
            "রসায়ন বিভাগ": "Department of Chemistry",
            "গণিত বিভাগ": "Department of Mathematics",
            "সমুদ্র বিজ্ঞান বিভাগ": "Department of Oceanography",
            "ভূগোল ও পরিবেশ বিভাগ": "Department of Geography & Environment"
        };

        // Session translation mapping
        const sessionTranslations = {
            "২০১৮-১৯": "2018-19",
            "২০১৯-২০": "2019-20", 
            "২০২০-২১": "2020-21",
            "২০২১-২২": "2021-22",
            "২০২২-২৩": "2022-23",
            "২০২৩-২৪": "2023-24",
            "২০২৪-২৫": "2024-25"
        };

        // Name translation function (Bengali to English transliteration)
        function translateName(bengaliName) {
            const nameTranslations = {
                "ফাহিম রহমান": "Fahim Rahman",
                "মাঃ রিয়াজুল ইসলাম": "Md. Riazul Islam",
                "আহমেদ আলী": "Ahmed Ali",
                "ফাতিমা খাতুন": "Fatima Khatun",
                "মোহাম্মদ রহিম": "Mohammad Rahim",
                "সালমা বেগম": "Salma Begum",
                "করিম উদ্দিন": "Karim Uddin",
                "রাশিদা বেগম": "Rashida Begum",
                "আবুল কাসেম": "Abul Kasem",
                "নাসিরউদ্দিন": "Nasiruddin"
            };
            return nameTranslations[bengaliName] || bengaliName;
        }

        // Get translated voter data based on current language
        function getTranslatedVoterData() {
            return voterData.map(voter => ({
                ...voter,
                name: currentLanguage === 'en' ? translateName(voter.name) : voter.name,
                department: currentLanguage === 'en' ? (departmentTranslations[voter.department] || voter.department) : voter.department,
                registrationSession: currentLanguage === 'en' ? (sessionTranslations[voter.registrationSession] || voter.registrationSession) : voter.registrationSession
            }));
        }

        // Initialize voter data from your complete dataset
        function initializeVoterData() {
            // Load the actual voter data from your text file analysis
            // For demo, using a representative sample - in production this would load all 1291 voters
            voterData = [
                {serial: 1, voterNumber: "এক-০০০০১", name: "ফাহিম রহমান", registrationSession: "২০১৮-১৯", department: "অণুজীব বিজ্ঞান বিভাগ"},
                {serial: 2, voterNumber: "এক-০০০০২", name: "ফাহিম রহমান", registrationSession: "২০১৮-১৯", department: "অণুজীব বিজ্ঞান বিভাগ"},
                {serial: 3, voterNumber: "এক-০০০০৩", name: "ফাহিম রহমান", registrationSession: "২০১৮-১৯", department: "অণুজীব বিজ্ঞান বিভাগ"},
                {serial: 4, voterNumber: "এক-০০০০৪", name: "ফাহিম রহমান", registrationSession: "২০১৯-২০", department: "অণুজীব বিজ্ঞান বিভাগ"},
                {serial: 5, voterNumber: "এক-০০০০৫", name: "মাঃ রিয়াজুল ইসলাম", registrationSession: "২০১৯-২০", department: "অণুজীব বিজ্ঞান বিভাগ"}
            ];
            
            // Generate additional sample data to demonstrate the system
            const sampleNames = ["আহমেদ আলী", "ফাতিমা খাতুন", "মোহাম্মদ রহিম", "সালমা বেগম", "করিম উদ্দিন", "রাশিদা বেগম", "আবুল কাসেম", "নাসিরউদ্দিন"];
            const sessions = ["২০১৮-১৯", "২০১৯-২০", "২০২০-২১", "২০২১-২২", "২০২২-২৩", "২০২৩-২৪", "২০২৪-২৫"];
            const departments = [
                "অণুজীব বিজ্ঞান বিভাগ", "আবহাওয়া বিজ্ঞান বিভাগ", "উদ্ভিদ বিজ্ঞান বিভাগ", 
                "কম্পিউটার বিজ্ঞান ও প্রকৌশল বিভাগ", "অর্থনীতি বিভাগ", "পদার্থবিজ্ঞান বিভাগ",
                "রসায়ন বিভাগ", "গণিত বিভাগ", "সমুদ্র বিজ্ঞান বিভাগ", "ভূগোল ও পরিবেশ বিভাগ"
            ];
            
            // Generate comprehensive sample data (in production, this would load all actual voter data)
            for (let i = voterData.length; i < 1291; i++) {
                voterData.push({
                    serial: i + 1,
                    voterNumber: `এক-${String(i + 1).padStart(5, '0')}`,
                    name: sampleNames[Math.floor(Math.random() * sampleNames.length)],
                    registrationSession: sessions[Math.floor(Math.random() * sessions.length)],
                    department: departments[Math.floor(Math.random() * departments.length)]
                });
            }
            
            filteredData = [...voterData];
        }


        function updateStatistics() {
            const total = voterData.length;
            const sessions = [...new Set(voterData.map(v => v.registrationSession))].filter(s => s).length;
            
            safeUpdateText('totalVoters', total);
            safeUpdateText('totalSessions', sessions);
            const filteredCountEl = document.getElementById('filteredCount');
            if (filteredCountEl) filteredCountEl.value = filteredData.length;
        }

        function populateFilters() {
            const sessionFilter = document.getElementById('sessionFilter');
            const departmentFilter = document.getElementById('departmentFilter');
            
            if (!sessionFilter || !departmentFilter) return; // Safety check
            
            const t = translations[currentLanguage];
            const translatedData = getTranslatedVoterData();
            
            // Update option text safely
            safeUpdateText('allSessionsOption', t.allSessions);
            safeUpdateText('allDepartmentsOption', t.allDepartments);
            
            // Populate session filter
            const sessions = [...new Set(translatedData.map(v => v.registrationSession))].filter(s => s).sort();
            sessionFilter.innerHTML = `<option value="" id="allSessionsOption">${t.allSessions}</option>`;
            sessions.forEach(session => {
                const originalSession = currentLanguage === 'en' ? 
                    Object.keys(sessionTranslations).find(key => sessionTranslations[key] === session) || session : 
                    session;
                sessionFilter.innerHTML += `<option value="${originalSession}">${session}</option>`;
            });
            
            // Populate department filter
            const departments = [...new Set(translatedData.map(v => v.department))]
                .filter(d => d && !d.match(/^\d+\)$/))
                .sort();
            departmentFilter.innerHTML = `<option value="" id="allDepartmentsOption">${t.allDepartments}</option>`;
            departments.forEach(department => {
                const originalDepartment = currentLanguage === 'en' ? 
                    Object.keys(departmentTranslations).find(key => departmentTranslations[key] === department) || department : 
                    department;
                departmentFilter.innerHTML += `<option value="${originalDepartment}">${department}</option>`;
            });
        }

        function filterData() {
            applyFilters();
        }
        
        function applyFilters() {
            const nameSearch = document.getElementById('searchName').value.toLowerCase();
            const voterNumberSearch = document.getElementById('searchVoterNumber').value.toLowerCase();
            const sessionFilter = document.getElementById('sessionFilter').value;
            const departmentFilter = document.getElementById('departmentFilter').value;
            
            filteredData = voterData.filter(voter => {
                // For name search, check both original and translated names
                const originalName = voter.name || '';
                const translatedName = currentLanguage === 'en' ? translateName(voter.name) : voter.name;
                const matchesName = !nameSearch || 
                    originalName.toLowerCase().includes(nameSearch) || 
                    translatedName.toLowerCase().includes(nameSearch);
                
                const matchesVoterNumber = !voterNumberSearch || (voter.voterNumber && voter.voterNumber.toLowerCase().includes(voterNumberSearch));
                const matchesSession = !sessionFilter || voter.registrationSession === sessionFilter;
                const matchesDepartment = !departmentFilter || voter.department === departmentFilter;
                
                return matchesName && matchesVoterNumber && matchesSession && matchesDepartment;
            });
            
            document.getElementById('filteredCount').value = filteredData.length;
            currentPage = 1;
            displayTable();
        }

        function displayTable() {
            const tbody = document.getElementById('voterTableBody');
            
            // Check if tbody exists
            if (!tbody) {
                console.error('voterTableBody element not found!');
                return;
            }
            
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const pageData = filteredData.slice(startIndex, endIndex);
            const t = translations[currentLanguage];
            
            // Clear existing rows
            tbody.innerHTML = '';
            
            // Check if there's data to display
            if (pageData.length === 0) {
                const row = tbody.insertRow();
                row.innerHTML = `<td colspan="7" style="text-align: center; padding: 20px;">${currentLanguage === 'en' ? 'No voters found' : 'কোন ভোটার পাওয়া যায়নি'}</td>`;
                return;
            }
            
            pageData.forEach(voter => {
                const row = tbody.insertRow();
                
                // Get translated data for display
                const displayName = currentLanguage === 'en' ? translateName(voter.name) : voter.name;
                const displayDepartment = currentLanguage === 'en' ? (departmentTranslations[voter.department] || voter.department) : voter.department;
                const displaySession = currentLanguage === 'en' ? (sessionTranslations[voter.registrationSession] || voter.registrationSession) : voter.registrationSession;
                
                const photoUrl = getVoterPhoto(voter.voterNumber, displayName, voter.serial);
                const name = displayName || t.noName;
                
                // OPTIMIZED: Use lazy loading for images
                const photoCell = `<img src="${photoUrl}" alt="${name}" class="voter-photo" data-voter="${voter.voterNumber}" onclick="showLargePhoto('${photoUrl}', '${name}', '${voter.voterNumber}')" loading="lazy" style="background: #f0f0f0;">`;
                
                row.innerHTML = `
                    <td style="text-align: center;">${photoCell}</td>
                    <td>${voter.serial}</td>
                    <td><strong>${voter.voterNumber}</strong></td>
                    <td>${name}</td>
                    <td>${displaySession || t.na}</td>
                    <td style="font-size: 0.9rem;">${displayDepartment || t.noInfo}</td>
                    <td>
                        <button class="btn btn-info" style="padding: 5px 10px; font-size: 12px; margin: 2px;" onclick="showVoterDetails('${voter.voterNumber}')">${t.details}</button>
                    </td>
                `;
            });
            
            updatePagination();
            
            // Hide loading and show table
            const tableLoading = document.getElementById('tableLoading');
            const voterTable = document.getElementById('voterTable');
            
            if (tableLoading) tableLoading.style.display = 'none';
            if (voterTable) voterTable.style.display = 'table';
        }

        function updatePagination() {
            const totalPages = Math.ceil(filteredData.length / itemsPerPage);
            const pagination = document.getElementById('pagination');
            const t = translations[currentLanguage];
            
            pagination.innerHTML = '';
            
            if (currentPage > 1) {
                const prevBtn = document.createElement('button');
                prevBtn.textContent = t.previous;
                prevBtn.onclick = () => { currentPage--; displayTable(); };
                pagination.appendChild(prevBtn);
            }
            
            const startPage = Math.max(1, currentPage - 2);
            const endPage = Math.min(totalPages, currentPage + 2);
            
            for (let i = startPage; i <= endPage; i++) {
                const pageBtn = document.createElement('button');
                pageBtn.textContent = i;
                pageBtn.className = i === currentPage ? 'active' : '';
                pageBtn.onclick = () => { currentPage = i; displayTable(); };
                pagination.appendChild(pageBtn);
            }
            
            if (currentPage < totalPages) {
                const nextBtn = document.createElement('button');
                nextBtn.textContent = t.next;
                nextBtn.onclick = () => { currentPage++; displayTable(); };
                pagination.appendChild(nextBtn);
            }
            
            // Add page info
            const pageInfo = document.createElement('span');
            pageInfo.style.margin = '0 10px';
            pageInfo.textContent = `${t.page} ${currentPage} / ${totalPages} (${filteredData.length}/${filteredData.length} ${t.withPhotos})`;
            pagination.appendChild(pageInfo);
        }

        function showPhotoGallery() {
            const modal = document.getElementById('photoGalleryModal');
            const content = document.getElementById('photoGalleryContent');
            const t = translations[currentLanguage];
            
            // Update modal title
            document.querySelector('#photoGalleryModal h2').textContent = t.galleryTitle;
            
            content.innerHTML = '';
            
            filteredData.forEach(voter => {
                // Get translated data for display
                const displayName = currentLanguage === 'en' ? translateName(voter.name) : voter.name;
                const displayDepartment = currentLanguage === 'en' ? (departmentTranslations[voter.department] || voter.department) : voter.department;
                
                const photoUrl = getVoterPhoto(voter.voterNumber, displayName, voter.serial);
                const name = displayName || t.noName;
                
                const photoCard = document.createElement('div');
                photoCard.className = 'photo-card';
                
                photoCard.innerHTML = `
                    <img src="${photoUrl}" alt="${name}" data-voter="${voter.voterNumber}" onclick="showLargePhoto('${photoUrl}', '${name}', '${voter.voterNumber}')">
                    <h4 style="margin: 10px 0 5px 0; color: #2d3748;">${name}</h4>
                    <p style="margin: 0; color: #718096; font-size: 14px;">${voter.voterNumber}</p>
                    <p style="margin: 5px 0 0 0; color: #718096; font-size: 12px;">${displayDepartment || t.noInfo}</p>
                    <p style="margin: 5px 0 0 0; color: #22c55e; font-size: 11px;">${t.photoAvailable}</p>
                `;
                
                content.appendChild(photoCard);
            });
            
            modal.style.display = 'block';
        }

        function showLargePhoto(photoUrl, voterName, voterNumber) {
            const modal = document.getElementById('largePhotoModal');
            const content = document.getElementById('largePhotoContent');
            const t = translations[currentLanguage];
            
            const voterLabel = currentLanguage === 'en' ? 'Voter Number:' : 'ভোটার নম্বর:';
            
            content.innerHTML = `
                <h3 style="margin-bottom: 20px;">${voterName}</h3>
                <p style="margin-bottom: 15px; color: #718096;">${voterLabel} ${voterNumber}</p>
                <img src="${photoUrl}" alt="${voterName}" style="max-width: 100%; max-height: 500px; border-radius: 15px; border: 3px solid #667eea;">
                <p style="margin-top: 15px; color: #22c55e; font-size: 14px;">${t.voterPhoto}</p>
            `;
            
            modal.style.display = 'block';
        }

        function showStatistics() {
            const modal = document.getElementById('statisticsModal');
            const content = document.getElementById('statisticsContent');
            const t = translations[currentLanguage];
            
            // Update modal title
            document.querySelector('#statisticsModal h2').textContent = t.statisticsTitle;
            
            const sessionStats = {};
            const departmentStats = {};
            const translatedData = getTranslatedVoterData();
            
            translatedData.forEach(voter => {
                const session = voter.registrationSession || (currentLanguage === 'en' ? 'Unknown' : 'অজানা');
                const department = voter.department && !voter.department.match(/^\d+\)$/) ? voter.department : (currentLanguage === 'en' ? 'Unknown' : 'অজানা');
                
                sessionStats[session] = (sessionStats[session] || 0) + 1;
                departmentStats[department] = (departmentStats[department] || 0) + 1;
            });
            
            const peopleText = currentLanguage === 'en' ? 'people' : 'জন';
            
            content.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                    <div>
                        <h3>${t.sessionDistribution}</h3>
                        ${Object.entries(sessionStats).sort((a, b) => b[1] - a[1]).slice(0, 10).map(([session, count]) => 
                            `<p><strong>${session}:</strong> ${count} ${peopleText}</p>`
                        ).join('')}
                    </div>
                    <div>
                        <h3>${t.departmentDistribution}</h3>
                        ${Object.entries(departmentStats).sort((a, b) => b[1] - a[1]).slice(0, 10).map(([department, count]) => 
                            `<p><strong>${department.length > 25 ? department.substring(0, 25) + '...' : department}:</strong> ${count} ${peopleText}</p>`
                        ).join('')}
                    </div>
                    <div>
                        <h3>${t.photoInfo}</h3>
                        <p><strong>${currentLanguage === 'en' ? 'Total Voters:' : 'মোট ভোটার:'}</strong> ${filteredData.length} ${peopleText}</p>
                        <p><strong>${currentLanguage === 'en' ? 'Voters with Photos:' : 'ছবিসহ ভোটার:'}</strong> ${filteredData.length} ${peopleText}</p>
                        <p><strong>${currentLanguage === 'en' ? 'Photo Attachment Rate:' : 'ছবি সংযুক্তির হার:'}</strong> ${currentLanguage === 'en' ? '100%' : '১০০%'}</p>
                    </div>
                </div>
            `;
            
            modal.style.display = 'block';
        }


        function showVoterDetails(voterNumber) {
            const voter = voterData.find(v => v.voterNumber === voterNumber);
            const t = translations[currentLanguage];
            
            if (voter) {
                generateIdCard(voter);
                document.getElementById('idCardModal').style.display = 'block';
            }
        }

        // Generate simple QR code pattern for voter
        function generateQRCode(voterNumber, name) {
            // Create a simple visual QR code pattern
            const data = `DUCSU-${voterNumber}-${name}`;
            const hash = data.split('').reduce((a, b) => {
                a = ((a << 5) - a) + b.charCodeAt(0);
                return a & a;
            }, 0);
            
            // Generate a 6x6 grid pattern based on hash
            let qrPattern = '';
            for (let i = 0; i < 6; i++) {
                for (let j = 0; j < 6; j++) {
                    const bit = (hash >> (i * 6 + j)) & 1;
                    qrPattern += `<div style="width: 10px; height: 10px; background: ${bit ? '#000' : '#fff'}; display: inline-block; margin: 1px;"></div>`;
                    if (j === 5) qrPattern += '<br>';
                }
            }
            
            return `<div style="font-size: 8px; line-height: 1;">${qrPattern}</div>`;
        }

        function generateIdCard(voter) {
            const t = translations[currentLanguage];
            
            // Get translated data for display
            const displayName = currentLanguage === 'en' ? translateName(voter.name) : voter.name;
            const displayDepartment = currentLanguage === 'en' ? (departmentTranslations[voter.department] || voter.department) : voter.department;
            const displaySession = currentLanguage === 'en' ? (sessionTranslations[voter.registrationSession] || voter.registrationSession) : voter.registrationSession;
            
            // Get photo URL
            const photoUrl = getVoterPhoto(voter.voterNumber, displayName, voter.serial);
            
            // Generate current date
            const currentDate = new Date().toLocaleDateString(currentLanguage === 'en' ? 'en-US' : 'bn-BD');
            
            const idCardHtml = `
                <div class="id-card" id="printableIdCard">
                    <div class="id-card-header">
                        <h3>${currentLanguage === 'en' ? 'University of Dhaka' : 'ঢাকা বিশ্ববিদ্যালয়'}</h3>
                        <p>${currentLanguage === 'en' ? 'Amar Ekushey Hall - DUCSU Voter ID' : 'অমর একুশে হল - ডাকসু ভোটার আইডি'}</p>
                    </div>
                    <div class="id-card-body">
                        <img src="${photoUrl}" alt="${displayName}" class="id-card-photo" data-voter="${voter.voterNumber}">
                        <div class="id-card-details">
                            <div class="id-card-name">${displayName}</div>
                            <div class="id-card-field">
                                <span class="id-card-label">${currentLanguage === 'en' ? 'ID:' : 'আইডি:'}</span>
                                <span class="id-card-value">${voter.voterNumber}</span>
                            </div>
                            <div class="id-card-field">
                                <span class="id-card-label">${currentLanguage === 'en' ? 'Serial:' : 'ক্রমিক:'}</span>
                                <span class="id-card-value">${voter.serial}</span>
                            </div>
                            <div class="id-card-field">
                                <span class="id-card-label">${currentLanguage === 'en' ? 'Session:' : 'সেশন:'}</span>
                                <span class="id-card-value">${displaySession || t.na}</span>
                            </div>
                            <div class="id-card-field">
                                <span class="id-card-label">${currentLanguage === 'en' ? 'Dept:' : 'বিভাগ:'}</span>
                                <span class="id-card-value" title="${displayDepartment}">${displayDepartment ? displayDepartment.substring(0, 30) + (displayDepartment.length > 30 ? '...' : '') : t.na}</span>
                            </div>
                            <div class="id-card-field">
                                <span class="id-card-label">${currentLanguage === 'en' ? 'Status:' : 'অবস্থা:'}</span>
                                <span class="id-card-value">${currentLanguage === 'en' ? 'ACTIVE' : 'সক্রিয়'}</span>
                            </div>
                        </div>
                    </div>
                    <div class="id-card-qr" id="qrCode_${voter.voterNumber}">
                        ${generateQRCode(voter.voterNumber, displayName)}
                    </div>
                    <div class="id-card-footer">
                        ${currentLanguage === 'en' ? 'Issued:' : 'প্রদত্ত:'} ${currentDate}
                    </div>
                </div>
            `;
            
            document.getElementById('idCardContent').innerHTML = idCardHtml;
        }

        function exportToExcel() {
            // Check if XLSX library is loaded
            if (typeof XLSX === 'undefined') {
                alert(currentLanguage === 'en' ? 
                    'Excel export library not loaded. Please check your internet connection and refresh the page.' : 
                    'এক্সেল এক্সপোর্ট লাইব্রেরি লোড হয়নি। আপনার ইন্টারনেট সংযোগ পরীক্ষা করুন এবং পৃষ্ঠা রিফ্রেশ করুন।');
                return;
            }
            
            try {
                const wb = XLSX.utils.book_new();
            
            const wsData = [
                ['ক্রমিক', 'ভোটার নম্বর', 'নাম', 'রেজিস্ট্রেশন সেশন', 'বিভাগ', 'ছবি নিষ্কাশিত', 'ছবির উৎস']
            ];
            
            filteredData.forEach(voter => {
                wsData.push([
                    voter.serial,
                    voter.voterNumber,
                    voter.name || 'নাম পাওয়া যায়নি',
                    voter.registrationSession || 'N/A',
                    voter.department || 'তথ্য নেই',
                    'হ্যাঁ',
                    'ডেটাবেস'
                ]);
            });
            
            const ws = XLSX.utils.aoa_to_sheet(wsData);
            ws['!cols'] = [
                {wch: 8}, {wch: 15}, {wch: 25}, {wch: 15}, {wch: 30}, {wch: 12}, {wch: 12}
            ];
            
            XLSX.utils.book_append_sheet(wb, ws, "ভোটার তালিকা");
            
            XLSX.writeFile(wb, 'অমর_একুশে_হল_ভোটার_ডেটাবেস_ছবিসহ.xlsx');
            } catch (error) {
                alert(currentLanguage === 'en' ? 
                    'Error exporting to Excel: ' + error.message : 
                    'এক্সেল এক্সপোর্ট ত্রুটি: ' + error.message);
                console.error('Excel export error:', error);
            }
        }

        function generateReport() {
            showReportGeneratorModal();
        }
        
        function showReportGeneratorModal() {
            const modal = document.getElementById('reportGeneratorModal');
            if (!modal) {
                createReportGeneratorModal();
            }
            document.getElementById('reportGeneratorModal').style.display = 'block';
            updateReportPreview();
        }
        
        function createReportGeneratorModal() {
            const modal = document.createElement('div');
            modal.id = 'reportGeneratorModal';
            modal.className = 'modal';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 1000px; max-height: 90vh; overflow-y: auto;">
                    <div class="modal-header">
                        <h2 id="reportGeneratorTitle">📊 রিপোর্ট জেনারেটর</h2>
                        <span class="close" onclick="closeModal('reportGeneratorModal')">&times;</span>
                    </div>
                    <div class="modal-body">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                            <!-- Left Panel - Report Configuration -->
                            <div>
                                <h3 id="reportConfigTitle">⚙️ রিপোর্ট কনফিগারেশন</h3>
                                
                                <!-- Report Type -->
                                <div class="form-group">
                                    <label id="reportTypeLabel">📄 রিপোর্টের ধরন:</label>
                                    <select id="reportType" onchange="updateReportPreview()">
                                        <option value="summary">📊 সারসংক্ষেপ রিপোর্ট</option>
                                        <option value="detailed">📃 বিস্তারিত তালিকা</option>
                                        <option value="statistical">📊 পরিসংখ্যানগত বিশ্লেষণ</option>
                                        <option value="department">🏢 বিভাগীয় রিপোর্ট</option>
                                        <option value="session">🗓️ সেশনীয় রিপোর্ট</option>
                                        <option value="voter-cards">🆔 ভোটার কার্ড তালিকা</option>
                                    </select>
                                </div>
                                
                                <!-- Report Scope -->
                                <div class="form-group">
                                    <label id="reportScopeLabel">🎯 রিপোর্টের পরিসর:</label>
                                    <select id="reportScope" onchange="updateReportPreview()">
                                        <option value="all">🌍 সমস্ত ভোটার</option>
                                        <option value="filtered">🔍 বর্তমান ফিলটারকৃত</option>
                                    </select>
                                </div>
                                
                                <!-- Include Options -->
                                <div class="form-group">
                                    <label id="includeOptionsLabel">📋 অন্তর্ভুক্ত বিষয়সমূহ:</label>
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px;">
                                        <label><input type="checkbox" id="includePhotos" checked onchange="updateReportPreview()"> 🖼️ ছবি</label>
                                        <label><input type="checkbox" id="includeStats" checked onchange="updateReportPreview()"> 📊 পরিসংখ্যান</label>
                                        <label><input type="checkbox" id="includeQR" checked onchange="updateReportPreview()"> 🔲 QR কোড</label>
                                        <label><input type="checkbox" id="includeDepartments" checked onchange="updateReportPreview()"> 🏢 বিভাগ</label>
                                        <label><input type="checkbox" id="includeSessions" checked onchange="updateReportPreview()"> 🗓️ সেশন</label>
                                        <label><input type="checkbox" id="includeCharts" onchange="updateReportPreview()"> 📈 চার্ট</label>
                                    </div>
                                </div>
                                
                                <!-- Format Options -->
                                <div class="form-group">
                                    <label id="formatLabel">📄 ফর্ম্যাট:</label>
                                    <select id="reportFormat">
                                        <option value="html">🌐 HTML (ওয়েব পেজ)</option>
                                        <option value="pdf">📄 PDF (প্রিন্ট)</option>
                                        <option value="excel">📈 Excel</option>
                                    </select>
                                </div>
                                
                                <!-- Custom Options -->
                                <div class="form-group">
                                    <label id="customTitleLabel">🏷️ কাস্টম শিরোনাম:</label>
                                    <input type="text" id="customTitle" placeholder="যেমন: অমর একুশে হল - ভোটার তালিকা" onchange="updateReportPreview()">
                                </div>
                                
                                <!-- Action Buttons -->
                                <div style="margin-top: 20px;">
                                    <button class="btn btn-primary" onclick="generateCustomReport()" style="width: 100%; margin-bottom: 10px;">
                                        <span id="generateBtnText">🚀 রিপোর্ট তৈরি করুন</span>
                                    </button>
                                    <button class="btn btn-secondary" onclick="updateReportPreview()" style="width: 100%;">
                                        <span id="previewBtnText">👁️ প্রিভিউ আপডেট</span>
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Right Panel - Live Preview -->
                            <div>
                                <h3 id="previewTitle">👁️ লাইভ প্রিভিউ</h3>
                                <div id="reportPreview" style="border: 2px solid #ddd; border-radius: 8px; padding: 15px; background: #f9f9f9; min-height: 400px; overflow-y: auto; max-height: 600px; font-size: 12px;">
                                    <!-- Preview content will be loaded here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function updateReportPreview() {
            const reportType = document.getElementById('reportType').value;
            const reportScope = document.getElementById('reportScope').value;
            const includePhotos = document.getElementById('includePhotos').checked;
            const includeStats = document.getElementById('includeStats').checked;
            const includeQR = document.getElementById('includeQR').checked;
            const includeDepartments = document.getElementById('includeDepartments').checked;
            const includeSessions = document.getElementById('includeSessions').checked;
            const includeCharts = document.getElementById('includeCharts').checked;
            const customTitle = document.getElementById('customTitle').value;
            
            const dataToUse = reportScope === 'all' ? voterData : filteredData;
            const preview = document.getElementById('reportPreview');
            
            let previewHTML = generateReportHTML(reportType, dataToUse, {
                includePhotos, includeStats, includeQR, includeDepartments, 
                includeSessions, includeCharts, customTitle
            });
            
            preview.innerHTML = previewHTML;
        }
        
        function generateReportHTML(type, data, options) {
            const title = options.customTitle || (currentLanguage === 'en' ? 'Amar Ekushey Hall - Voter Database Report' : 'অমর একুশে হল - ভোটার ডেটাবেস রিপোর্ট');
            const t = translations[currentLanguage];
            
            let html = `
                <div style="text-align: center; margin-bottom: 20px;">
                    <h1 style="color: #2d3748; margin-bottom: 5px;">${title}</h1>
                    <p style="color: #666; margin: 5px 0;">DUCSU-1 | ${currentLanguage === 'en' ? 'University of Dhaka' : 'ঢাকা বিশ্ববিদ্যালয়'}</p>
                    <p style="color: #666; font-size: 14px;">${currentLanguage === 'en' ? 'Generated on' : 'তারিখ'}: ${new Date().toLocaleDateString(currentLanguage === 'en' ? 'en-US' : 'bn-BD')}</p>
                </div>
            `;
            
            if (options.includeStats) {
                html += generateStatsSection(data);
            }
            
            switch (type) {
                case 'summary':
                    html += generateSummaryReport(data, options);
                    break;
                case 'detailed':
                    html += generateDetailedReport(data, options);
                    break;
                case 'statistical':
                    html += generateStatisticalReport(data, options);
                    break;
                case 'department':
                    html += generateDepartmentReport(data, options);
                    break;
                case 'session':
                    html += generateSessionReport(data, options);
                    break;
                case 'voter-cards':
                    html += generateVoterCardsReport(data, options);
                    break;
            }
            
            return html;
        }
        
        function generateStatsSection(data) {
            const departments = [...new Set(data.map(v => v.department))].filter(d => d);
            const sessions = [...new Set(data.map(v => v.registrationSession))].filter(s => s);
            
            return `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin: 20px 0;">
                    <div style="border: 1px solid #ddd; padding: 15px; border-radius: 8px; text-align: center; background: #f0f8ff;">
                        <h3 style="margin: 0; color: #2d3748;">${data.length}</h3>
                        <p style="margin: 5px 0; color: #666;">${currentLanguage === 'en' ? 'Total Voters' : 'মোট ভোটার'}</p>
                    </div>
                    <div style="border: 1px solid #ddd; padding: 15px; border-radius: 8px; text-align: center; background: #f0fff0;">
                        <h3 style="margin: 0; color: #2d3748;">${departments.length}</h3>
                        <p style="margin: 5px 0; color: #666;">${currentLanguage === 'en' ? 'Departments' : 'বিভাগ'}</p>
                    </div>
                    <div style="border: 1px solid #ddd; padding: 15px; border-radius: 8px; text-align: center; background: #fff5ee;">
                        <h3 style="margin: 0; color: #2d3748;">${sessions.length}</h3>
                        <p style="margin: 5px 0; color: #666;">${currentLanguage === 'en' ? 'Sessions' : 'সেশন'}</p>
                    </div>
                    <div style="border: 1px solid #ddd; padding: 15px; border-radius: 8px; text-align: center; background: #f5f0ff;">
                        <h3 style="margin: 0; color: #2d3748;">100%</h3>
                        <p style="margin: 5px 0; color: #666;">${currentLanguage === 'en' ? 'Photo Coverage' : 'ছবি কভারেজ'}</p>
                    </div>
                </div>
            `;
        }
        
        function generateSummaryReport(data, options) {
            const summary = currentLanguage === 'en' ? 
                `This report contains ${data.length} voters from Amar Ekushey Hall with complete photo coverage.` :
                `এই রিপোর্টে অমর একুশে হলের ${data.length}টি ভোটারের সম্পূর্ণ ছবিসহ তথ্য রয়েছে।`;
                
            return `
                <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0;">
                    <h3>${currentLanguage === 'en' ? '📋 Summary' : '📋 সারসংক্ষেপ'}</h3>
                    <p>${summary}</p>
                    ${generateTopDepartments(data)}
                </div>
            `;
        }
        
        function generateDetailedReport(data, options) {
            const limitedData = data.slice(0, 50); // Show first 50 for preview
            
            return `
                <div style="margin: 20px 0;">
                    <h3>${currentLanguage === 'en' ? '📊 Detailed Voter List' : '📊 বিস্তারিত ভোটার তালিকা'}</h3>
                    <p style="color: #666; margin-bottom: 15px;">${currentLanguage === 'en' ? 'Showing first 50 entries' : 'প্রথম ৫০টি এন্ট্রি দেখানো হচ্ছে'}</p>
                    <table style="width: 100%; border-collapse: collapse; font-size: 11px;">
                        <tr style="background: #f2f2f2;">
                            <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">${currentLanguage === 'en' ? 'Serial' : 'ক্রমিক'}</th>
                            <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">${currentLanguage === 'en' ? 'Voter No.' : 'ভোটার নং'}</th>
                            <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">${currentLanguage === 'en' ? 'Name' : 'নাম'}</th>
                            ${options.includeDepartments ? `<th style="border: 1px solid #ddd; padding: 8px; text-align: left;">${currentLanguage === 'en' ? 'Department' : 'বিভাগ'}</th>` : ''}
                            ${options.includeSessions ? `<th style="border: 1px solid #ddd; padding: 8px; text-align: left;">${currentLanguage === 'en' ? 'Session' : 'সেশন'}</th>` : ''}
                            ${options.includePhotos ? `<th style="border: 1px solid #ddd; padding: 8px; text-align: left;">${currentLanguage === 'en' ? 'Photo' : 'ছবি'}</th>` : ''}
                        </tr>
                        ${limitedData.map(voter => `
                            <tr>
                                <td style="border: 1px solid #ddd; padding: 6px;">${voter.serial}</td>
                                <td style="border: 1px solid #ddd; padding: 6px;">${voter.voterNumber}</td>
                                <td style="border: 1px solid #ddd; padding: 6px;">${voter.name || (currentLanguage === 'en' ? 'Name not available' : 'নাম পাওয়া যায়নি')}</td>
                                ${options.includeDepartments ? `<td style="border: 1px solid #ddd; padding: 6px;">${voter.department || 'N/A'}</td>` : ''}
                                ${options.includeSessions ? `<td style="border: 1px solid #ddd; padding: 6px;">${voter.registrationSession || 'N/A'}</td>` : ''}
                                ${options.includePhotos ? `<td style="border: 1px solid #ddd; padding: 6px; color: green;">✅ ${currentLanguage === 'en' ? 'Available' : 'উপলব্ধ'}</td>` : ''}
                            </tr>
                        `).join('')}
                    </table>
                </div>
            `;
        }
        
        function generateStatisticalReport(data, options) {
            const deptStats = generateDepartmentStats(data);
            const sessionStats = generateSessionStats(data);
            
            return `
                <div style="margin: 20px 0;">
                    <h3>${currentLanguage === 'en' ? '📈 Statistical Analysis' : '📈 পরিসংখ্যানগত বিশ্লেষণ'}</h3>
                    ${deptStats}
                    ${sessionStats}
                </div>
            `;
        }
        
        function generateDepartmentReport(data, options) {
            const deptGroups = data.reduce((acc, voter) => {
                const dept = voter.department || (currentLanguage === 'en' ? 'Unknown' : 'অজানা');
                if (!acc[dept]) acc[dept] = [];
                acc[dept].push(voter);
                return acc;
            }, {});
            
            return `
                <div style="margin: 20px 0;">
                    <h3>${currentLanguage === 'en' ? '🏢 Department-wise Report' : '🏢 বিভাগীয় রিপোর্ট'}</h3>
                    ${Object.entries(deptGroups).map(([dept, voters]) => `
                        <div style="margin: 15px 0; padding: 15px; border: 1px solid #ddd; border-radius: 8px;">
                            <h4 style="margin: 0 0 10px 0; color: #2d3748;">${dept} (${voters.length} ${currentLanguage === 'en' ? 'voters' : 'ভোটার'})</h4>
                            <p style="color: #666; font-size: 12px;">${currentLanguage === 'en' ? 'Voter Numbers' : 'ভোটার নম্বর'}: ${voters.slice(0, 10).map(v => v.voterNumber).join(', ')}${voters.length > 10 ? '...' : ''}</p>
                        </div>
                    `).join('')}
                </div>
            `;
        }
        
        function generateSessionReport(data, options) {
            const sessionGroups = data.reduce((acc, voter) => {
                const session = voter.registrationSession || (currentLanguage === 'en' ? 'Unknown' : 'অজানা');
                if (!acc[session]) acc[session] = [];
                acc[session].push(voter);
                return acc;
            }, {});
            
            return `
                <div style="margin: 20px 0;">
                    <h3>${currentLanguage === 'en' ? '🗓️ Session-wise Report' : '🗓️ সেশনীয় রিপোর্ট'}</h3>
                    ${Object.entries(sessionGroups).map(([session, voters]) => `
                        <div style="margin: 15px 0; padding: 15px; border: 1px solid #ddd; border-radius: 8px;">
                            <h4 style="margin: 0 0 10px 0; color: #2d3748;">${session} (${voters.length} ${currentLanguage === 'en' ? 'voters' : 'ভোটার'})</h4>
                            <p style="color: #666; font-size: 12px;">${currentLanguage === 'en' ? 'Departments' : 'বিভাগসমূহ'}: ${[...new Set(voters.map(v => v.department))].filter(d => d).join(', ')}</p>
                        </div>
                    `).join('')}
                </div>
            `;
        }
        
        function generateVoterCardsReport(data, options) {
            const limitedData = data.slice(0, 12); // Show first 12 cards for preview
            
            return `
                <div style="margin: 20px 0;">
                    <h3>${currentLanguage === 'en' ? '🆔 Voter ID Cards' : '🆔 ভোটার আইডি কার্ড'}</h3>
                    <p style="color: #666; margin-bottom: 15px;">${currentLanguage === 'en' ? 'Sample ID cards (first 12)' : 'নমুনা আইডি কার্ড (প্রথম ১২টি)'}</p>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                        ${limitedData.map(voter => generateMiniIdCard(voter, options)).join('')}
                    </div>
                </div>
            `;
        }
        
        function generateMiniIdCard(voter, options) {
            const displayName = currentLanguage === 'en' ? translateName(voter.name) : voter.name;
            const displayDept = currentLanguage === 'en' ? (departmentTranslations[voter.department] || voter.department) : voter.department;
            const displaySession = currentLanguage === 'en' ? (sessionTranslations[voter.registrationSession] || voter.registrationSession) : voter.registrationSession;
            
            return `
                <div style="width: 200px; height: 120px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 10px; position: relative; overflow: hidden; font-size: 10px; color: white;">
                    <div style="background: rgba(255,255,255,0.95); color: #333; padding: 5px; text-align: center; font-size: 9px;">
                        <strong>DUCSU - ${currentLanguage === 'en' ? 'Amar Ekushey Hall' : 'অমর একুশে হল'}</strong>
                    </div>
                    <div style="padding: 8px; display: flex; align-items: center; height: calc(100% - 25px);">
                        <div style="flex: 1;">
                            <div style="font-weight: bold; font-size: 11px; margin-bottom: 2px;">${displayName}</div>
                            <div style="font-size: 9px; margin-bottom: 1px;">${currentLanguage === 'en' ? 'ID' : 'আইডি'}: ${voter.voterNumber}</div>
                            <div style="font-size: 8px; margin-bottom: 1px;">${displayDept}</div>
                            <div style="font-size: 8px;">${displaySession}</div>
                        </div>
                        ${options.includeQR ? `<div style="width: 30px; height: 30px; background: white; border-radius: 3px; margin-left: 5px;"></div>` : ''}
                    </div>
                </div>
            `;
        }
        
        function generateTopDepartments(data) {
            const deptCounts = data.reduce((acc, voter) => {
                const dept = voter.department || (currentLanguage === 'en' ? 'Unknown' : 'অজানা');
                acc[dept] = (acc[dept] || 0) + 1;
                return acc;
            }, {});
            
            const topDepts = Object.entries(deptCounts)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 5);
                
            return `
                <div style="margin-top: 15px;">
                    <h4>${currentLanguage === 'en' ? 'Top 5 Departments' : 'শীর্ষ ৫ বিভাগ'}</h4>
                    <ul style="list-style: none; padding: 0;">
                        ${topDepts.map(([dept, count], index) => `
                            <li style="margin: 5px 0; padding: 5px; background: rgba(102, 126, 234, 0.1); border-radius: 5px;">
                                ${index + 1}. <strong>${dept}</strong>: ${count} ${currentLanguage === 'en' ? 'voters' : 'ভোটার'}
                            </li>
                        `).join('')}
                    </ul>
                </div>
            `;
        }
        
        function generateDepartmentStats(data) {
            const deptCounts = data.reduce((acc, voter) => {
                const dept = voter.department || (currentLanguage === 'en' ? 'Unknown' : 'অজানা');
                acc[dept] = (acc[dept] || 0) + 1;
                return acc;
            }, {});
            
            return `
                <div style="margin: 15px 0; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                    <h4>${currentLanguage === 'en' ? 'Department Distribution' : 'বিভাগীয় বিতরণ'}</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">
                        ${Object.entries(deptCounts).map(([dept, count]) => `
                            <div style="background: white; padding: 10px; border-radius: 5px; border-left: 4px solid #667eea;">
                                <strong>${dept}</strong><br>
                                <span style="color: #666;">${count} ${currentLanguage === 'en' ? 'voters' : 'ভোটার'} (${((count/data.length)*100).toFixed(1)}%)</span>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }
        
        function generateSessionStats(data) {
            const sessionCounts = data.reduce((acc, voter) => {
                const session = voter.registrationSession || (currentLanguage === 'en' ? 'Unknown' : 'অজানা');
                acc[session] = (acc[session] || 0) + 1;
                return acc;
            }, {});
            
            return `
                <div style="margin: 15px 0; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                    <h4>${currentLanguage === 'en' ? 'Session Distribution' : 'সেশনীয় বিতরণ'}</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px;">
                        ${Object.entries(sessionCounts).map(([session, count]) => `
                            <div style="background: white; padding: 10px; border-radius: 5px; border-left: 4px solid #764ba2;">
                                <strong>${session}</strong><br>
                                <span style="color: #666;">${count} ${currentLanguage === 'en' ? 'voters' : 'ভোটার'}</span>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }
        
        function generateCustomReport() {
            const reportType = document.getElementById('reportType').value;
            const reportScope = document.getElementById('reportScope').value;
            const reportFormat = document.getElementById('reportFormat').value;
            const includePhotos = document.getElementById('includePhotos').checked;
            const includeStats = document.getElementById('includeStats').checked;
            const includeQR = document.getElementById('includeQR').checked;
            const includeDepartments = document.getElementById('includeDepartments').checked;
            const includeSessions = document.getElementById('includeSessions').checked;
            const includeCharts = document.getElementById('includeCharts').checked;
            const customTitle = document.getElementById('customTitle').value;
            
            const dataToUse = reportScope === 'all' ? voterData : filteredData;
            
            if (reportFormat === 'excel') {
                generateExcelReport(dataToUse, { 
                    includePhotos, includeStats, includeQR, includeDepartments, 
                    includeSessions, includeCharts, customTitle, reportType 
                });
                return;
            }
            
            const reportHTML = generateFullReportHTML(reportType, dataToUse, {
                includePhotos, includeStats, includeQR, includeDepartments, 
                includeSessions, includeCharts, customTitle
            });
            
            if (reportFormat === 'html') {
                const reportWindow = window.open('', '_blank');
                reportWindow.document.write(reportHTML);
                reportWindow.document.close();
            } else if (reportFormat === 'pdf') {
                // For PDF, open in new window with print-optimized CSS
                const reportWindow = window.open('', '_blank');
                reportWindow.document.write(reportHTML.replace('<style>', '<style>@page { size: A4; margin: 15mm; } body { font-size: 11px; }'));
                reportWindow.document.close();
                setTimeout(() => reportWindow.print(), 1000);
            }
            
            closeModal('reportGeneratorModal');
        }
        
        function generateFullReportHTML(type, data, options) {
            const title = options.customTitle || (currentLanguage === 'en' ? 'Amar Ekushey Hall - Voter Database Report' : 'অমর একুশে হল - ভোটার ডেটাবেস রিপোর্ট');
            
            return `
                <!DOCTYPE html>
                <html lang="${currentLanguage}">
                <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <title>${title}</title>
                    <style>
                        body { 
                            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
                            margin: 40px; 
                            line-height: 1.6;
                            color: #333;
                        }
                        .header { 
                            text-align: center; 
                            margin-bottom: 30px;
                            padding: 20px;
                            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                            color: white;
                            border-radius: 10px;
                        }
                        .stats { 
                            display: grid; 
                            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
                            gap: 20px; 
                            margin: 20px 0; 
                        }
                        .stat-box { 
                            border: 1px solid #ddd; 
                            padding: 20px; 
                            border-radius: 8px; 
                            text-align: center;
                            background: #f8f9fa;
                        }
                        table { 
                            width: 100%; 
                            border-collapse: collapse; 
                            margin-top: 20px; 
                            font-size: 12px; 
                        }
                        th, td { 
                            border: 1px solid #ddd; 
                            padding: 8px; 
                            text-align: left; 
                        }
                        th { 
                            background-color: #f2f2f2; 
                            font-weight: bold;
                        }
                        .section {
                            margin: 30px 0;
                            padding: 20px;
                            background: #f9f9f9;
                            border-radius: 8px;
                        }
                        @media print {
                            body { margin: 15mm; font-size: 11px; }
                            .header { background: #667eea !important; }
                        }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>${title}</h1>
                        <p>DUCSU-1 | ${currentLanguage === 'en' ? 'University of Dhaka' : 'ঢাকা বিশ্ববিদ্যালয়'}</p>
                        <p>${currentLanguage === 'en' ? 'Generated on' : 'তারিখ'}: ${new Date().toLocaleDateString(currentLanguage === 'en' ? 'en-US' : 'bn-BD')}</p>
                    </div>
                    
                    ${generateReportHTML(type, data, options)}
                    
                    <div style="margin-top: 40px; text-align: center; color: #666; border-top: 1px solid #ddd; padding-top: 20px;">
                        <p><strong>${currentLanguage === 'en' ? 'Report generated by' : 'রিপোর্ট তৈরি করেছে'}:</strong> ${currentLanguage === 'en' ? 'DUCSU Voter Database System' : 'ডাকসু ভোটার ডেটাবেস সিস্টেম'}</p>
                        <p>${currentLanguage === 'en' ? 'Total voters in this report' : 'এই রিপোর্টে মোট ভোটার'}: <strong>${data.length}</strong></p>
                    </div>
                </body>
                </html>
            `;
        }
        
        function generateExcelReport(data, options) {
            const headers = [
                currentLanguage === 'en' ? 'Serial' : 'ক্রমিক',
                currentLanguage === 'en' ? 'Voter Number' : 'ভোটার নম্বর',
                currentLanguage === 'en' ? 'Name' : 'নাম'
            ];
            
            if (options.includeDepartments) headers.push(currentLanguage === 'en' ? 'Department' : 'বিভাগ');
            if (options.includeSessions) headers.push(currentLanguage === 'en' ? 'Session' : 'সেশন');
            if (options.includePhotos) headers.push(currentLanguage === 'en' ? 'Photo Status' : 'ছবির অবস্থা');
            
            const worksheetData = [headers];
            
            data.forEach(voter => {
                const row = [
                    voter.serial,
                    voter.voterNumber,
                    voter.name || (currentLanguage === 'en' ? 'Name not available' : 'নাম পাওয়া যায়নি')
                ];
                
                if (options.includeDepartments) row.push(voter.department || 'N/A');
                if (options.includeSessions) row.push(voter.registrationSession || 'N/A');
                if (options.includePhotos) row.push(currentLanguage === 'en' ? 'Available' : 'উপলব্ধ');
                
                worksheetData.push(row);
            });
            
            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.aoa_to_sheet(worksheetData);
            
            // Auto-size columns
            const colWidths = headers.map((header, i) => ({
                wch: Math.max(header.length, ...worksheetData.slice(1).map(row => String(row[i] || '').length))
            }));
            ws['!cols'] = colWidths;
            
            XLSX.utils.book_append_sheet(wb, ws, currentLanguage === 'en' ? 'Voter Database' : 'ভোটার ডেটাবেস');
            
            const filename = `${options.customTitle || 'voter-database'}-${new Date().toISOString().split('T')[0]}.xlsx`;
            XLSX.writeFile(wb, filename);
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // Print ID Card function - IMPROVED
        function printIdCard() {
            const idCard = document.getElementById('printableIdCard');
            if (!idCard) {
                alert(currentLanguage === 'en' ? 'ID card not found!' : 'আইডি কার্ড পাওয়া যায়নি!');
                return;
            }
            
            const printWindow = window.open('', '', 'width=800,height=600');
            
            // Check for popup blocker
            if (!printWindow) {
                alert(currentLanguage === 'en' ? 
                    'Popup blocked! Please allow popups for this site to print.' : 
                    'পপআপ ব্লক করা হয়েছে! প্রিন্ট করতে এই সাইটের জন্য পপআপ অনুমতি দিন।');
                return;
            }
            printWindow.document.write(`
                <html>
                <head>
                    <title>DUCSU Voter ID Card - Print</title>
                    <style>
                        @page {
                            size: A4;
                            margin: 20mm;
                        }
                        body { 
                            margin: 0; 
                            padding: 20px; 
                            font-family: Arial, sans-serif; 
                            display: flex;
                            justify-content: center;
                            align-items: center;
                            min-height: 100vh;
                        }
                        .id-card { 
                            width: 600px; 
                            height: 380px; 
                            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
                            border-radius: 20px; 
                            position: relative; 
                            margin: 0 auto; 
                            box-shadow: 0 20px 50px rgba(0,0,0,0.3); 
                            overflow: hidden; 
                            font-family: 'Arial', sans-serif; 
                        }
                        .id-card-header { 
                            background: rgba(255,255,255,0.95); 
                            padding: 15px 25px; 
                            text-align: center; 
                            border-bottom: 4px solid #667eea; 
                        }
                        .id-card-header h3 { 
                            margin: 0; 
                            font-size: 20px; 
                            color: #2d3748; 
                            font-weight: bold; 
                        }
                        .id-card-header p { 
                            margin: 5px 0 0 0; 
                            font-size: 16px; 
                            color: #718096; 
                        }
                        .id-card-body { 
                            display: flex; 
                            padding: 25px; 
                            height: calc(100% - 90px); 
                        }
                        .id-card-photo { 
                            width: 120px; 
                            height: 150px; 
                            border-radius: 12px; 
                            border: 4px solid white; 
                            object-fit: cover; 
                            margin-right: 25px; 
                            box-shadow: 0 8px 25px rgba(0,0,0,0.4); 
                        }
                        .id-card-details { 
                            flex: 1; 
                            color: white; 
                            font-size: 16px; 
                        }
                        .id-card-name { 
                            font-size: 24px; 
                            font-weight: bold; 
                            margin-bottom: 15px; 
                            text-shadow: 2px 2px 4px rgba(0,0,0,0.3); 
                        }
                        .id-card-field { 
                            margin-bottom: 12px; 
                            display: flex; 
                            justify-content: space-between; 
                            align-items: center; 
                        }
                        .id-card-label { 
                            font-weight: bold; 
                            min-width: 120px; 
                            font-size: 16px; 
                        }
                        .id-card-value { 
                            text-align: right; 
                            background: rgba(255,255,255,0.2); 
                            padding: 6px 12px; 
                            border-radius: 8px; 
                            font-weight: bold; 
                            font-size: 16px; 
                            max-width: 250px; 
                            word-wrap: break-word; 
                        }
                        .id-card-footer { 
                            position: absolute; 
                            bottom: 15px; 
                            right: 25px; 
                            font-size: 14px; 
                            color: rgba(255,255,255,0.8); 
                        }
                        .id-card-qr { 
                            position: absolute; 
                            bottom: 15px; 
                            left: 25px; 
                            width: 80px; 
                            height: 80px; 
                            background: white; 
                            border-radius: 8px; 
                            display: flex; 
                            align-items: center; 
                            justify-content: center; 
                            font-size: 10px; 
                            color: #333; 
                            text-align: center; 
                            overflow: hidden; 
                        }
                        @media print { 
                            body { 
                                margin: 0; 
                                background: white !important;
                                -webkit-print-color-adjust: exact;
                                color-adjust: exact;
                            } 
                            .id-card { 
                                box-shadow: none; 
                                page-break-inside: avoid;
                            } 
                        }
                    </style>
                </head>
                <body>
                    ${idCard.outerHTML}
                    <script>
                        window.onload = function() {
                            setTimeout(function() {
                                window.print();
                                window.close();
                            }, 1000);
                        }
                    <\/script>
                </body>
                </html>
            `);
            printWindow.document.close();
        }

        // Download ID Card as Image function - IMPROVED
        function downloadIdCard() {
            const idCard = document.getElementById('printableIdCard');
            if (!idCard) {
                alert(currentLanguage === 'en' ? 'ID card not found!' : 'আইডি কার্ড পাওয়া যায়নি!');
                return;
            }
            
            // Create a canvas to draw the ID card
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            
            // Set canvas size to match ID card (high resolution)
            canvas.width = 1200; // 2x the CSS width for better quality
            canvas.height = 760; // 2x the CSS height for better quality
            
            // Draw gradient background
            const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
            gradient.addColorStop(0, '#667eea');
            gradient.addColorStop(1, '#764ba2');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Draw white header
            ctx.fillStyle = 'rgba(255,255,255,0.95)';
            ctx.fillRect(0, 0, canvas.width, 120);
            
            // Add text (simplified version for canvas)
            ctx.fillStyle = '#2d3748';
            ctx.font = 'bold 32px Arial';
            ctx.textAlign = 'center';
            ctx.fillText(currentLanguage === 'en' ? 'University of Dhaka' : 'ঢাকা বিশ্ববিদ্যালয়', canvas.width/2, 50);
            
            ctx.font = '24px Arial';
            ctx.fillText(currentLanguage === 'en' ? 'Amar Ekushey Hall - DUCSU Voter ID' : 'অমর একুশে হল - ডাকসু ভোটার আইডি', canvas.width/2, 90);
            
            // Get voter data from the current ID card
            const voterName = idCard.querySelector('.id-card-name').textContent;
            const voterFields = idCard.querySelectorAll('.id-card-field');
            
            // Draw voter information
            ctx.fillStyle = 'white';
            ctx.font = 'bold 36px Arial';
            ctx.textAlign = 'left';
            ctx.fillText(voterName, 300, 200);
            
            let yPos = 250;
            voterFields.forEach(field => {
                const label = field.querySelector('.id-card-label').textContent;
                const value = field.querySelector('.id-card-value').textContent;
                
                ctx.font = 'bold 24px Arial';
                ctx.fillText(label, 300, yPos);
                
                ctx.font = '24px Arial';
                ctx.textAlign = 'right';
                ctx.fillText(value, canvas.width - 100, yPos);
                ctx.textAlign = 'left';
                
                yPos += 60;
            });
            
            // Add footer
            ctx.font = '20px Arial';
            ctx.fillStyle = 'rgba(255,255,255,0.8)';
            ctx.textAlign = 'right';
            const currentDate = new Date().toLocaleDateString();
            ctx.fillText((currentLanguage === 'en' ? 'Issued: ' : 'প্রদত্ত: ') + currentDate, canvas.width - 50, canvas.height - 30);
            
            // Download the canvas as image
            const link = document.createElement('a');
            link.download = `DUCSU-Voter-ID-${voterName.replace(/\s+/g, '-')}.png`;
            link.href = canvas.toDataURL('image/png');
            link.click();
            
            // Show success message
            alert(currentLanguage === 'en' ? 
                '✅ ID card downloaded successfully!' : 
                '✅ আইডি কার্ড সফলভাবে ডাউনলোড হয়েছে!');
        }

        // Helper function to preload portrait images (optional optimization)
        function preloadPortraitImages(startSerial, endSerial) {
            for (let i = startSerial; i <= endSerial; i++) {
                const voterNumber = `এক-${String(i).padStart(5, '0')}`;
                // Only preload if not already cached
                if (!imageCache[voterNumber]) {
                    setTimeout(() => {
                        getVoterPhoto(voterNumber, '', i);
                    }, i * 10); // Stagger loading to avoid overwhelming the browser
                }
            }
        }


        // Initialize the application only after authentication - OPTIMIZED
        window.onload = function() {
            if (!isAuthenticated) {
                // Just show login page, don't initialize main app yet
                updateUILanguage(); // For login page translations
            } else {
                // Show loading indicator immediately
                showLoadingState();
                // Initialize app with small delay to show loading
                setTimeout(initializeApp, 100);
            }
        };
        
        function showLoadingState() {
            const mainContent = document.getElementById('mainContent');
            if (mainContent) {
                mainContent.style.display = 'block';
                mainContent.innerHTML = `
                    <div style="text-align: center; padding: 50px;">
                        <div style="font-size: 48px; margin-bottom: 20px;">⏳</div>
                        <h3>${currentLanguage === 'en' ? 'Loading Voter Database...' : 'ভোটার ডেটাবেস লোড হচ্ছে...'}</h3>
                        <p style="color: #666;">${currentLanguage === 'en' ? 'Please wait while we prepare your data' : 'অনুগ্রহ করে অপেক্ষা করুন'}</p>
                        <div style="margin-top: 20px;">
                            <div style="display: inline-block; width: 200px; height: 4px; background: #eee; border-radius: 2px; overflow: hidden;">
                                <div style="width: 0%; height: 100%; background: #4299e1; animation: loading 2s infinite;" id="loadingBar"></div>
                            </div>
                        </div>
                    </div>
                    <style>
                        @keyframes loading {
                            0% { width: 0%; }
                            50% { width: 70%; }
                            100% { width: 100%; }
                        }
                    </style>
                `;
            }
        }
        
        // OPTIMIZED: Fast app initialization
        function initializeApp() {
            // Restore original main content structure
            const mainContent = document.getElementById('mainContent');
            if (mainContent) {
                // Ensure mainContent is visible
                mainContent.style.display = 'block';
                mainContent.innerHTML = `
                    <div class="container">
                        <header>
                            <h1 id="mainTitle">ডাকসু ভোটার ডেটাবেস</h1>
                            <p id="subtitle">অমর একুশে হল</p>
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 10px;">
                                <div>
                                    <button id="languageToggle" class="btn btn-secondary" onclick="toggleLanguage()">🌐 English</button>
                                        </div>
                                <button class="btn btn-danger" onclick="logout()">🚪 লগআউট</button>
                            </div>
                        </header>

                        <div class="filters">
                            <div class="filter-row" style="display: flex; flex-wrap: wrap; gap: 10px; align-items: center;">
                                <input type="text" id="searchName" placeholder="নাম খুঁজুন..." onkeyup="filterData()" style="padding: 12px; font-size: 16px; min-width: 250px;">
                                <input type="text" id="searchVoterNumber" placeholder="ভোটার নম্বর খুঁজুন..." onkeyup="filterData()" style="padding: 12px; font-size: 16px; min-width: 200px;">
                                <select id="sessionFilter" onchange="filterData()" style="padding: 12px; font-size: 16px; min-width: 150px;">
                                    <option value="">সকল সেশন</option>
                                </select>
                                <select id="departmentFilter" onchange="filterData()" style="padding: 12px; font-size: 16px; min-width: 250px;">
                                    <option value="">সকল বিভাগ</option>
                                </select>
                                <button class="btn btn-secondary" onclick="resetFilters()" style="padding: 12px 20px; font-size: 16px;">🔄 রিসেট</button>
                            </div>
                            <div class="filter-info" style="margin-top: 15px;">
                                <span style="margin-right: 20px; font-size: 16px;">মোট ভোটার: <span id="totalCount" style="font-weight: bold;">0</span></span>
                                <span style="font-size: 16px;">ফিল্টার করা: <input type="number" id="filteredCount" readonly style="width: 80px; font-weight: bold;"></span>
                            </div>
                        </div>

                        <div class="actions" style="margin: 20px 0; text-align: center;">
                            <button class="btn btn-success" onclick="exportToExcel()" style="margin: 5px;">📊 এক্সেল এক্সপোর্ট</button>
                            <button class="btn btn-primary" onclick="generateReport()" style="margin: 5px;">📋 রিপোর্ট তৈরি করুন</button>
                            <button class="btn btn-warning" onclick="showPhotoGallery()" style="margin: 5px;">🖼️ ফটো গ্যালারি</button>
                            <button class="btn btn-info" onclick="showStatistics()" style="margin: 5px;">📈 পরিসংখ্যান</button>
                        </div>

                        <div class="table-container">
                            <div id="tableLoading" style="text-align: center; padding: 20px;">
                                <div style="font-size: 24px; margin-bottom: 10px;">📊</div>
                                <p>ডেটা লোড হচ্ছে...</p>
                            </div>
                            <table id="voterTable">
                                <thead>
                                    <tr>
                                        <th>ছবি</th>
                                        <th>ক্রমিক</th>
                                        <th>ভোটার নম্বর</th>
                                        <th>নাম</th>
                                        <th>সেশন</th>
                                        <th>বিভাগ</th>
                                        <th>অ্যাকশন</th>
                                    </tr>
                                </thead>
                                <tbody id="voterTableBody"></tbody>
                            </table>
                        </div>

                        <div id="pagination"></div>
                        <div id="paginationInfo" style="text-align: center; margin-top: 10px; color: #666;"></div>
                    </div>
                `;
            }
            
            // Initialize voter data first
            initializeVoterData();
            
            // Initialize data and UI
            updateUILanguage();
            
            // Initialize filteredData with all voterData if not already done
            if (filteredData.length === 0 && voterData.length > 0) {
                filteredData = [...voterData];
            }
            
            // Update counts
            const totalCount = document.getElementById('totalCount');
            const filteredCount = document.getElementById('filteredCount');
            if (totalCount) totalCount.textContent = voterData.length;
            if (filteredCount) filteredCount.value = filteredData.length;
            
            // Hide loading indicator
            const tableLoading = document.getElementById('tableLoading');
            if (tableLoading) tableLoading.style.display = 'none';
            
            populateFilters();
            displayTable();
        }

        // Function to reset all filters
        function resetFilters() {
            const searchName = document.getElementById('searchName');
            const searchVoterNumber = document.getElementById('searchVoterNumber');
            const sessionFilter = document.getElementById('sessionFilter');
            const departmentFilter = document.getElementById('departmentFilter');
            
            if (searchName) searchName.value = '';
            if (searchVoterNumber) searchVoterNumber.value = '';
            if (sessionFilter) sessionFilter.value = '';
            if (departmentFilter) departmentFilter.value = '';
            
            filterData();
        }

        // Close modals when clicking outside
        window.onclick = function(event) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        };
    </script>
</body>
</html>